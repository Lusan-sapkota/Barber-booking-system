{% extends "base.html" %}

{% block title %}Super Admin Dashboard - BookaBarber{% endblock %}

{% block extra_css %}
<style>
:root {
  /* Light Theme */
  --bg-primary: #f8f9fa;
  --bg-secondary: #ffffff;
  --bg-card: #ffffff;
  --text-primary: #212529;
  --text-secondary: #6c757d;
  --border-color: #e9ecef;
  --card-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.08);
  --header-gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
  --accent-color: #4361ee;
  --success-color: #4cc9f0;
  --warning-color: #f8961e;
  --danger-color: #f72585;
  --info-color: #4895ef;
  
  /* Component Colors */
  --input-bg: #ffffff;
  --input-border: #ced4da;
  --table-stripe: rgba(0, 0, 0, 0.02);
  --table-hover: rgba(0, 0, 0, 0.04);
}

[data-theme="dark"] {
  /* Dark Theme */
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --bg-card: #2a2a2a;
  --text-primary: #f8f9fa;
  --text-secondary: #adb5bd;
  --border-color: #444444;
  --card-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.3);
  --header-gradient: linear-gradient(135deg, #3a0ca3 0%, #240046 100%);
  --accent-color: #4895ef;
  --success-color: #4cc9f0;
  --warning-color: #f8961e;
  --danger-color: #f72585;
  --info-color: #4361ee;
  
  /* Component Colors */
  --input-bg: #333333;
  --input-border: #555555;
  --table-stripe: rgba(255, 255, 255, 0.03);
  --table-hover: rgba(255, 255, 255, 0.06);
}

/* Base Styles */
body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.6;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Header */
.admin-header {
  background: var(--header-gradient);
  color: white;
  padding: 2rem 0;
  margin-bottom: 2rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.admin-header h1 {
  font-weight: 700;
  letter-spacing: -0.5px;
}

/* Cards & Sections */
.admin-section {
  background: var(--bg-card);
  border-radius: 12px;
  box-shadow: var(--card-shadow);
  margin-bottom: 1.5rem;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.admin-section:hover {
  box-shadow: 0 0.75rem 2rem rgba(0, 0, 0, 0.12);
}

.section-header {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.section-header h5 {
  font-weight: 600;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

/* Stats Cards */
.stat-card {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--card-shadow);
  transition: all 0.3s ease;
  border-left: 4px solid var(--accent-color);
  height: 100%;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.15);
}

.stat-icon {
  font-size: 2.5rem;
  color: var(--accent-color);
  margin-bottom: 1rem;
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  line-height: 1.2;
}

.stat-meta {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

/* Tables */
.custom-table {
  width: 100%;
  color: var(--text-primary);
  border-collapse: separate;
  border-spacing: 0;
}

.custom-table thead th {
  background-color: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  font-weight: 600;
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 10;
}

.custom-table tbody tr {
  transition: all 0.2s ease;
}

.custom-table tbody tr:hover {
  background-color: var(--table-hover);
}

.custom-table tbody tr:nth-child(odd) {
  background-color: var(--table-stripe);
}

.custom-table tbody tr:nth-child(odd):hover {
  background-color: var(--table-hover);
}

.custom-table td {
  padding: 1rem;
  border-bottom: 1px solid var(--border-color);
  vertical-align: middle;
}

/* Forms & Inputs */
.form-control, .form-select {
  background-color: var(--input-bg);
  border: 1px solid var(--input-border);
  color: var(--text-primary);
  padding: 0.75rem 1rem;
  transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
  border-color: var(--accent-color);
  box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
  background-color: var(--input-bg);
  color: var(--text-primary);
}

.form-label {
  color: var(--text-primary);
  font-weight: 500;
}

.form-text {
  color: var(--text-secondary) !important;
}

/* Buttons */
.btn {
  font-weight: 500;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.btn-primary {
  background-color: var(--accent-color);
  border-color: var(--accent-color);
}

.btn-primary:hover {
  background-color: #3a56e8;
  border-color: #3a56e8;
  transform: translateY(-2px);
}

.btn-outline-primary {
  color: var(--accent-color);
  border-color: var(--accent-color);
}

.btn-outline-primary:hover {
  background-color: var(--accent-color);
  color: white;
}

/* Badges */
.badge {
  font-weight: 500;
  padding: 0.35em 0.65em;
  border-radius: 50rem;
  font-size: 0.75em;
  letter-spacing: 0.5px;
}

.bg-primary { background-color: var(--accent-color) !important; }
.bg-success { background-color: var(--success-color) !important; }
.bg-warning { background-color: var(--warning-color) !important; }
.bg-danger { background-color: var(--danger-color) !important; }
.bg-info { background-color: var(--info-color) !important; }

/* Tabs */
.nav-tabs {
  border-bottom: 1px solid var(--border-color);
}

.nav-tabs .nav-link {
  color: var(--text-secondary);
  border: none;
  padding: 0.75rem 1.25rem;
  font-weight: 500;
  border-bottom: 3px solid transparent;
  transition: all 0.2s ease;
}

.nav-tabs .nav-link:hover {
  color: var(--accent-color);
  border-bottom-color: rgba(67, 97, 238, 0.3);
}

.nav-tabs .nav-link.active {
  color: var(--accent-color);
  background-color: transparent;
  border-bottom-color: var(--accent-color);
}

/* Activity Feed */
.activity-item {
  padding: 1rem 0;
  border-bottom: 1px solid var(--border-color);
  transition: all 0.2s ease;
}

.activity-item:last-child {
  border-bottom: none;
}

.activity-item:hover {
  background-color: var(--table-stripe);
}

/* Charts */
.chart-container {
  position: relative;
  height: 300px;
  width: 100%;
}

[data-theme="dark"] .custom-table,
.custom-table thead,
.custom-table tbody,
.custom-table tr,
.custom-table th,
.custom-table td {
    color: var(--text-primary);
    background-color: var(--bg-card);
    border-color: var(--border-color)
}

.btn-primary {
    color: white !important;
}

/* Settings */
.setting-item {
  padding: 1.25rem;
  margin-bottom: 1rem;
  background-color: var(--bg-secondary);
  border-radius: 8px;
  border-left: 3px solid var(--accent-color);
  transition: all 0.2s ease;
}

.setting-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--card-shadow);
}

.setting-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.setting-title {
  font-weight: 600;
  color: var(--text-primary);
}

/* Toggle Switches */
.form-switch .form-check-input {
  width: 3em;
  height: 1.5em;
  margin-left: -0.5em;
  background-color: var(--input-bg);
  border-color: var(--input-border);
}

.form-switch .form-check-input:checked {
  background-color: var(--accent-color);
  border-color: var(--accent-color);
}

.form-check {
    display: flex;
    justify-content: space-between;
    align-items: center;
    align-content: center;
    flex-direction: row-reverse;
}

[data-theme="dark"] .form-switch .form-check-input {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
}

/* Global Search */
.global-search-container {
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--card-shadow);
}

.search-stats {
  background: var(--bg-card);
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
}

.search-stats .h2 {
  font-weight: 700;
  color: var(--accent-color);
}

/* Scrollbars */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
}

::-webkit-scrollbar-thumb {
  background: var(--text-secondary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-color);
}

/* Status Indicators */
.status-indicator {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 6px;
}

.status-active {
  background-color: var(--success-color);
  box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.3);
}

.status-inactive {
  background-color: var(--danger-color);
  box-shadow: 0 0 0 2px rgba(247, 37, 133, 0.3);
}

.status-pending {
  background-color: var(--warning-color);
  box-shadow: 0 0 0 2px rgba(248, 150, 30, 0.3);
}

/* Responsive Adjustments */
@media (max-width: 992px) {
  .stat-card {
    margin-bottom: 1.5rem;
  }
  
  .section-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }
}

/* Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.admin-section {
  animation: fadeIn 0.4s ease forwards;
}

/* Loading States */
.loading-spinner {
  display: inline-block;
  width: 2rem;
  height: 2rem;
  border: 0.25em solid var(--border-color);
  border-right-color: var(--accent-color);
  border-radius: 50%;
  animation: spinner 0.75s linear infinite;
}

@keyframes spinner {
  to { transform: rotate(360deg); }
}

/* Tooltips */
.tooltip-inner {
  background-color: var(--bg-card);
  color: var(--text-primary);
  box-shadow: var(--card-shadow);
  border: 1px solid var(--border-color);
}

.bs-tooltip-auto[data-popper-placement^=top] .tooltip-arrow::before,
.bs-tooltip-top .tooltip-arrow::before {
  border-top-color: var(--border-color);
}

/* Dropdowns */
.dropdown-menu {
  background-color: var(--bg-card);
  border: 1px solid var(--border-color);
  box-shadow: var(--card-shadow);
}

.dropdown-item {
  color: var(--text-primary);
  transition: all 0.2s ease;
}

.dropdown-item:hover {
  background-color: var(--table-hover);
  color: var(--accent-color);
}

.dropdown-divider {
  border-color: var(--border-color);
}

/* Modal Styling */
.modal-content {
  background-color: var(--bg-card);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
}

.modal-header {
  border-bottom-color: var(--border-color);
}

.modal-footer {
  border-top-color: var(--border-color);
}

/* Timeline */
.timeline {
  position: relative;
  padding-left: 2rem;
}

.timeline:before {
  content: '';
  position: absolute;
  left: 7px;
  top: 0;
  height: 100%;
  width: 2px;
  background: var(--border-color);
}

.timeline-item {
  position: relative;
  padding-bottom: 1.5rem;
}

.timeline-dot {
  position: absolute;
  left: -2rem;
  top: 0;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--accent-color);
  border: 3px solid var(--bg-card);
}

.timeline-content {
  border-radius: 0.5rem;
  padding: 1rem;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
}

/* Custom Utilities */
.text-accent { color: var(--accent-color) !important; }
.bg-accent { background-color: var(--accent-color) !important; }
.border-accent { border-color: var(--accent-color) !important; }

/* Smooth transitions */
a, button, .form-control, .form-select, .nav-link, .dropdown-item {
  transition: all 0.2s ease;
}

/* Focus states */
*:focus {
  outline: none;
  box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
}

/* Accessibility improvements */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="super-admin-dashboard">
    <!-- Header Section -->
    <section class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="mb-2">
                        <i class="fas fa-crown me-2"></i>Super Admin Dashboard
                    </h1>
                    <p class="mb-0 opacity-75">Complete system management and oversight</p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-cog me-2"></i>System Actions
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="sendTestEmail()">
                                <i class="fas fa-envelope me-2"></i>Send Test Email
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="optimizeDatabase()">
                                <i class="fas fa-database me-2"></i>Optimize Database
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="clearCache()">
                                <i class="fas fa-trash me-2"></i>Clear Cache
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showSystemLogs()">
                                <i class="fas fa-list me-2"></i>View System Logs
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="showImpersonateForm()">
                                <i class="fas fa-user-secret me-2"></i>Impersonate User
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showSecuritySettings()">
                                <i class="fas fa-shield-alt me-2"></i>Security Settings
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="showApiKeys()">
                                <i class="fas fa-key me-2"></i>API Key Management
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="backupSystem()">
                                <i class="fas fa-download me-2"></i>Backup System
                            </a></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="showRestoreDialog()">
                                <i class="fas fa-upload me-2"></i>Restore System
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Global Search Section -->
    <div class="global-search-container mb-4">
        <div class="card admin-section">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-9">
                        <h5 class="mb-3"><i class="fas fa-search me-2"></i>Global User Search</h5>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <select class="form-select rounded-0 rounded-start" id="global-search-type">
                                    <option value="all">All Users</option>
                                    <option value="customer">Customers</option>
                                    <option value="barber">Barbers</option>
                                    <option value="shop_owner">Shop Owners</option>
                                </select>
                            </div>
                            <input type="text" class="form-control" id="global-search-input" placeholder="Search by name, email, phone or ID...">
                            <button class="btn btn-primary" type="button" id="global-search-btn" onclick="globalSearch()">
                                <i class="fas fa-search me-1"></i>Search
                            </button>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">Recent searches: </small>
                            <div class="d-inline-block" id="recent-searches">
                                <!-- Recent searches will appear here -->
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="search-stats text-center py-2">
                            <div class="h2 mb-0" id="global-search-count">0</div>
                            <small class="text-muted">Users in database</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Stats Cards Section -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card text-center">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-store fa-3x text-primary"></i>
                    </div>
                    <h3 class="mb-1" id="total-shops">0</h3>
                    <small class="text-muted">Total Shops</small>
                    <div class="mt-2">
                        <small class="text-success">
                            <i class="fas fa-arrow-up"></i> <span id="active-shops">0</span> Active
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card text-center">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-users fa-3x text-info"></i>
                    </div>
                    <h3 class="mb-1" id="total-users">0</h3>
                    <small class="text-muted">Total Users</small>
                    <div class="mt-2">
                        <small class="text-info">
                            <i class="fas fa-user"></i> <span id="total-customers">0</span> Customers
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card text-center">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-calendar-check fa-3x text-success"></i>
                    </div>
                    <h3 class="mb-1" id="total-bookings">0</h3>
                    <small class="text-muted">Total Bookings</small>
                    <div class="mt-2">
                        <small class="text-success">
                            <i class="fas fa-chart-line"></i> <span id="today-bookings">0</span> Today
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="stat-card text-center">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-dollar-sign fa-3x text-warning"></i>
                    </div>
                    <h3 class="mb-1" id="total-revenue">$0</h3>
                    <small class="text-muted">Total Revenue</small>
                    <div class="mt-2">
                        <small class="text-warning">
                            <i class="fas fa-calendar"></i> $<span id="month-revenue">0</span> This Month
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Tabs Navigation -->
        <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>User Management
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="shops-tab" data-bs-toggle="tab" data-bs-target="#shops" type="button" role="tab">
                    <i class="fas fa-store me-2"></i>Shop Management
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings" type="button" role="tab">
                    <i class="fas fa-calendar-alt me-2"></i>Bookings
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i>Content
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                    <i class="fas fa-chart-line me-2"></i>Analytics
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button" role="tab">
                    <i class="fas fa-cogs me-2"></i>System
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="marketing-tab" data-bs-toggle="tab" data-bs-target="#marketing" type="button" role="tab">
                    <i class="fas fa-bullhorn me-2"></i>Marketing
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                    <i class="fas fa-shield-alt me-2"></i>Security
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i>Reports
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="emails-tab" data-bs-toggle="tab" data-bs-target="#emails" type="button" role="tab">
                    <i class="fas fa-envelope me-2"></i>Email Templates
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="adminTabsContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <!-- Quick Actions -->
                    <div class="col-lg-4">
                        <div class="admin-section mb-4">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                            </div>
                            <div class="p-3">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <button class="btn btn-primary w-100" onclick="showCreateUserModal()">
                                            <i class="fas fa-user-plus me-1"></i> Add User
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-success w-100" onclick="showCreateShopModal()">
                                            <i class="fas fa-store-alt me-1"></i> Add Shop
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-info w-100 text-white" onclick="showCreateServiceModal()">
                                            <i class="fas fa-cut me-1"></i> Add Service
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-warning w-100" onclick="showCreateBookingModal()">
                                            <i class="fas fa-calendar-plus me-1"></i> Add Booking
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-secondary w-100" onclick="showSendNotificationModal()">
                                            <i class="fas fa-bell me-1"></i> Notification
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-danger w-100" onclick="showMaintenanceModeModal()">
                                            <i class="fas fa-tools me-1"></i> Maintenance
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Alerts -->
                        <div class="admin-section mb-4">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>System Alerts</h5>
                            </div>
                            <div class="p-3">
                                <div class="alert alert-warning mb-2">
                                    <div class="d-flex">
                                        <div class="me-2">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <div>
                                            <div><strong>Database Optimization Required</strong></div>
                                            <div class="small">Database size has increased by 15% since last optimization</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info mb-2">
                                    <div class="d-flex">
                                        <div class="me-2">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div>
                                            <div><strong>15 New User Registrations</strong></div>
                                            <div class="small">In the last 24 hours</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-success mb-0">
                                    <div class="d-flex">
                                        <div class="me-2">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div>
                                            <div><strong>System Backup Complete</strong></div>
                                            <div class="small">Automatic backup completed successfully</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-lg-8">
                        <div class="admin-section mb-4">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Admin Actions</h5>
                            </div>
                            <div class="p-3">
                                <div class="recent-activity" id="admin-actions">
                                    <!-- Recent actions will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="admin-section mb-4">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>System Performance</h5>
                                <div>
                                    <select class="form-select form-select-sm" id="performance-period">
                                        <option value="day">Today</option>
                                        <option value="week" selected>This Week</option>
                                        <option value="month">This Month</option>
                                    </select>
                                </div>
                            </div>
                            <div class="p-3">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <div class="mini-stat">
                                            <div class="mini-stat-icon">
                                                <i class="fas fa-server"></i>
                                            </div>
                                            <div class="mini-stat-info">
                                                <p class="mini-stat-value">92.8%</p>
                                                <p class="mini-stat-label">Server Uptime</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mini-stat">
                                            <div class="mini-stat-icon">
                                                <i class="fas fa-bolt"></i>
                                            </div>
                                            <div class="mini-stat-info">
                                                <p class="mini-stat-value">450ms</p>
                                                <p class="mini-stat-label">Avg Response Time</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mini-stat">
                                            <div class="mini-stat-icon">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <div class="mini-stat-info">
                                                <p class="mini-stat-value">126</p>
                                                <p class="mini-stat-label">Active Sessions</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="performanceChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Tab -->
            <div class="tab-pane fade" id="users" role="tabpanel">
                <div class="admin-section">
                    <div class="section-header">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>User Management
                        </h5>
                    </div>
                    <div class="p-3">
                        <div class="d-flex justify-content-between mb-3">
                            <div>
                                <input type="text" class="form-control" placeholder="Search users..." id="user-search">
                            </div>
                            <div>
                                <button class="btn btn-primary btn-sm" onclick="createUser()">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive" style="max-height: 300px;">
                            <table class="table table-sm custom-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table">
                                    <!-- Users will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shop Management Tab -->
            <div class="tab-pane fade" id="shops" role="tabpanel">
                <div class="admin-section">
                    <div class="section-header">
                        <h5 class="mb-0">
                            <i class="fas fa-store me-2"></i>Shop Management
                        </h5>
                    </div>
                    <div class="p-3">
                        <div class="d-flex justify-content-between mb-3">
                            <div>
                                <input type="text" class="form-control" placeholder="Search shops..." id="shop-search">
                            </div>
                            <div>
                                <button class="btn btn-primary btn-sm" onclick="createShop()">
                                    <i class="fas fa-plus"></i> Add Shop
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive" style="max-height: 300px;">
                            <table class="table table-sm custom-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Owner</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="shops-table">
                                    <!-- Shops will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bookings Tab -->
            <div class="tab-pane fade" id="bookings" role="tabpanel">
                <div class="row mb-4">
                    <div class="col-lg-12">
                        <div class="admin-section">
                            <div class="section-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Booking Management</h5>
                                <div>
                                    <button class="btn btn-sm btn-primary" onclick="showCreateBookingModal()">
                                        <i class="fas fa-plus me-1"></i>New Booking
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="exportBookings()">
                                        <i class="fas fa-download me-1"></i>Export
                                    </button>
                                </div>
                            </div>
                            <div class="p-3">
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Search bookings..." id="booking-search">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="booking-status-filter">
                                            <option value="all">All Status</option>
                                            <option value="confirmed">Confirmed</option>
                                            <option value="pending">Pending</option>
                                            <option value="completed">Completed</option>
                                            <option value="cancelled">Cancelled</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="booking-shop-filter">
                                            <option value="all">All Shops</option>
                                            <option value="1">Elite Cuts Barbershop</option>
                                            <option value="2">Downtown Barbers</option>
                                            <option value="3">Modern Men's Salon</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            <input type="date" class="form-control" id="booking-date-filter" value="">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover custom-table">
                                        <thead>
                                            <tr>
                                                <th>Booking ID</th>
                                                <th>Customer</th>
                                                <th>Service</th>
                                                <th>Shop/Barber</th>
                                                <th>Date & Time</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bookings-table">
                                            <tr>
                                                <td>#1001</td>
                                                <td>
                                                    <div class="fw-bold">John Doe</div>
                                                    <div class="small text-muted">john@example.com</div>
                                                </td>
                                                <td>Haircut & Beard Trim</td>
                                                <td>
                                                    <div class="fw-bold">Elite Cuts Barbershop</div>
                                                    <div class="small text-muted">Michael Johnson</div>
                                                </td>
                                                <td>
                                                    <div>Jun 3, 2025</div>
                                                    <div class="small text-muted">10:30 AM</div>
                                                </td>
                                                <td><span class="badge bg-success">Confirmed</span></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="viewBookingDetails(1001)">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-primary" onclick="editBooking(1001)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-danger" onclick="cancelBooking(1001)">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>#1002</td>
                                                <td>
                                                    <div class="fw-bold">Jane Smith</div>
                                                    <div class="small text-muted">jane@example.com</div>
                                                </td>
                                                <td>Hair Coloring</td>
                                                <td>
                                                    <div class="fw-bold">Downtown Barbers</div>
                                                    <div class="small text-muted">David Thompson</div>
                                                </td>
                                                <td>
                                                    <div>Jun 3, 2025</div>
                                                    <div class="small text-muted">2:00 PM</div>
                                                </td>
                                                <td><span class="badge bg-warning">Pending</span></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="viewBookingDetails(1002)">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-primary" onclick="editBooking(1002)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-danger" onclick="cancelBooking(1002)">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>#1003</td>
                                                <td>
                                                    <div class="fw-bold">Robert Davis</div>
                                                    <div class="small text-muted">robert@example.com</div>
                                                </td>
                                                <td>Full Grooming Package</td>
                                                <td>
                                                    <div class="fw-bold">Elite Cuts Barbershop</div>
                                                    <div class="small text-muted">James Wilson</div>
                                                </td>
                                                <td>
                                                    <div>Jun 4, 2025</div>
                                                    <div class="small text-muted">11:15 AM</div>
                                                </td>
                                                <td><span class="badge bg-info">Completed</span></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="viewBookingDetails(1003)">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-primary" onclick="editBooking(1003)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-outline-danger" onclick="cancelBooking(1003)">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <nav class="mt-3">
                                    <ul class="pagination justify-content-center">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Booking Calendar -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-calendar me-2"></i>Booking Calendar</h5>
                            </div>
                            <div class="p-3">
                                <div id="bookingCalendar" style="height: 500px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Content Tab Implementation -->
            <div class="tab-pane fade" id="content" role="tabpanel">
                <div class="row mb-4">
                    <div class="col-lg-6">
                        <!-- Page Content Management -->
                        <div class="admin-section">
                            <div class="section-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Page Content</h5>
                                <button class="btn btn-sm btn-primary" onclick="showEditPageModal()">
                                    <i class="fas fa-plus me-1"></i>Add Page
                                </button>
                            </div>
                            <div class="p-3">
                                <div class="table-responsive">
                                    <table class="table table-sm custom-table">
                                        <thead>
                                            <tr>
                                                <th>Page Title</th>
                                                <th>Slug</th>
                                                <th>Last Updated</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Home</td>
                                                <td>/</td>
                                                <td>2025-06-01</td>
                                                <td><span class="badge bg-success">Published</span></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" onclick="showEditPageModal('home')"><i class="fas fa-edit"></i></button>
                                                        <button class="btn btn-outline-secondary" onclick="previewPage('home')"><i class="fas fa-eye"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>About Us</td>
                                                <td>/about</td>
                                                <td>2025-05-15</td>
                                                <td><span class="badge bg-success">Published</span></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" onclick="showEditPageModal('about')"><i class="fas fa-edit"></i></button>
                                                        <button class="btn btn-outline-secondary" onclick="previewPage('about')"><i class="fas fa-eye"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Contact</td>
                                                <td>/contact</td>
                                                <td>2025-05-20</td>
                                                <td><span class="badge bg-success">Published</span></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" onclick="showEditPageModal('contact')"><i class="fas fa-edit"></i></button>
                                                        <button class="btn btn-outline-secondary" onclick="previewPage('contact')"><i class="fas fa-eye"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <!-- Media Library -->
                        <div class="admin-section">
                            <div class="section-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-images me-2"></i>Media Library</h5>
                                <button class="btn btn-sm btn-primary" onclick="showUploadMediaModal()">
                                    <i class="fas fa-upload me-1"></i>Upload Media
                                </button>
                            </div>
                            <div class="p-3">
                                <div class="row row-cols-1 row-cols-md-4 g-3" id="media-gallery">
                                    <div class="col">
                                        <div class="card h-100">
                                            <img src="https://via.placeholder.com/150" class="card-img-top" alt="Image">
                                            <div class="card-body p-2">
                                                <p class="card-title small mb-0">hero-banner.jpg</p>
                                                <p class="card-text small text-muted">2.3 MB</p>
                                            </div>
                                            <div class="card-footer p-2">
                                                <button class="btn btn-sm btn-outline-danger w-100" onclick="deleteMedia(1)">
                                                    <i class="fas fa-trash me-1"></i>Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="card h-100">
                                            <img src="https://via.placeholder.com/150" class="card-img-top" alt="Image">
                                            <div class="card-body p-2">
                                                <p class="card-title small mb-0">barber-shop.jpg</p>
                                                <p class="card-text small text-muted">1.8 MB</p>
                                            </div>
                                            <div class="card-footer p-2">
                                                <button class="btn btn-sm btn-outline-danger w-100" onclick="deleteMedia(2)">
                                                    <i class="fas fa-trash me-1"></i>Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <!-- Controls row with advanced filters -->
                <div class="admin-section mb-4">
                    <div class="section-header">
                        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Analytics Controls</h5>
                    </div>
                    <div class="p-3">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Date Range</label>
                                <select class="form-select" id="analytics-period" onchange="refreshAnalytics()">
                                    <option value="7days">Last 7 Days</option>
                                    <option value="30days" selected>Last 30 Days</option>
                                    <option value="90days">Last 90 Days</option>
                                    <option value="year">Last Year</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            <div class="col-md-4" id="custom-date-range" style="display: none;">
                                <label class="form-label">Custom Range</label>
                                <div class="input-group">
                                    <input type="date" class="form-control" id="date-from">
                                    <span class="input-group-text">to</span>
                                    <input type="date" class="form-control" id="date-to">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Comparison</label>
                                <select class="form-select" id="analytics-compare" onchange="toggleComparisonPeriod()">
                                    <option value="none">No Comparison</option>
                                    <option value="previous">Previous Period</option>
                                    <option value="year">Same Period Last Year</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="refreshAnalytics()">
                                    <i class="fas fa-sync-alt me-1"></i> Update
                                </button>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-9">
                                <div class="d-flex gap-2 flex-wrap" id="metric-toggles">
                                    <button class="btn btn-sm btn-outline-primary active" data-metric="revenue">Revenue</button>
                                    <button class="btn btn-sm btn-outline-primary" data-metric="bookings">Bookings</button>
                                    <button class="btn btn-sm btn-outline-primary" data-metric="users">User Registrations</button>
                                    <button class="btn btn-sm btn-outline-primary" data-metric="visits">Website Visits</button>
                                    <button class="btn btn-sm btn-outline-primary" data-metric="conversion">Conversion Rate</button>
                                </div>
                            </div>
                            <div class="col-md-3 text-end">
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="exportAnalyticsData('csv')">
                                        <i class="fas fa-file-csv me-1"></i> CSV
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="exportAnalyticsData('json')">
                                        <i class="fas fa-file-code me-1"></i> JSON
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="exportAnalyticsData('pdf')">
                                        <i class="fas fa-file-pdf me-1"></i> PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main analytics dashboard -->
                <div class="row mb-4">
                    <!-- Key metrics summary -->
                    <div class="col-12 mb-4">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Key Metrics Summary</h5>
                            </div>
                            <div class="p-3">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <div class="card h-100 bg-light border-0">
                                            <div class="card-body">
                                                <h6 class="card-subtitle mb-2 text-muted">Total Revenue</h6>
                                                <h3 class="card-title mb-0">$125,430</h3>
                                                <div class="d-flex align-items-center mt-2">
                                                    <i class="fas fa-arrow-up text-success me-1"></i>
                                                    <span class="text-success">+12.3%</span>
                                                    <small class="text-muted ms-2">vs previous</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="card h-100 bg-light border-0">
                                            <div class="card-body">
                                                <h6 class="card-subtitle mb-2 text-muted">Bookings</h6>
                                                <h3 class="card-title mb-0">3,421</h3>
                                                <div class="d-flex align-items-center mt-2">
                                                    <i class="fas fa-arrow-up text-success me-1"></i>
                                                    <span class="text-success">+8.7%</span>
                                                    <small class="text-muted ms-2">vs previous</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="card h-100 bg-light border-0">
                                            <div class="card-body">
                                                <h6 class="card-subtitle mb-2 text-muted">New Users</h6>
                                                <h3 class="card-title mb-0">1,248</h3>
                                                <div class="d-flex align-items-center mt-2">
                                                    <i class="fas fa-arrow-up text-success me-1"></i>
                                                    <span class="text-success">+15.2%</span>
                                                    <small class="text-muted ms-2">vs previous</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="card h-100 bg-light border-0">
                                            <div class="card-body">
                                                <h6 class="card-subtitle mb-2 text-muted">Conversion Rate</h6>
                                                <h3 class="card-title mb-0">5.4%</h3>
                                                <div class="d-flex align-items-center mt-2">
                                                    <i class="fas fa-arrow-down text-danger me-1"></i>
                                                    <span class="text-danger">-0.8%</span>
                                                    <small class="text-muted ms-2">vs previous</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main chart -->
                    <div class="col-lg-8 mb-4">
                        <div class="admin-section h-100">
                            <div class="section-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Revenue Trends</h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-secondary active">Day</button>
                                    <button type="button" class="btn btn-outline-secondary">Week</button>
                                    <button type="button" class="btn btn-outline-secondary">Month</button>
                                </div>
                            </div>
                            <div class="p-3">
                                <div class="chart-container" style="position: relative; height: 350px;">
                                    <canvas id="mainAnalyticsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue breakdown -->
                    <div class="col-lg-4 mb-4">
                        <div class="admin-section h-100">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Revenue Breakdown</h5>
                            </div>
                            <div class="p-3">
                                <div class="chart-container" style="position: relative; height: 200px;">
                                    <canvas id="revenuePieChart"></canvas>
                                </div>
                                <div class="mt-4">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Haircuts</span>
                                        <span>$42,148 (33.6%)</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 10px;">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 33.6%"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Styling</span>
                                        <span>$35,128 (28%)</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 10px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 28%"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Coloring</span>
                                        <span>$28,234 (22.5%)</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 10px;">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: 22.5%"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Products</span>
                                        <span>$19,920 (15.9%)</span>
                                    </div>
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 15.9%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secondary analytics row -->
                <div class="row">
                    <!-- Customer Demographics -->
                    <div class="col-lg-6 mb-4">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-users me-2"></i>Customer Demographics</h5>
                            </div>
                            <div class="p-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Age Distribution</h6>
                                        <div class="chart-container" style="position: relative; height: 200px;">
                                            <canvas id="ageDistributionChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Gender</h6>
                                        <div class="chart-container" style="position: relative; height: 200px;">
                                            <canvas id="genderChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <h6 class="mb-3">Customer Acquisition</h6>
                                        <div class="chart-container" style="position: relative; height: 200px;">
                                            <canvas id="acquisitionChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Popularity -->
                    <div class="col-lg-6 mb-4">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-cut me-2"></i>Service Popularity</h5>
                            </div>
                            <div class="p-3">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Bookings</th>
                                                <th>Revenue</th>
                                                <th>Trend</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Classic Haircut</td>
                                                <td>1,248</td>
                                                <td>$24,960</td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>12%</span></td>
                                            </tr>
                                            <tr>
                                                <td>Beard Trim</td>
                                                <td>982</td>
                                                <td>$9,820</td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>8%</span></td>
                                            </tr>
                                            <tr>
                                                <td>Hair Coloring</td>
                                                <td>645</td>
                                                <td>$19,350</td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>15%</span></td>
                                            </tr>
                                            <tr>
                                                <td>Styling</td>
                                                <td>487</td>
                                                <td>$12,175</td>
                                                <td><span class="text-danger"><i class="fas fa-arrow-down me-1"></i>3%</span></td>
                                            </tr>
                                            <tr>
                                                <td>Full Package</td>
                                                <td>385</td>
                                                <td>$17,325</td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>22%</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="chart-container mt-3" style="position: relative; height: 250px;">
                                    <canvas id="servicePopularityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Shop Performance Analytics -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-store me-2"></i>Shop Performance</h5>
                            </div>
                            <div class="p-3">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Shop</th>
                                                <th>Bookings</th>
                                                <th>Revenue</th>
                                                <th>Avg. Rating</th>
                                                <th>Growth</th>
                                                <th>Occupancy</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Elite Cuts Barbershop</td>
                                                <td>1,245</td>
                                                <td>$42,330</td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div>4.8</div>
                                                        <div class="ms-2">
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star-half-alt text-warning"></i>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>18.5%</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 85%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Downtown Barbers</td>
                                                <td>987</td>
                                                <td>$35,532</td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div>4.6</div>
                                                        <div class="ms-2">
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star-half-alt text-warning"></i>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>12.3%</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 78%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Modern Men's Salon</td>
                                                <td>876</td>
                                                <td>$29,784</td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div>4.3</div>
                                                        <div class="ms-2">
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="far fa-star text-warning"></i>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><span class="text-danger"><i class="fas fa-arrow-down me-1"></i>2.1%</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 65%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>The Gentlemen's Place</td>
                                                <td>654</td>
                                                <td>$22,236</td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div>4.9</div>
                                                        <div class="ms-2">
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                            <i class="fas fa-star text-warning"></i>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><span class="text-success"><i class="fas fa-arrow-up me-1"></i>24.8%</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 70%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Settings Tab -->
            <div class="tab-pane fade" id="system" role="tabpanel">
                <div class="admin-section">
                    <div class="section-header">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs me-2"></i>System Settings
                        </h5>
                    </div>
                    <div class="p-3 settings-section">
                        <form id="settings-form">
                            <div class="setting-item">
                                <div class="setting-header">
                                    <label class="setting-title" for="setting_email_notifications_enabled">
                                        Email Notifications
                                    </label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" 
                                                id="setting_email_notifications_enabled" 
                                                name="email_notifications_enabled" checked>
                                    </div>
                                </div>
                                <div class="form-text">
                                    Enable or disable all email notifications to users
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-header">
                                    <label class="setting-title" for="setting_auto_assign_barbers">
                                        Auto Assign Barbers
                                    </label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" 
                                                id="setting_auto_assign_barbers" 
                                                name="auto_assign_barbers">
                                    </div>
                                </div>
                                <div class="form-text">
                                    Automatically assign barbers to bookings when none selected
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-header">
                                    <label class="setting-title" for="setting_site_name">
                                        Site Name
                                    </label>
                                </div>
                                <input type="text" class="form-control" 
                                        id="setting_site_name" 
                                        name="site_name"
                                        value="Barber Booking System">
                                <div class="form-text">
                                    The name displayed in the browser tab and emails
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-header">
                                    <label class="setting-title" for="setting_contact_email">
                                        Contact Email
                                    </label>
                                </div>
                                <input type="text" class="form-control" 
                                        id="setting_contact_email" 
                                        name="contact_email"
                                        value="contact@barberbooking.com">
                                <div class="form-text">
                                    Email address displayed on contact pages
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-header">
                                    <label class="setting-title" for="setting_booking_buffer_minutes">
                                        Booking Buffer (minutes)
                                    </label>
                                </div>
                                <input type="number" class="form-control" 
                                        id="setting_booking_buffer_minutes" 
                                        name="booking_buffer_minutes"
                                        value="15" min="0" max="60">
                                <div class="form-text">
                                    Minimum minutes required between bookings
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-save me-2"></i>Save Settings
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Security Tab -->
            <div class="tab-pane fade" id="security" role="tabpanel">
                <!-- Security Dashboard Overview -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Security Status</h5>
                            </div>
                            <div class="p-3">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light h-100">
                                            <div class="card-body">
                                                <h5 class="card-title d-flex justify-content-between">
                                                    <span>System</span>
                                                    <span class="badge bg-success">Secure</span>
                                                </h5>
                                                <ul class="list-unstyled mb-0">
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>SSL Active</span>
                                                    </li>
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Firewall Active</span>
                                                    </li>
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Software Updated</span>
                                                    </li>
                                                    <li class="d-flex align-items-center">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>CSRF Protection</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light h-100">
                                            <div class="card-body">
                                                <h5 class="card-title d-flex justify-content-between">
                                                    <span>Access</span>
                                                    <span class="badge bg-warning">Warning</span>
                                                </h5>
                                                <ul class="list-unstyled mb-0">
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Login Protection</span>
                                                    </li>
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Role-Based Access</span>
                                                    </li>
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                                        <span>2FA Partially Enabled</span>
                                                    </li>
                                                    <li class="d-flex align-items-center">
                                                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                                        <span>3 Admin Without 2FA</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light h-100">
                                            <div class="card-body">
                                                <h5 class="card-title d-flex justify-content-between">
                                                    <span>Data</span>
                                                    <span class="badge bg-success">Secure</span>
                                                </h5>
                                                <ul class="list-unstyled mb-0">
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Encryption Active</span>
                                                    </li>
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Backups Current</span>
                                                    </li>
                                                    <li class="d-flex align-items-center mb-2">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>GDPR Compliant</span>
                                                    </li>
                                                    <li class="d-flex align-items-center">
                                                        <i class="fas fa-check-circle text-success me-2"></i>
                                                        <span>Data Sanitization</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Security Health</h5>
                            </div>
                            <div class="p-3">
                                <div class="text-center mb-3">
                                    <div class="position-relative d-inline-block">
                                        <canvas id="securityHealthChart" width="180" height="180"></canvas>
                                        <div class="position-absolute top-50 start-50 translate-middle">
                                            <h2 class="mb-0 fw-bold">92</h2>
                                            <span>of 100</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>Overall Security Score</span>
                                        <span class="fw-bold">92/100</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 8px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 92%"></div>
                                    </div>
                                    <div class="d-flex justify-content-between small mb-3">
                                        <span class="text-success">
                                            <i class="fas fa-arrow-up me-1"></i> 6 points since last month
                                        </span>
                                        <a href="#" onclick="runSecurityScan()">Run New Scan</a>
                                    </div>
                                    <div class="alert alert-warning small">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        <strong>2 issues</strong> need your attention.
                                        <a href="#security-issues">View details</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="admin-section">
                            <div class="section-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-user-shield me-2"></i>Login Activity</h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary active">Today</button>
                                    <button class="btn btn-outline-secondary">Week</button>
                                    <button class="btn btn-outline-secondary">Month</button>
                                </div>
                            </div>
                            <div class="p-3">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Time</th>
                                                <th>IP Address</th>
                                                <th>Location</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-small bg-primary text-white rounded-circle me-2">
                                                            <i class="fas fa-user"></i>
                                                        </div>
                                                        <div>admin@example.com</div>
                                                    </div>
                                                </td>
                                                <td>06/03/2025 10:42 AM</td>
                                                <td>192.168.1.105</td>
                                                <td>New York, US</td>
                                                <td><span class="badge bg-success">Success</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-info-circle"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr class="table-warning">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-small bg-warning text-white rounded-circle me-2">
                                                            <i class="fas fa-user"></i>
                                                        </div>
                                                        <div>john@example.com</div>
                                                    </div>
                                                </td>
                                                <td>06/03/2025 10:15 AM</td>
                                                <td>128.53.42.12</td>
                                                <td>Budapest, HU</td>
                                                <td><span class="badge bg-warning">Unusual Location</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-info-circle"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr class="table-danger">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-small bg-danger text-white rounded-circle me-2">
                                                            <i class="fas fa-user"></i>
                                                        </div>
                                                        <div>sarah@example.com</div>
                                                    </div>
                                                </td>
                                                <td>06/03/2025 09:52 AM</td>
                                                <td>45.32.118.245</td>
                                                <td>Bangkok, TH</td>
                                                <td><span class="badge bg-danger">Failed</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-info-circle"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-small bg-primary text-white rounded-circle me-2">
                                                            <i class="fas fa-user"></i>
                                                        </div>
                                                        <div>mark@example.com</div>
                                                    </div>
                                                </td>
                                                <td>06/03/2025 09:30 AM</td>
                                                <td>192.168.1.103</td>
                                                <td>Seattle, US</td>
                                                <td><span class="badge bg-success">Success</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-info-circle"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-small bg-primary text-white rounded-circle me-2">
                                                            <i class="fas fa-user"></i>
                                                        </div>
                                                        <div>jessica@example.com</div>
                                                    </div>
                                                </td>
                                                <td>06/03/2025 08:15 AM</td>
                                                <td>192.168.1.101</td>
                                                <td>Los Angeles, US</td>
                                                <td><span class="badge bg-success">Success</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-info-circle"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="admin-section">
                            <div class="section-header">
                                <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Security Issues</h5>
                            </div>
                            <div class="p-3" id="security-issues">
                                <div class="alert alert-warning mb-3">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="alert-heading mb-1">Missing Two-Factor Authentication</h6>
                                            <p class="mb-1">3 admin users do not have 2FA enabled.</p>
                                            <div>
                                                <button class="btn btn-sm btn-warning mt-2" onclick="enforceTwoFactor()">
                                                    Enforce 2FA
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-warning mb-3">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="alert-heading mb-1">Outdated Password Policy</h6>
                                            <p class="mb-1">15 users have passwords older than 90 days.</p>
                                            <div>
                                                <button class="btn btn-sm btn-warning mt-2" onclick="enforcePasswordReset()">
                                                    Force Password Reset
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-success mb-3">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <i class="fas fa-check-circle fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="alert-heading mb-1">SSL Certificate Valid</h6>
                                            <p class="mb-0">Certificate is valid for 280 more days.</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-success mb-0">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <i class="fas fa-check-circle fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="alert-heading mb-1">Backup System Working</h6>
                                            <p class="mb-0">Last successful backup: 06/02/2025 11:30 PM</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Configuration Tabs -->
                <div class="admin-section mb-4">
                    <div class="section-header">
                        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Security Configuration</h5>
                    </div>
                    <div class="p-3">
                        <ul class="nav nav-tabs mb-3" id="securityConfigTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="passwords-tab" data-bs-toggle="tab" data-bs-target="#passwords" type="button" role="tab">
                                    Password Policy
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="twoFactor-tab" data-bs-toggle="tab" data-bs-target="#twoFactor" type="button" role="tab">
                                    Two-Factor Auth
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="apiSecurity-tab" data-bs-toggle="tab" data-bs-target="#apiSecurity" type="button" role="tab">
                                    API Security
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="ipBlocking-tab" data-bs-toggle="tab" data-bs-target="#ipBlocking" type="button" role="tab">
                                    IP Blocking
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="sessionPolicy-tab" data-bs-toggle="tab" data-bs-target="#sessionPolicy" type="button" role="tab">
                                    Session Policy
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="securityConfigContent">
                            <!-- Password Policy Tab -->
                            <div class="tab-pane fade show active" id="passwords" role="tabpanel">
                                <form>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Minimum Password Length</label>
                                                </div>
                                                <input type="number" class="form-control" name="min_password_length" value="10" min="6" max="20">
                                                <div class="form-text">Minimum number of characters required for passwords</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Password Expiration</label>
                                                </div>
                                                <input type="number" class="form-control" name="password_expiration" value="90" min="0" max="365">
                                                <div class="form-text">Days before passwords expire (0 = never expire)</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Maximum Login Attempts</label>
                                                </div>
                                                <input type="number" class="form-control" name="max_login_attempts" value="5" min="3" max="10">
                                                <div class="form-text">Number of failed attempts before account lockout</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Lockout Period</label>
                                                </div>
                                                <input type="number" class="form-control" name="lockout_period" value="30" min="5" max="1440">
                                                <div class="form-text">Minutes an account remains locked after max failed logins</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header d-flex justify-content-between">
                                                    <label class="setting-title">Require Uppercase Letters</label>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" name="require_uppercase" id="require_uppercase" checked>
                                                    </div>
                                                </div>
                                                <div class="form-text">Passwords must include at least one uppercase letter</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header d-flex justify-content-between">
                                                    <label class="setting-title">Require Numbers</label>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" name="require_numbers" id="require_numbers" checked>
                                                    </div>
                                                </div>
                                                <div class="form-text">Passwords must include at least one number</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header d-flex justify-content-between">
                                                    <label class="setting-title">Require Special Characters</label>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" name="require_special" id="require_special" checked>
                                                    </div>
                                                </div>
                                                <div class="form-text">Passwords must include at least one special character</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header d-flex justify-content-between">
                                                    <label class="setting-title">Prevent Password Reuse</label>
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" name="prevent_reuse" id="prevent_reuse" checked>
                                                    </div>
                                                </div>
                                                <div class="form-text">Prevent reusing any of the last 5 passwords</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Save Password Policy</button>
                                </form>
                            </div>
                            
                            <!-- Two-Factor Authentication Tab -->
                            <div class="tab-pane fade" id="twoFactor" role="tabpanel">
                                <form>
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Enable Two-Factor Authentication</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="enable_2fa" id="enable_2fa" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Allow users to secure their accounts with 2FA</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Required for Admin Users</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="require_2fa_admin" id="require_2fa_admin" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Force admin users to set up 2FA on next login</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header">
                                            <label class="setting-title">2FA Provider</label>
                                        </div>
                                        <select class="form-select" name="2fa_provider">
                                            <option value="app" selected>Authenticator App (TOTP)</option>
                                            <option value="email">Email OTP</option>
                                            <option value="sms">SMS OTP</option>
                                        </select>
                                        <div class="form-text">Primary method for two-factor authentication</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Allow Backup Codes</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="allow_backup_codes" id="allow_backup_codes" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Allow users to generate one-time backup codes</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Remember Device</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="remember_device" id="remember_device" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Allow users to remember devices for 30 days</div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Save 2FA Settings</button>
                                </form>
                            </div>
                            
                            <!-- API Security Tab -->
                            <div class="tab-pane fade" id="apiSecurity" role="tabpanel">
                                <form>
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">API Rate Limiting</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="api_rate_limiting" id="api_rate_limiting" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Limit API requests to prevent abuse</div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Max Requests Per Minute</label>
                                                </div>
                                                <input type="number" class="form-control" name="max_requests" value="60" min="10" max="1000">
                                                <div class="form-text">Maximum API requests allowed per minute per client</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">API Key Expiration</label>
                                                </div>
                                                <input type="number" class="form-control" name="api_key_expiration" value="90" min="0" max="365">
                                                <div class="form-text">Days before API keys expire (0 = never expire)</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">API Access Logging</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="api_logging" id="api_logging" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Log all API access for security monitoring</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">CORS Restrictions</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="cors_restrictions" id="cors_restrictions" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Restrict API access to allowed domains only</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header">
                                            <label class="setting-title">Allowed Origins</label>
                                        </div>
                                        <textarea class="form-control" name="allowed_origins" rows="3">https://example.com
            https://app.example.com
            https://admin.example.com</textarea>
                                        <div class="form-text">List of domains allowed to access the API (one per line)</div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Save API Security Settings</button>
                                </form>
                            </div>
                            
                            <!-- IP Blocking Tab -->
                            <div class="tab-pane fade" id="ipBlocking" role="tabpanel">
                                <div class="row mb-4">
                                    <div class="col-md-7">
                                        <div class="setting-item">
                                            <div class="setting-header">
                                                <label class="setting-title">IP Blocking Rules</label>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>IP Address/Range</th>
                                                            <th>Rule Type</th>
                                                            <th>Reason</th>
                                                            <th>Date Added</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>192.168.1.100</td>
                                                            <td><span class="badge bg-danger">Block</span></td>
                                                            <td>Multiple failed login attempts</td>
                                                            <td>Jun 1, 2025</td>
                                                            <td>
                                                                <button class="btn btn-sm btn-outline-danger">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>103.42.55.0/24</td>
                                                            <td><span class="badge bg-danger">Block</span></td>
                                                            <td>Suspicious activity</td>
                                                            <td>May 28, 2025</td>
                                                            <td>
                                                                <button class="btn btn-sm btn-outline-danger">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>10.0.0.0/8</td>
                                                            <td><span class="badge bg-success">Allow</span></td>
                                                            <td>Internal network</td>
                                                            <td>May 15, 2025</td>
                                                            <td>
                                                                <button class="btn btn-sm btn-outline-danger">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="setting-item">
                                            <div class="setting-header">
                                                <label class="setting-title">Add IP Blocking Rule</label>
                                            </div>
                                            <form>
                                                <div class="mb-3">
                                                    <label class="form-label">IP Address/Range</label>
                                                    <input type="text" class="form-control" name="ip_address" placeholder="e.g. 192.168.1.1 or 192.168.1.0/24">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Rule Type</label>
                                                    <select class="form-select" name="rule_type">
                                                        <option value="block">Block</option>
                                                        <option value="allow">Allow</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Reason</label>
                                                    <input type="text" class="form-control" name="reason" placeholder="Reason for blocking/allowing">
                                                </div>
                                                <button type="submit" class="btn btn-primary">Add IP Rule</button>
                                            </form>
                                        </div>
                                        <div class="setting-item mt-3">
                                            <div class="setting-header d-flex justify-content-between">
                                                <label class="setting-title">Auto-Block Failed Logins</label>
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" name="auto_block" id="auto_block" checked>
                                                </div>
                                            </div>
                                            <div class="form-text mb-3">Automatically block IPs with multiple failed login attempts</div>
                                            
                                            <label class="form-label">Failed Attempts Threshold</label>
                                            <input type="number" class="form-control" name="failed_threshold" value="5" min="3" max="20">
                                            <div class="form-text">Number of failed attempts before auto-blocking</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Session Policy Tab -->
                            <div class="tab-pane fade" id="sessionPolicy" role="tabpanel">
                                <form>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Session Timeout (minutes)</label>
                                                </div>
                                                <input type="number" class="form-control" name="session_timeout" value="60" min="5" max="1440">
                                                <div class="form-text">Time of inactivity before users are automatically logged out</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-item">
                                                <div class="setting-header">
                                                    <label class="setting-title">Remember Me Duration (days)</label>
                                                </div>
                                                <input type="number" class="form-control" name="remember_me_duration" value="30" min="1" max="365">
                                                <div class="form-text">How long "Remember Me" cookies remain valid</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Enforce Single Session</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="single_session" id="single_session">
                                            </div>
                                        </div>
                                        <div class="form-text">Prevent users from having multiple active sessions</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Force HTTPS</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="force_https" id="force_https" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Redirect all HTTP traffic to HTTPS</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header d-flex justify-content-between">
                                            <label class="setting-title">Secure Cookies</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="secure_cookies" id="secure_cookies" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Use secure and HTTP-only flags for cookies</div>
                                    </div>
                                    
                                    <div class="setting-item mb-3">
                                        <div class="setting-header">
                                            <label class="setting-title">SameSite Cookie Policy</label>
                                        </div>
                                        <select class="form-select" name="samesite_policy">
                                            <option value="strict">Strict</option>
                                            <option value="lax" selected>Lax</option>
                                            <option value="none">None</option>
                                        </select>
                                        <div class="form-text">Controls how cookies are sent in cross-site requests</div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Save Session Policy</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab Implementation -->
            <div class="tab-pane fade" id="reports" role="tabpanel">
                <!-- Report Controls -->
                <div class="admin-section mb-4">
                    <div class="section-header">
                        <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Generate Reports</h5>
                    </div>
                    <div class="p-3">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label class="form-label">Report Type</label>
                                    <select class="form-select" id="report-type">
                                        <option value="revenue">Revenue Report</option>
                                        <option value="bookings">Bookings Report</option>
                                        <option value="user-activity">User Activity Report</option>
                                        <option value="shop-performance">Shop Performance Report</option>
                                        <option value="barber-performance">Barber Performance Report</option>
                                        <option value="service-popularity">Service Popularity Report</option>
                                        <option value="custom">Custom Report</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label class="form-label">Date Range</label>
                                    <select class="form-select" id="report-period">
                                        <option value="today">Today</option>
                                        <option value="yesterday">Yesterday</option>
                                        <option value="week">This Week</option>
                                        <option value="month" selected>This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-5" id="custom-date-report-range" style="display: none;">
                                <div class="form-group mb-3">
                                    <label class="form-label">Custom Date Range</label>
                                    <div class="input-group">
                                        <input type="date" class="form-control" id="report-date-from">
                                        <span class="input-group-text">to</span>
                                        <input type="date" class="form-control" id="report-date-to">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label class="form-label">Group By</label>
                                    <select class="form-select" id="report-grouping">
                                        <option value="day">Day</option>
                                        <option value="week">Week</option>
                                        <option value="month" selected>Month</option>
                                        <option value="shop">Shop</option>
                                        <option value="barber">Barber</option>
                                        <option value="service">Service</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label class="form-label">Format</label>
                                    <select class="form-select" id="report-format">
                                        <option value="html">HTML (View in browser)</option>
                                        <option value="csv">CSV (Excel)</option>
                                        <option value="pdf">PDF Document</option>
                                        <option value="json">JSON Data</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="generateReport()">
                                    <i class="fas fa-file-download me-2"></i>Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Saved Reports -->
                <div class="admin-section mb-4">
                    <div class="section-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-save me-2"></i>Saved Reports</h5>
                        <div class="d-flex gap-2">
                            <div class="input-group input-group-sm">
                                <input type="text" class="form-control" placeholder="Search reports...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table custom-table">
                            <thead>
                                <tr>
                                    <th>Report Name</th>
                                    <th>Type</th>
                                    <th>Created</th>
                                    <th>Date Range</th>
                                    <th>Created By</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Monthly Revenue Q2 2025</td>
                                    <td>Revenue Report</td>
                                    <td>06/01/2025</td>
                                    <td>04/01/2025 - 06/30/2025</td>
                                    <td>admin@example.com</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="viewReport('monthly-revenue-q2-2025')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary" onclick="downloadReport('monthly-revenue-q2-2025', 'pdf')">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteReport('monthly-revenue-q2-2025')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Barber Performance 2025</td>
                                    <td>Barber Performance</td>
                                    <td>05/15/2025</td>
                                    <td>01/01/2025 - 05/15/2025</td>
                                    <td>manager@example.com</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="viewReport('barber-performance-2025')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary" onclick="downloadReport('barber-performance-2025', 'pdf')">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteReport('barber-performance-2025')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Service Popularity Analysis</td>
                                    <td>Service Popularity</td>
                                    <td>04/28/2025</td>
                                    <td>01/01/2025 - 04/28/2025</td>
                                    <td>admin@example.com</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="viewReport('service-popularity-analysis')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary" onclick="downloadReport('service-popularity-analysis', 'pdf')">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteReport('service-popularity-analysis')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Scheduled Reports -->
                <div class="admin-section">
                    <div class="section-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Scheduled Reports</h5>
                        <button class="btn btn-sm btn-primary" onclick="showScheduleReportModal()">
                            <i class="fas fa-plus me-1"></i>Schedule New Report
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table custom-table">
                            <thead>
                                <tr>
                                    <th>Report Name</th>
                                    <th>Type</th>
                                    <th>Frequency</th>
                                    <th>Next Run</th>
                                    <th>Recipients</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Weekly Revenue Summary</td>
                                    <td>Revenue Report</td>
                                    <td>Weekly (Monday)</td>
                                    <td>06/10/2025</td>
                                    <td>2 recipients</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="editScheduledReport('weekly-revenue')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="toggleScheduledReport('weekly-revenue')">
                                                <i class="fas fa-pause"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteScheduledReport('weekly-revenue')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Monthly Bookings Report</td>
                                    <td>Bookings Report</td>
                                    <td>Monthly (1st)</td>
                                    <td>07/01/2025</td>
                                    <td>3 recipients</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="editScheduledReport('monthly-bookings')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="toggleScheduledReport('monthly-bookings')">
                                                <i class="fas fa-pause"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteScheduledReport('monthly-bookings')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Quarterly Performance Review</td>
                                    <td>Shop Performance</td>
                                    <td>Quarterly</td>
                                    <td>07/01/2025</td>
                                    <td>5 recipients</td>
                                    <td><span class="badge bg-warning">Paused</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="editScheduledReport('quarterly-performance')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-success" onclick="toggleScheduledReport('quarterly-performance')">
                                                <i class="fas fa-play"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteScheduledReport('quarterly-performance')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Email Logs Tab -->
            <div class="tab-pane fade" id="emails" role="tabpanel">
                <div class="admin-section">
                    <div class="section-header">
                        <h5 class="mb-0">
                            <i class="fas fa-envelope me-2"></i>Email Logs
                        </h5>
                    </div>
                    <div class="p-3">
                        <div class="table-responsive">
                            <table class="table custom-table">
                                <thead>
                                    <tr>
                                        <th>Recipient</th>
                                        <th>Subject</th>
                                        <th>Status</th>
                                        <th>Sent At</th>
                                        <th>Error</th>
                                    </tr>
                                </thead>
                                <tbody id="email-logs">
                                    <!-- Email logs will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Newsletter Management Tab -->
            <div class="tab-pane fade" id="marketing" role="tabpanel">
                <div class="admin-section">
                    <div class="section-header">
                        <h4 class="mb-0">
                            <i class="fas fa-envelope me-2"></i>Newsletter Subscribers
                        </h4>
                        <div class="d-flex gap-2">
                            <button class="btn btn-success btn-sm" onclick="exportSubscribers()">
                                <i class="fas fa-download me-1"></i>Export CSV
                            </button>
                            <button class="btn btn-info btn-sm" onclick="refreshSubscribers()">
                                <i class="fas fa-sync me-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped custom-table" id="subscribersTable">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Name</th>
                                    <th>Subscribed At</th>
                                    <th>IP Address</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="subscribersTableBody">
                                <tr>
                                    <td colspan="5" class="text-center">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <div class="mt-2">Loading subscribers...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
                                 
{% block scripts %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize all event listeners and load initial data
        initializeAdminDashboard();
    });

    function initializeAdminDashboard() {
        // Real-time updates
        setInterval(updateStats, 30000); // Update every 30 seconds
        
        // Settings form
        document.getElementById('settings-form')?.addEventListener('submit', saveSettings);

         // Search functionality
        document.getElementById('user-search')?.addEventListener('input', searchUsers);
        document.getElementById('shop-search')?.addEventListener('input', searchShops);
        
        // Search functionality
        document.getElementById('user-search')?.addEventListener('input', searchUsers);
        document.getElementById('shop-search')?.addEventListener('input', searchShops);
        
        // Initialize booking calendar when bookings tab is shown
        document.getElementById('bookings-tab')?.addEventListener('click', function() {
            setTimeout(() => {
                if (!window.bookingCalendarInitialized) {
                    initializeBookingCalendar();
                    window.bookingCalendarInitialized = true;
                }
            }, 100);
        });
        
        // Initialize global search
        updateRecentSearchesDisplay();
        document.getElementById('global-search-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                globalSearch();
            }
        });
        
        // Load user count for stats
        fetch('/api/super-admin/user-count')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('global-search-count').textContent = data.count.toLocaleString();
                }
            })
            .catch(error => console.error('Error loading user count:', error));
        
        // Initialize analytics tab when shown
        document.getElementById('analytics-tab')?.addEventListener('click', function() {
            setTimeout(() => {
                if (!window.analyticsInitialized) {
                    updateAnalyticsCharts();
                    window.analyticsInitialized = true;
                }
            }, 100);
        });
        
        // Show custom date range when custom is selected
        document.getElementById('analytics-period')?.addEventListener('change', function() {
            const customRangeDiv = document.getElementById('custom-date-range');
            if (this.value === 'custom') {
                customRangeDiv.style.display = 'block';
            } else {
                customRangeDiv.style.display = 'none';
            }
        });
    }

    // ========== STATISTICS FUNCTIONS ==========
    async function updateStats() {
        try {
            const response = await fetch('/api/super-admin/stats');
            const stats = await response.json();
            
            document.getElementById('total-shops').textContent = stats.total_shops;
            document.getElementById('total-users').textContent = stats.total_users;
            document.getElementById('total-bookings').textContent = stats.total_bookings;
            document.getElementById('total-revenue').textContent = `$${stats.total_revenue}`;
        } catch (error) {
            console.error('Error updating stats:', error);
        }
    }

    // ========== SETTINGS FUNCTIONS ==========
    async function saveSettings(e) {
        e.preventDefault();
        
        const form = e.target;
        const submitButton = form.querySelector('button[type="submit"]');
        const originalText = submitButton.innerHTML;
        
        // Show saving state
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
        submitButton.disabled = true;
        
        const formData = new FormData(form);
        const settings = {};
        
        for (let [key, value] of formData.entries()) {
            settings[key] = value;
        }
        
        // Handle checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            if (!formData.has(checkbox.name)) {
                settings[checkbox.name] = 'false';
            } else {
                settings[checkbox.name] = 'true';
            }
        });
        
        try {
            const response = await fetch('/api/super-admin/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            });
            
            if (response.ok) {
                // Show success state
                submitButton.innerHTML = '<i class="fas fa-check me-2"></i>Saved';
                submitButton.classList.replace('btn-primary', 'btn-success');
                
                showNotification('Settings saved successfully!', 'success');
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    submitButton.innerHTML = originalText;
                    submitButton.classList.replace('btn-success', 'btn-primary');
                    submitButton.disabled = false;
                }, 2000);
            } else {
                throw new Error('Failed to save settings');
            }
        } catch (error) {
            // Show error state
            submitButton.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>Error';
            submitButton.classList.replace('btn-primary', 'btn-danger');
            
            showNotification('Error saving settings', 'error');
            
            // Reset button after 2 seconds
            setTimeout(() => {
                submitButton.innerHTML = originalText;
                submitButton.classList.replace('btn-danger', 'btn-primary');
                submitButton.disabled = false;
            }, 2000);
        }
    }

    // ========== USER/SHOP MANAGEMENT ==========
    async function toggleUserStatus(userId, currentStatus) {
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
        
        try {
            const response = await fetch(`/api/super-admin/users/${userId}/status`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: newStatus })
            });
            
            if (response.ok) {
                location.reload();
            }
        } catch (error) {
            showNotification('Error updating user status', 'error');
        }
    }

    async function toggleShopStatus(shopId, currentStatus) {
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
        
        try {
            const response = await fetch(`/api/super-admin/shops/${shopId}/status`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: newStatus })
            });
            
            if (response.ok) {
                location.reload();
            }
        } catch (error) {
            showNotification('Error updating shop status', 'error');
        }
    }

    // Recent Admin Actions functionality
    function loadRecentAdminActions() {
        const actionsContainer = document.getElementById('admin-actions');
        if (!actionsContainer) return;
        
        // This would typically be an API call to fetch recent actions
        // For demonstration, using mock data that resembles what would come from the AdminAction model
        const mockActions = [
            {
                id: 1001,
                admin_id: 1,
                first_name: 'Admin',
                last_name: 'User',
                action_type: 'create',
                target_type: 'user',
                target_id: 42,
                description: 'Created new barber account for Michael Johnson',
                created_at: '2025-06-03 11:45:23',
                ip_address: '192.168.1.105'
            },
            {
                id: 1002,
                admin_id: 1,
                first_name: 'Admin',
                last_name: 'User',
                action_type: 'update',
                target_type: 'shop',
                target_id: 15,
                description: 'Updated business hours for "Downtown Barbers"',
                created_at: '2025-06-03 11:30:15',
                ip_address: '192.168.1.105'
            },
            {
                id: 1003,
                admin_id: 2,
                first_name: 'John',
                last_name: 'Manager',
                action_type: 'delete',
                target_type: 'service',
                target_id: 8,
                description: 'Removed discontinued service "Luxury Shave Package"',
                created_at: '2025-06-03 10:22:45',
                ip_address: '192.168.1.110'
            },
            {
                id: 1004,
                admin_id: 1,
                first_name: 'Admin',
                last_name: 'User',
                action_type: 'security',
                target_type: 'system',
                target_id: 0,
                description: 'Enabled two-factor authentication requirement for all admins',
                created_at: '2025-06-02 16:48:33',
                ip_address: '192.168.1.105'
            },
            {
                id: 1005,
                admin_id: 3,
                first_name: 'Sarah',
                last_name: 'Admin',
                action_type: 'status',
                target_type: 'user',
                target_id: 27,
                description: 'Suspended user account for James Wilson due to policy violation',
                created_at: '2025-06-02 15:22:12',
                ip_address: '192.168.1.120'
            }
        ];
        
        let actionsHTML = '';
        
        mockActions.forEach(action => {
            let iconClass = 'fas fa-info-circle text-info';
            
            // Set appropriate icon based on action type
            switch (action.action_type) {
                case 'create':
                    iconClass = 'fas fa-plus-circle text-success';
                    break;
                case 'update':
                    iconClass = 'fas fa-edit text-primary';
                    break;
                case 'delete':
                    iconClass = 'fas fa-trash-alt text-danger';
                    break;
                case 'security':
                    iconClass = 'fas fa-shield-alt text-warning';
                    break;
                case 'status':
                    iconClass = 'fas fa-user-slash text-danger';
                    break;
            }
            
            const timeAgo = getTimeAgo(new Date(action.created_at.replace(' ', 'T')));
            
            actionsHTML += `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="d-flex justify-content-between">
                            <strong>${action.first_name} ${action.last_name}</strong>
                            <small class="text-muted">${timeAgo}</small>
                        </div>
                        <div>${action.description}</div>
                        <small class="text-muted">IP: ${action.ip_address}</small>
                    </div>
                </div>
            `;
        });
        
        actionsContainer.innerHTML = actionsHTML;
    }

    // Helper function to calculate time ago
    function getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffSec = Math.floor(diffMs / 1000);
        const diffMin = Math.floor(diffSec / 60);
        const diffHour = Math.floor(diffMin / 60);
        const diffDay = Math.floor(diffHour / 24);
        
        if (diffDay > 0) {
            return diffDay === 1 ? '1 day ago' : `${diffDay} days ago`;
        } else if (diffHour > 0) {
            return diffHour === 1 ? '1 hour ago' : `${diffHour} hours ago`;
        } else if (diffMin > 0) {
            return diffMin === 1 ? '1 minute ago' : `${diffMin} minutes ago`;
        } else {
            return 'Just now';
        }
    }

    // Booking Export Functionality
    function exportBookings() {
        // Get filter values to include in export
        const statusFilter = document.getElementById('booking-status-filter')?.value || 'all';
        const shopFilter = document.getElementById('booking-shop-filter')?.value || 'all';
        const dateFilter = document.getElementById('booking-date-filter')?.value || '';
        
        // Create a modal to allow the user to select export format
        const modal = document.createElement('div');
        modal.id = 'exportModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-file-export me-2"></i>Export Bookings</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Export Format</label>
                            <select class="form-select" id="export-format">
                                <option value="csv">CSV (Excel)</option>
                                <option value="pdf">PDF Document</option>
                                <option value="json">JSON Data</option>
                            </select>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="export-include-filters" checked>
                            <label class="form-check-label" for="export-include-filters">
                                Apply current filters (${statusFilter !== 'all' ? 'Status: ' + statusFilter + ', ' : ''}
                                ${shopFilter !== 'all' ? 'Shop: ' + shopFilter + ', ' : ''}
                                ${dateFilter ? 'Date: ' + dateFilter : ''})
                            </label>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Date Range</label>
                            <select class="form-select mb-2" id="export-date-range">
                                <option value="current">Current Filters</option>
                                <option value="today">Today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="all">All Time</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        
                        <div id="custom-export-range" style="display:none;" class="mb-3">
                            <div class="row">
                                <div class="col">
                                    <label class="form-label">From</label>
                                    <input type="date" class="form-control" id="export-date-from">
                                </div>
                                <div class="col">
                                    <label class="form-label">To</label>
                                    <input type="date" class="form-control" id="export-date-to">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="processBookingExport()">
                            <i class="fas fa-download me-1"></i>Export
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Show modal
        const exportModal = new bootstrap.Modal(document.getElementById('exportModal'));
        exportModal.show();
        
        // Add event listener for custom date range
        document.getElementById('export-date-range').addEventListener('change', function() {
            const customRangeDiv = document.getElementById('custom-export-range');
            if (this.value === 'custom') {
                customRangeDiv.style.display = 'block';
            } else {
                customRangeDiv.style.display = 'none';
            }
        });
        
        // Set default dates for custom range
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        
        document.getElementById('export-date-to').valueAsDate = today;
        document.getElementById('export-date-from').valueAsDate = thirtyDaysAgo;
    }

    function processBookingExport() {
        const format = document.getElementById('export-format').value;
        const dateRange = document.getElementById('export-date-range').value;
        
        // Show progress
        showNotification(`Preparing ${format.toUpperCase()} export...`, 'info');
        
        // Create loading indicator
        const exportModal = bootstrap.Modal.getInstance(document.getElementById('exportModal'));
        exportModal.hide();
        
        // Show progress modal
        const progressModal = createProgressModal('Exporting Bookings', `Preparing ${format.toUpperCase()} export of booking data...`);
        const progressBar = progressModal._element.querySelector('.progress-bar');
        progressModal.show();
        
        // Simulate export process with progress
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    progressModal.hide();
                    downloadBookingsFile(format);
                    showNotification(`Export completed successfully!`, 'success');
                }, 500);
            }
        }, 200);
    }

    function downloadBookingsFile(format) {
        const today = new Date();
        const fileName = `bookings_export_${today.toISOString().slice(0, 10)}`;
        
        switch (format) {
            case 'csv':
                downloadCSV(fileName);
                break;
            case 'pdf':
                downloadPDF(fileName);
                break;
            case 'json':
                downloadJSON(fileName);
                break;
        }
    }

    function downloadCSV(fileName) {
        // Create sample CSV data
        const csvContent = `"Booking ID","Customer Name","Customer Email","Service","Shop","Barber","Date","Time","Status","Price"
    "1001","John Doe","john@example.com","Haircut & Beard Trim","Elite Cuts Barbershop","Michael Johnson","2025-06-03","10:30 AM","Confirmed","$45.00"
    "1002","Jane Smith","jane@example.com","Hair Coloring","Downtown Barbers","David Thompson","2025-06-03","2:00 PM","Pending","$65.00"
    "1003","Robert Davis","robert@example.com","Full Grooming Package","Elite Cuts Barbershop","James Wilson","2025-06-04","11:15 AM","Completed","$55.00"`;
        
        // Create blob and trigger download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `${fileName}.csv`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadPDF(fileName) {
        // For PDFs, we'd typically use a library like jsPDF or call a backend API
        // This is a simplified simulation
        showNotification('PDF generation would typically require a server-side process or library', 'info');
        
        // Create a simple text file as a placeholder
        const pdfPlaceholder = `This would be a PDF document containing the booking export.
            
    Booking ID: 1001
    Customer: John Doe (john@example.com)
    Service: Haircut & Beard Trim
    Shop: Elite Cuts Barbershop
    Barber: Michael Johnson
    Date & Time: 2025-06-03 10:30 AM
    Status: Confirmed
    Price: $45.00
    ---------------------------------
    Booking ID: 1002
    Customer: Jane Smith (jane@example.com)
    Service: Hair Coloring
    Shop: Downtown Barbers
    Barber: David Thompson
    Date & Time: 2025-06-03 2:00 PM
    Status: Pending
    Price: $65.00
    ---------------------------------`;
        
        const blob = new Blob([pdfPlaceholder], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `${fileName}.pdf`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadJSON(fileName) {
        const jsonData = {
            "exportDate": new Date().toISOString(),
            "bookings": [
                {
                    "id": "1001",
                    "customer": {
                        "name": "John Doe",
                        "email": "john@example.com"
                    },
                    "service": "Haircut & Beard Trim",
                    "shop": "Elite Cuts Barbershop",
                    "barber": "Michael Johnson",
                    "date": "2025-06-03",
                    "time": "10:30 AM",
                    "status": "Confirmed",
                    "price": 45.00
                },
                {
                    "id": "1002",
                    "customer": {
                        "name": "Jane Smith",
                        "email": "jane@example.com"
                    },
                    "service": "Hair Coloring",
                    "shop": "Downtown Barbers",
                    "barber": "David Thompson",
                    "date": "2025-06-03",
                    "time": "2:00 PM",
                    "status": "Pending",
                    "price": 65.00
                },
                {
                    "id": "1003",
                    "customer": {
                        "name": "Robert Davis",
                        "email": "robert@example.com"
                    },
                    "service": "Full Grooming Package",
                    "shop": "Elite Cuts Barbershop",
                    "barber": "James Wilson",
                    "date": "2025-06-04",
                    "time": "11:15 AM",
                    "status": "Completed",
                    "price": 55.00
                }
            ]
        };
        
        // Create blob and trigger download
        const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `${fileName}.json`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Fix and enhance existing exportAnalyticsData function
    function exportAnalyticsData(format) {
        // Show options modal first
        const modal = document.createElement('div');
        modal.id = 'exportAnalyticsModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-chart-bar me-2"></i>Export Analytics Data</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Exporting data in <strong>${format.toUpperCase()}</strong> format. Select the metrics you want to include.
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Included Metrics</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include-revenue" checked>
                                <label class="form-check-label" for="include-revenue">Revenue</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include-bookings" checked>
                                <label class="form-check-label" for="include-bookings">Bookings</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include-users" checked>
                                <label class="form-check-label" for="include-users">User Registrations</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="include-conversion">
                                <label class="form-check-label" for="include-conversion">Conversion Rate</label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Data Granularity</label>
                            <select class="form-select" id="data-granularity">
                                <option value="day">Daily</option>
                                <option value="week">Weekly</option>
                                <option value="month" selected>Monthly</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="processAnalyticsExport('${format}')">
                            <i class="fas fa-download me-1"></i>Export
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Show modal
        const exportModal = new bootstrap.Modal(document.getElementById('exportAnalyticsModal'));
        exportModal.show();
    }

    function processAnalyticsExport(format) {
        // Hide the export options modal
        const exportModal = bootstrap.Modal.getInstance(document.getElementById('exportAnalyticsModal'));
        exportModal.hide();
        
        // Get selected options
        const includeRevenue = document.getElementById('include-revenue').checked;
        const includeBookings = document.getElementById('include-bookings').checked;
        const includeUsers = document.getElementById('include-users').checked;
        const includeConversion = document.getElementById('include-conversion').checked;
        const granularity = document.getElementById('data-granularity').value;
        
        showNotification(`Preparing ${format.toUpperCase()} export of analytics data...`, 'info');
        
        // Show progress modal
        const progressModal = createProgressModal('Exporting Analytics', `Preparing ${format.toUpperCase()} export...`);
        const progressBar = progressModal._element.querySelector('.progress-bar');
        progressModal.show();
        
        // Simulate export process with progress
        let progress = 0;
        const interval = setInterval(() => {
            progress += 15;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    progressModal.hide();
                    // Download the file based on format
                    const fileName = `analytics_${new Date().toISOString().slice(0, 10)}`;
                    
                    if (format === 'csv') {
                        downloadAnalyticsCSV(fileName, includeRevenue, includeBookings, includeUsers, includeConversion, granularity);
                    } else if (format === 'pdf') {
                        downloadAnalyticsPDF(fileName, includeRevenue, includeBookings, includeUsers, includeConversion, granularity);
                    } else if (format === 'json') {
                        downloadAnalyticsJSON(fileName, includeRevenue, includeBookings, includeUsers, includeConversion, granularity);
                    }
                    
                    showNotification(`Analytics data exported successfully as ${format.toUpperCase()}!`, 'success');
                }, 500);
            }
        }, 150);
    }

    function downloadAnalyticsCSV(fileName, includeRevenue, includeBookings, includeUsers, includeConversion, granularity) {
        let headers = ['Date'];
        if (includeRevenue) headers.push('Revenue ($)');
        if (includeBookings) headers.push('Bookings');
        if (includeUsers) headers.push('New Users');
        if (includeConversion) headers.push('Conversion Rate (%)');
        
        let csvContent = headers.join(',') + '\n';
        
        // Sample data - in a real app, this would come from your API
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        for (let i = 0; i < months.length; i++) {
            let row = [months[i]];
            
            if (includeRevenue) row.push((Math.random() * 15000 + 10000).toFixed(2));
            if (includeBookings) row.push(Math.floor(Math.random() * 300 + 100));
            if (includeUsers) row.push(Math.floor(Math.random() * 100 + 50));
            if (includeConversion) row.push((Math.random() * 8 + 2).toFixed(1));
            
            csvContent += row.join(',') + '\n';
        }
        
        // Create blob and trigger download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `${fileName}.csv`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadAnalyticsPDF(fileName, includeRevenue, includeBookings, includeUsers, includeConversion, granularity) {
        // For PDFs, we'd typically use a library like jsPDF or call a backend API
        // This is a simplified simulation
        showNotification('PDF generation would typically require a server-side process or library', 'info');
        
        // Create a simple text file as a placeholder
        const pdfPlaceholder = `Analytics Export (${new Date().toDateString()})
        
    ${includeRevenue ? ' Revenue data included' : ''}
    ${includeBookings ? ' Booking data included' : ''}
    ${includeUsers ? ' User registration data included' : ''}
    ${includeConversion ? ' Conversion rate data included' : ''}
        
    Data granularity: ${granularity}

    This would be a properly formatted PDF document with charts and tables of the selected analytics data.`;
        
        const blob = new Blob([pdfPlaceholder], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `${fileName}.pdf`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadAnalyticsJSON(fileName, includeRevenue, includeBookings, includeUsers, includeConversion, granularity) {
        // Sample data structure
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const data = [];
        
        for (let i = 0; i < months.length; i++) {
            const entry = {
                period: months[i]
            };
            
            if (includeRevenue) entry.revenue = parseFloat((Math.random() * 15000 + 10000).toFixed(2));
            if (includeBookings) entry.bookings = Math.floor(Math.random() * 300 + 100);
            if (includeUsers) entry.newUsers = Math.floor(Math.random() * 100 + 50);
            if (includeConversion) entry.conversionRate = parseFloat((Math.random() * 8 + 2).toFixed(1));
            
            data.push(entry);
        }
        
        const jsonData = {
            exportDate: new Date().toISOString(),
            dataGranularity: granularity,
            metrics: {
                includeRevenue,
                includeBookings,
                includeUsers,
                includeConversion
            },
            data: data
        };
        
        // Create blob and trigger download
        const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', `${fileName}.json`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Reports functionality
    function generateReport() {
        const reportType = document.getElementById('report-type').value;
        const reportPeriod = document.getElementById('report-period').value;
        const reportGrouping = document.getElementById('report-grouping').value;
        const reportFormat = document.getElementById('report-format').value;
        
        // For custom date range
        let startDate = '', endDate = '';
        if (reportPeriod === 'custom') {
            startDate = document.getElementById('report-date-from').value;
            endDate = document.getElementById('report-date-to').value;
            
            if (!startDate || !endDate) {
                showNotification('Please select both start and end dates for custom range', 'warning');
                return;
            }
        }
        
        showNotification(`Generating ${reportType} report...`, 'info');
        
        // Show progress dialog
        const progressModal = createProgressModal('Generating Report', 'Please wait while we generate your report...');
        const progressBar = progressModal._element.querySelector('.progress-bar');
        progressModal.show();
        
        // Simulate report generation
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    progressModal.hide();
                    
                    if (reportFormat === 'html') {
                        showReportPreview(reportType, reportPeriod, reportGrouping);
                    } else {
                        // For other formats, simulate download
                        const fileName = `${reportType}_report_${new Date().toISOString().split('T')[0]}.${reportFormat}`;
                        simulateFileDownload(fileName, reportFormat);
                        showNotification(`Report successfully generated and downloaded as ${fileName}`, 'success');
                    }
                }, 500);
            }
        }, 200);
    }

    function showReportPreview(reportType, reportPeriod, reportGrouping) {
        // Create modal for HTML report preview
        const modal = document.createElement('div');
        modal.id = 'reportPreviewModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        
        // Create report title based on type and period
        let reportTitle = '';
        
        switch (reportType) {
            case 'revenue':
                reportTitle = 'Revenue Report';
                break;
            case 'bookings':
                reportTitle = 'Bookings Analysis';
                break;
            case 'user-activity':
                reportTitle = 'User Activity Report';
                break;
            case 'shop-performance':
                reportTitle = 'Shop Performance Report';
                break;
            case 'barber-performance':
                reportTitle = 'Barber Performance Analysis';
                break;
            case 'service-popularity':
                reportTitle = 'Service Popularity Report';
                break;
            default:
                reportTitle = 'Custom Report';
        }
        
        // Add period to title
        switch (reportPeriod) {
            case 'today':
                reportTitle += ' - Today';
                break;
            case 'yesterday':
                reportTitle += ' - Yesterday';
                break;
            case 'week':
                reportTitle += ' - This Week';
                break;
            case 'month':
                reportTitle += ' - This Month';
                break;
            case 'quarter':
                reportTitle += ' - This Quarter';
                break;
            case 'year':
                reportTitle += ' - This Year';
                break;
            case 'custom':
                const startDate = document.getElementById('report-date-from').value;
                const endDate = document.getElementById('report-date-to').value;
                reportTitle += ` (${startDate} to ${endDate})`;
                break;
        }
        
        // Create modal content with report
        modal.innerHTML = `
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title"><i class="fas fa-file-alt me-2"></i>${reportTitle}</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="report-content">
                            <div class="report-header text-center mb-4">
                                <h3>${reportTitle}</h3>
                                <p>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                            </div>
                            
                            <div class="report-summary mb-4">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="card bg-light h-100">
                                            <div class="card-body text-center">
                                                <h5 class="card-title">Total Revenue</h5>
                                                <h3 class="mb-0">$48,293.42</h3>
                                                <p class="text-success mt-2"><i class="fas fa-arrow-up me-1"></i>12.3% vs previous</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-light h-100">
                                            <div class="card-body text-center">
                                                <h5 class="card-title">Total Bookings</h5>
                                                <h3 class="mb-0">1,284</h3>
                                                <p class="text-success mt-2"><i class="fas fa-arrow-up me-1"></i>8.7% vs previous</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-light h-100">
                                            <div class="card-body text-center">
                                                <h5 class="card-title">Average Value</h5>
                                                <h3 class="mb-0">$37.61</h3>
                                                <p class="text-success mt-2"><i class="fas fa-arrow-up me-1"></i>3.2% vs previous</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="report-chart mb-4">
                                <h5 class="mb-3">Trend Analysis</h5>
                                <canvas id="reportChart" height="300"></canvas>
                            </div>
                            
                            <div class="report-table">
                                <h5 class="mb-3">Detailed ${reportType} Data</h5>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Revenue</th>
                                                <th>Bookings</th>
                                                <th>Average Value</th>
                                                <th>Top Service</th>
                                                <th>Top Shop</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>June 1, 2025</td>
                                                <td>$1,845.23</td>
                                                <td>48</td>
                                                <td>$38.44</td>
                                                <td>Haircut & Style</td>
                                                <td>Elite Cuts</td>
                                            </tr>
                                            <tr>
                                                <td>June 2, 2025</td>
                                                <td>$1,738.50</td>
                                                <td>45</td>
                                                <td>$38.63</td>
                                                <td>Haircut & Style</td>
                                                <td>Elite Cuts</td>
                                            </tr>
                                            <tr>
                                                <td>June 3, 2025</td>
                                                <td>$1,920.75</td>
                                                <td>50</td>
                                                <td>$38.42</td>
                                                <td>Full Package</td>
                                                <td>Downtown Barbers</td>
                                            </tr>
                                            <tr class="table-primary">
                                                <td><strong>Total</strong></td>
                                                <td><strong>$5,504.48</strong></td>
                                                <td><strong>143</strong></td>
                                                <td><strong>$38.49</strong></td>
                                                <td>-</td>
                                                <td>-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="btn-group me-auto">
                            <button type="button" class="btn btn-outline-secondary" onclick="printReport()">
                                <i class="fas fa-print me-1"></i>Print
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="downloadReport('current', 'pdf')">
                                <i class="fas fa-file-pdf me-1"></i>PDF
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="downloadReport('current', 'csv')">
                                <i class="fas fa-file-csv me-1"></i>CSV
                            </button>
                        </div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="saveReport()">
                            <i class="fas fa-save me-1"></i>Save Report
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Show the modal
        const reportPreviewModal = new bootstrap.Modal(document.getElementById('reportPreviewModal'));
        reportPreviewModal.show();
        
        // Initialize chart in the modal
        setTimeout(() => {
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Generate some fake data
            const labels = ['June 1', 'June 2', 'June 3', 'June 4', 'June 5', 'June 6', 'June 7'];
            const revenueData = [1845.23, 1738.50, 1920.75, 1756.30, 1843.80, 2125.44, 1886.50];
            const bookingsData = [48, 45, 50, 47, 48, 55, 49];
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Revenue ($)',
                            data: revenueData,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            yAxisID: 'y',
                            fill: true
                        },
                        {
                            label: 'Bookings',
                            data: bookingsData,
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            yAxisID: 'y1',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    stacked: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Revenue ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            title: {
                                display: true,
                                text: 'Bookings'
                            }
                        }
                    }
                }
            });
        }, 500);
    }

    function simulateFileDownload(fileName, format) {
        // Create a dummy download
        const a = document.createElement('a');
        a.style.display = 'none';
        document.body.appendChild(a);
        
        let mimeType = 'text/plain';
        let content = 'Example report content';
        
        switch (format) {
            case 'csv':
                mimeType = 'text/csv';
                content = 'Date,Revenue,Bookings,Average Value,Top Service,Top Shop\n' +
                        '2025-06-01,1845.23,48,38.44,Haircut & Style,Elite Cuts\n' +
                        '2025-06-02,1738.50,45,38.63,Haircut & Style,Elite Cuts\n' +
                        '2025-06-03,1920.75,50,38.42,Full Package,Downtown Barbers';
                break;
            case 'json':
                mimeType = 'application/json';
                content = JSON.stringify({
                    reportData: [
                        {date: '2025-06-01', revenue: 1845.23, bookings: 48, avgValue: 38.44, topService: 'Haircut & Style', topShop: 'Elite Cuts'},
                        {date: '2025-06-02', revenue: 1738.50, bookings: 45, avgValue: 38.63, topService: 'Haircut & Style', topShop: 'Elite Cuts'},
                        {date: '2025-06-03', revenue: 1920.75, bookings: 50, avgValue: 38.42, topService: 'Full Package', topShop: 'Downtown Barbers'}
                    ],
                    totals: {
                        revenue: 5504.48,
                        bookings: 143,
                        avgValue: 38.49
                    }
                }, null, 2);
                break;
            case 'pdf':
                // Can't actually create a PDF in pure JS, but we can simulate the download
                mimeType = 'application/pdf';
                content = '%PDF-1.0\n...simulated PDF content...';
                break;
        }
        
        const blob = new Blob([content], {type: mimeType});
        const url = URL.createObjectURL(blob);
        
        a.href = url;
        a.download = fileName;
        a.click();
        
        // Cleanup
        setTimeout(() => {
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }, 100);
    }

    function viewReport(reportId) {
        showNotification('Loading report...', 'info');
        setTimeout(() => {
            showReportPreview('revenue', 'month', 'day');
        }, 500);
    }

    function downloadReport(reportId, format) {
        showNotification(`Preparing ${format.toUpperCase()} download...`, 'info');
        
        setTimeout(() => {
            const fileName = `report_${new Date().toISOString().split('T')[0]}.${format}`;
            simulateFileDownload(fileName, format);
            showNotification(`Report downloaded successfully as ${fileName}`, 'success');
        }, 1000);
    }

    function deleteReport(reportId) {
        if (confirm('Are you sure you want to delete this report? This action cannot be undone.')) {
            showNotification('Deleting report...', 'info');
            
            setTimeout(() => {
                showNotification('Report deleted successfully', 'success');
                // In a real app, we'd remove the row from the table
            }, 1000);
        }
    }

    function showScheduleReportModal() {
        // Create modal for scheduling a report
        const modal = document.createElement('div');
        modal.id = 'scheduleReportModal';
        modal.className = 'modal fade';
        
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-calendar-plus me-2"></i>Schedule New Report</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="scheduleReportForm">
                            <div class="mb-3">
                                <label class="form-label">Report Name</label>
                                <input type="text" class="form-control" id="schedule-report-name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Report Type</label>
                                <select class="form-select" id="schedule-report-type">
                                    <option value="revenue">Revenue Report</option>
                                    <option value="bookings">Bookings Report</option>
                                    <option value="user-activity">User Activity Report</option>
                                    <option value="shop-performance">Shop Performance Report</option>
                                    <option value="barber-performance">Barber Performance Report</option>
                                    <option value="service-popularity">Service Popularity Report</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Frequency</label>
                                <select class="form-select" id="schedule-frequency" onchange="toggleScheduleOptions()">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                </select>
                            </div>
                            
                            <!-- Weekly options -->
                            <div class="mb-3" id="weekly-options">
                                <label class="form-label">Day of Week</label>
                                <select class="form-select" id="schedule-day">
                                    <option value="1">Monday</option>
                                    <option value="2">Tuesday</option>
                                    <option value="3">Wednesday</option>
                                    <option value="4">Thursday</option>
                                    <option value="5">Friday</option>
                                    <option value="6">Saturday</option>
                                    <option value="0">Sunday</option>
                                </select>
                            </div>
                            
                            <!-- Monthly options -->
                            <div class="mb-3" id="monthly-options" style="display:none;">
                                <label class="form-label">Day of Month</label>
                                <select class="form-select" id="schedule-day-month">
                                    <option value="1">1st day</option>
                                    <option value="15">15th day</option>
                                    <option value="last">Last day</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Format</label>
                                <select class="form-select" id="schedule-format">
                                    <option value="pdf">PDF Document</option>
                                    <option value="csv">CSV (Excel)</option>
                                    <option value="json">JSON Data</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Recipients</label>
                                <select class="form-select" id="schedule-recipients" multiple>
                                    <option value="admin@example.com">Admin (admin@example.com)</option>
                                    <option value="manager@example.com">Manager (manager@example.com)</option>
                                    <option value="finance@example.com">Finance Dept. (finance@example.com)</option>
                                    <option value="operations@example.com">Operations (operations@example.com)</option>
                                </select>
                                <div class="form-text">Hold Ctrl/Cmd to select multiple recipients</div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="schedule-active" checked>
                                    <label class="form-check-label" for="schedule-active">Active</label>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="saveScheduledReport()">Save Schedule</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const scheduleModal = new bootstrap.Modal(document.getElementById('scheduleReportModal'));
        scheduleModal.show();
    }

    function toggleScheduleOptions() {
        const frequency = document.getElementById('schedule-frequency').value;
        const weeklyOptions = document.getElementById('weekly-options');
        const monthlyOptions = document.getElementById('monthly-options');
        
        // Hide all first
        weeklyOptions.style.display = 'none';
        monthlyOptions.style.display = 'none';
        
        // Show appropriate options based on frequency
        if (frequency === 'weekly') {
            weeklyOptions.style.display = 'block';
        } else if (frequency === 'monthly' || frequency === 'quarterly') {
            monthlyOptions.style.display = 'block';
        }
    }

    function saveScheduledReport() {
        const name = document.getElementById('schedule-report-name').value;
        
        if (!name) {
            showNotification('Please enter a report name', 'warning');
            return;
        }
        
        showNotification('Saving scheduled report...', 'info');
        
        setTimeout(() => {
            showNotification('Report scheduled successfully', 'success');
            bootstrap.Modal.getInstance(document.getElementById('scheduleReportModal')).hide();
            
            // In a real app, we would refresh the scheduled reports list
        }, 1000);
    }

    function editScheduledReport(reportId) {
        showNotification('Loading scheduled report details...', 'info');
        
        setTimeout(() => {
            showScheduleReportModal();
            
            // Pre-fill form with mock data
            document.getElementById('schedule-report-name').value = 
                reportId === 'weekly-revenue' ? 'Weekly Revenue Summary' : 
                reportId === 'monthly-bookings' ? 'Monthly Bookings Report' : 
                'Quarterly Performance Review';
                
            document.getElementById('schedule-report-type').value = 
                reportId === 'weekly-revenue' ? 'revenue' : 
                reportId === 'monthly-bookings' ? 'bookings' : 
                'shop-performance';
                
            document.getElementById('schedule-frequency').value = 
                reportId === 'weekly-revenue' ? 'weekly' : 
                reportId === 'monthly-bookings' ? 'monthly' : 
                'quarterly';
                
            // Update display of options based on frequency
            toggleScheduleOptions();
        }, 500);
    }

    function toggleScheduledReport(reportId) {
        const btnElement = event.currentTarget;
        const iconElement = btnElement.querySelector('i');
        const isCurrentlyActive = iconElement.classList.contains('fa-pause');
        
        if (isCurrentlyActive) {
            // Currently active, so pause it
            iconElement.classList.replace('fa-pause', 'fa-play');
            btnElement.classList.replace('btn-outline-warning', 'btn-outline-success');
            
            // Update badge in the same row
            const row = btnElement.closest('tr');
            const badgeElement = row.querySelector('.badge');
            badgeElement.textContent = 'Paused';
            badgeElement.classList.replace('bg-success', 'bg-warning');
            
            showNotification(`Scheduled report ${reportId} has been paused`, 'warning');
        } else {
            // Currently paused, so activate it
            iconElement.classList.replace('fa-play', 'fa-pause');
            btnElement.classList.replace('btn-outline-success', 'btn-outline-warning');
            
            // Update badge in the same row
            const row = btnElement.closest('tr');
            const badgeElement = row.querySelector('.badge');
            badgeElement.textContent = 'Active';
            badgeElement.classList.replace('bg-warning', 'bg-success');
            
            showNotification(`Scheduled report ${reportId} has been activated`, 'success');
        }
    }

    function deleteScheduledReport(reportId) {
        if (confirm('Are you sure you want to delete this scheduled report? This action cannot be undone.')) {
            showNotification('Deleting scheduled report...', 'info');
            
            setTimeout(() => {
                showNotification('Scheduled report deleted successfully', 'success');
                // In a real app, we'd remove the row from the table
            }, 1000);
        }
    }

    // Initialize everything when the document is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Load recent admin actions on page load
        loadRecentAdminActions();
        
        // Handle date range for reports
        document.getElementById('report-period')?.addEventListener('change', function() {
            const customRangeDiv = document.getElementById('custom-date-report-range');
            if (this.value === 'custom') {
                customRangeDiv.style.display = 'block';
                
                // Set default dates (last 30 days)
                const today = new Date();
                const thirtyDaysAgo = new Date(today);
                thirtyDaysAgo.setDate(today.getDate() - 30);
                
                document.getElementById('report-date-to').value = today.toISOString().split('T')[0];
                document.getElementById('report-date-from').value = thirtyDaysAgo.toISOString().split('T')[0];
            } else {
                customRangeDiv.style.display = 'none';
            }
        });
        
        // Add CSS for the activity feed
        const style = document.createElement('style');
        style.textContent = `
            .activity-item {
                padding: 15px 0;
                display: flex;
                border-bottom: 1px solid var(--border-color);
            }
            
            .activity-item:first-child {
                padding-top: 0;
            }
            
            .activity-icon {
                width: 36px;
                height: 36px;
                background-color: #f8f9fa;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 15px;
                flex-shrink: 0;
            }
            
            .activity-content {
                flex-grow: 1;
            }
            
            /* Report styles */
            .report-header {
                border-bottom: 1px solid #dee2e6;
                padding-bottom: 1rem;
            }
            
            .report-content {
                padding: 1rem 0;
            }
        `;
        document.head.appendChild(style);
    });

    // Content Management Functions
    function showEditPageModal(pageId = null) {
        const isNew = !pageId;
        const title = isNew ? 'Add New Page' : 'Edit Page';
        
        // Create modal for page editing
        const modal = document.createElement('div');
        modal.id = 'editPageModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-file-alt me-2"></i>${title}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="pageForm">
                            <div class="mb-3">
                                <label for="page-title" class="form-label">Page Title</label>
                                <input type="text" class="form-control" id="page-title" value="${pageId === 'home' ? 'Home' : pageId === 'about' ? 'About Us' : pageId === 'contact' ? 'Contact' : ''}">
                            </div>
                            <div class="mb-3">
                                <label for="page-slug" class="form-label">URL Slug</label>
                                <div class="input-group">
                                    <span class="input-group-text">/</span>
                                    <input type="text" class="form-control" id="page-slug" value="${pageId || ''}">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="page-content" class="form-label">Content</label>
                                <textarea class="form-control" id="page-content" rows="10"></textarea>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="page-published" checked>
                                <label class="form-check-label" for="page-published">Published</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="savePage('${pageId || ''}')">
                            <i class="fas fa-save me-1"></i>Save Page
                        </button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const pageModal = new bootstrap.Modal(document.getElementById('editPageModal'));
        pageModal.show();
    }

    function previewPage(pageId) {
        showNotification(`Opening preview for page: ${pageId}`, 'info');
        window.open(`/${pageId}`, '_blank');
    }

    function savePage(pageId) {
        const isNew = !pageId;
        const title = document.getElementById('page-title').value;
        const slug = document.getElementById('page-slug').value;
        const content = document.getElementById('page-content').value;
        const isPublished = document.getElementById('page-published').checked;
        
        if (!title || !slug) {
            showNotification('Please enter a title and slug for the page', 'warning');
            return;
        }
        
        showNotification(`${isNew ? 'Creating' : 'Updating'} page...`, 'info');
        
        setTimeout(() => {
            showNotification(`Page ${isNew ? 'created' : 'updated'} successfully!`, 'success');
            bootstrap.Modal.getInstance(document.getElementById('editPageModal')).hide();
        }, 1000);
    }

    function showUploadMediaModal() {
        const modal = document.createElement('div');
        modal.id = 'uploadMediaModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-upload me-2"></i>Upload Media</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="media-file" class="form-label">Select Files</label>
                            <input class="form-control" type="file" id="media-file" multiple>
                        </div>
                        <div class="progress" id="upload-progress-container" style="display:none;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" id="upload-progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="uploadMedia()">Upload</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const mediaModal = new bootstrap.Modal(document.getElementById('uploadMediaModal'));
        mediaModal.show();
    }

    function uploadMedia() {
        const fileInput = document.getElementById('media-file');
        if (!fileInput.files.length) {
            showNotification('Please select files to upload', 'warning');
            return;
        }
        
        const progressContainer = document.getElementById('upload-progress-container');
        const progressBar = document.getElementById('upload-progress-bar');
        progressContainer.style.display = 'block';
        
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    showNotification('Files uploaded successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('uploadMediaModal')).hide();
                }, 500);
            }
        }, 300);
    }

    function deleteMedia(mediaId) {
        if (confirm('Are you sure you want to delete this media file? This action cannot be undone.')) {
            showNotification('Deleting media file...', 'info');
            
            setTimeout(() => {
                showNotification('Media file deleted successfully!', 'success');
            }, 1000);
        }
    }

    function showDeleteUserConfirmation(userId, userName) {
        if (confirm(`Are you sure you want to permanently block ${userName}? This action is difficult to reverse and will remove all their access.`)) {
            fetch(`/api/super-admin/users/${userId}/ban`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`User ${userName} has been permanently blocked`, 'success');
                    
                    // Close the user profile modal
                    const userProfileModal = bootstrap.Modal.getInstance(document.getElementById('userProfileModal'));
                    if (userProfileModal) userProfileModal.hide();
                    
                    // Reload the page after a short delay
                    setTimeout(() => location.reload(), 1500);
                } else {
                    throw new Error(data.message || 'Failed to block user');
                }
            })
            .catch(error => {
                showNotification(`Error: ${error.message}`, 'error');
            });
        }
    }

    // Fix for the searchShops function that's causing the error
    function searchShops(e) {
        const searchTerm = (e?.target?.value || document.getElementById('shop-search')?.value || '').toLowerCase();
        const shopRows = document.querySelectorAll('#shops-table tr');
        let resultsCount = 0;
        
        shopRows.forEach(row => {
            const name = row.querySelector('td:first-child')?.textContent.toLowerCase() || '';
            const owner = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';
            
            if (name.includes(searchTerm) || owner.includes(searchTerm)) {
                row.style.display = '';
                resultsCount++;
            } else {
                row.style.display = 'none';
            }
        });
    }

    // Add this booking calendar implementation (simple yet functional)
    function initializeBookingCalendar() {
        const calendarEl = document.getElementById('bookingCalendar');
        if (!calendarEl) return;
        
        // Get current date
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth();
        
        // Create calendar HTML
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
        
        let calendarHTML = `
            <div class="calendar-header d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary" onclick="changeCalendarMonth(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h4>${new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long' })} ${currentYear}</h4>
                <button class="btn btn-outline-secondary" onclick="changeCalendarMonth(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        // Fill calendar with days
        let day = 1;
        for (let i = 0; i < 6; i++) {
            calendarHTML += '<tr>';
            
            for (let j = 0; j < 7; j++) {
                if ((i === 0 && j < firstDayOfMonth) || day > daysInMonth) {
                    calendarHTML += '<td></td>';
                } else {
                    const isToday = day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear();
                    const todayClass = isToday ? 'bg-primary text-white' : '';
                    
                    // Sample booking indicators
                    const hasBookings = [5, 10, 15, 20, 25].includes(day);
                    const bookingIndicator = hasBookings ? '<div class="booking-dot bg-success"></div>' : '';
                    
                    calendarHTML += `
                        <td class="${todayClass}" onclick="showBookingsForDate('${currentYear}-${(currentMonth+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}')">
                            <div class="calendar-day">
                                ${day}
                                ${bookingIndicator}
                            </div>
                        </td>
                    `;
                    day++;
                }
            }
            
            calendarHTML += '</tr>';
            if (day > daysInMonth) break;
        }
        
        calendarHTML += `
                </tbody>
            </table>
            <style>
                .calendar-day {
                    height: 50px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                }
                .booking-dot {
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-top: 3px;
                }
            </style>
        `;
        
        calendarEl.innerHTML = calendarHTML;
        calendarEl.dataset.year = currentYear;
        calendarEl.dataset.month = currentMonth;
    }

    function changeCalendarMonth(offset) {
        const calendarEl = document.getElementById('bookingCalendar');
        let year = parseInt(calendarEl.dataset.year);
        let month = parseInt(calendarEl.dataset.month) + offset;
        
        if (month < 0) {
            month = 11;
            year--;
        } else if (month > 11) {
            month = 0;
            year++;
        }
        
        calendarEl.dataset.year = year;
        calendarEl.dataset.month = month;
        
        // Rebuild calendar with new month/year
        initializeBookingCalendar();
    }

    function showBookingsForDate(dateStr) {
        // Create and show modal with bookings for the selected date
        const modal = document.createElement('div');
        modal.id = 'dayBookingsModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-calendar-check me-2"></i>Bookings for ${new Date(dateStr).toDateString()}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="list-group">
                            <a href="#" class="list-group-item list-group-item-action" onclick="viewBookingDetails(1001)">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">John Doe - Haircut & Beard Trim</h6>
                                    <small class="badge bg-success">10:30 AM</small>
                                </div>
                                <small class="text-muted">Elite Cuts Barbershop - Michael Johnson</small>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="viewBookingDetails(1002)">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Jane Smith - Hair Coloring</h6>
                                    <small class="badge bg-success">2:00 PM</small>
                                </div>
                                <small class="text-muted">Downtown Barbers - David Thompson</small>
                            </a>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const bookingsModal = new bootstrap.Modal(document.getElementById('dayBookingsModal'));
        bookingsModal.show();
    }

    // Common helper functions
    function showNotification(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-white bg-${type} border-0 show`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');
        toast.style.position = 'fixed';
        toast.style.bottom = '20px';
        toast.style.right = '20px';
        toast.style.zIndex = '9999';
        
        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    function createProgressModal(title, message) {
        // Remove existing modal if present
        const existingModal = document.getElementById('progressModal');
        if (existingModal) {
            document.body.removeChild(existingModal);
        }
        
        // Create new modal
        const modal = document.createElement('div');
        modal.id = 'progressModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">${title}</h5>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                role="progressbar" 
                                aria-valuenow="0" 
                                aria-valuemin="0" 
                                aria-valuemax="100" 
                                style="width: 0%">
                                0%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        return new bootstrap.Modal(modal);
    }

    function showLoadingOverlay(chartId) {
        const container = document.getElementById(chartId).parentNode;
        const overlay = document.createElement('div');
        overlay.className = 'loading-overlay';
        overlay.innerHTML = `
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="mt-2">Loading data...</div>
        `;
        overlay.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        `;
        container.style.position = 'relative';
        container.appendChild(overlay);
    }

    function hideLoadingOverlay(chartId) {
        const container = document.getElementById(chartId).parentNode;
        const overlay = container.querySelector('.loading-overlay');
        if (overlay) {
            container.removeChild(overlay);
        }
    }

    // Quick Action Modals
    function showCreateUserModal() {
        const modal = document.createElement('div');
        modal.id = 'createUserModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Add New User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createUserForm">
                            <div class="mb-3">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="user-email" required>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="user-first-name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="user-last-name" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" id="user-password" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">User Type</label>
                                <select class="form-select" id="user-type">
                                    <option value="customer">Customer</option>
                                    <option value="barber">Barber</option>
                                    <option value="shop_owner">Shop Owner</option>
                                    <option value="super_admin">Super Admin</option>
                                </select>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="user-active" checked>
                                <label class="form-check-label" for="user-active">Active account</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="createUser()">Create User</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const userModal = new bootstrap.Modal(document.getElementById('createUserModal'));
        userModal.show();
    }

    function showCreateShopModal() {
        const modal = document.createElement('div');
        modal.id = 'createShopModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-store-alt me-2"></i>Add New Shop</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createShopForm">
                            <div class="mb-3">
                                <label class="form-label">Shop Name</label>
                                <input type="text" class="form-control" id="shop-name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" id="shop-location" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="shop-description" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Shop Owner</label>
                                <select class="form-select" id="shop-owner">
                                    <option value="">-- Select Shop Owner --</option>
                                    <!-- This would be dynamically populated in a real app -->
                                    <option value="1">John Smith (john@example.com)</option>
                                    <option value="2">Sarah Johnson (sarah@example.com)</option>
                                    <option value="new">+ Create New Owner</option>
                                </select>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="shop-active" checked>
                                <label class="form-check-label" for="shop-active">Active shop</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="createShop()">Create Shop</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const shopModal = new bootstrap.Modal(document.getElementById('createShopModal'));
        shopModal.show();
    }

    function showCreateServiceModal() {
        const modal = document.createElement('div');
        modal.id = 'createServiceModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-cut me-2"></i>Add New Service</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createServiceForm">
                            <div class="mb-3">
                                <label class="form-label">Service Name</label>
                                <input type="text" class="form-control" id="service-name" required>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Duration (minutes)</label>
                                    <input type="number" class="form-control" id="service-duration" required min="5" step="5" value="30">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Price ($)</label>
                                    <input type="number" class="form-control" id="service-price" required min="0" step="0.01">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="service-description" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Associated Shop (optional)</label>
                                <select class="form-select" id="service-shop">
                                    <option value="">-- Global Service --</option>
                                    <!-- This would be dynamically populated in a real app -->
                                    <option value="1">Elite Cuts Barbershop</option>
                                    <option value="2">Downtown Barbers</option>
                                    <option value="3">Modern Men's Salon</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="createService()">Create Service</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const serviceModal = new bootstrap.Modal(document.getElementById('createServiceModal'));
        serviceModal.show();
    }

    function showCreateBookingModal() {
        const modal = document.createElement('div');
        modal.id = 'createBookingModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-calendar-plus me-2"></i>Add New Booking</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createBookingForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Customer</label>
                                    <select class="form-select" id="booking-customer" required>
                                        <option value="">-- Select Customer --</option>
                                        <!-- This would be dynamically populated in a real app -->
                                        <option value="1">John Doe (john@example.com)</option>
                                        <option value="2">Jane Smith (jane@example.com)</option>
                                        <option value="new">+ Create New Customer</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Shop</label>
                                    <select class="form-select" id="booking-shop" required onchange="loadBarbers(this.value)">
                                        <option value="">-- Select Shop --</option>
                                        <!-- This would be dynamically populated in a real app -->
                                        <option value="1">Elite Cuts Barbershop</option>
                                        <option value="2">Downtown Barbers</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Barber</label>
                                    <select class="form-select" id="booking-barber" required disabled>
                                        <option value="">-- Select Shop First --</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Service</label>
                                    <select class="form-select" id="booking-service" required>
                                        <option value="">-- Select Service --</option>
                                        <!-- This would be dynamically populated in a real app -->
                                        <option value="1">Haircut ($25)</option>
                                        <option value="2">Beard Trim ($15)</option>
                                        <option value="3">Full Package ($35)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="booking-date" required min="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Time</label>
                                    <select class="form-select" id="booking-time" required disabled>
                                        <option value="">-- Select Date First --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="booking-notes" rows="2"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="createBooking()">Create Booking</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const bookingModal = new bootstrap.Modal(document.getElementById('createBookingModal'));
        
        // Set today as the minimum date
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('booking-date').setAttribute('min', today);
        document.getElementById('booking-date').value = today;
        
        // Event handler for date selection
        document.getElementById('booking-date').addEventListener('change', function() {
            const shopId = document.getElementById('booking-shop').value;
            const barberId = document.getElementById('booking-barber').value;
            if (shopId && barberId) {
                loadAvailableTimes(shopId, barberId, this.value);
            }
        });
        
        bookingModal.show();
    }

    function showSendNotificationModal() {
        const modal = document.createElement('div');
        modal.id = 'sendNotificationModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-bell me-2"></i>Send Notification</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="sendNotificationForm">
                            <div class="mb-3">
                                <label class="form-label">Recipient Type</label>
                                <select class="form-select" id="notification-recipient-type" onchange="toggleRecipientFields()">
                                    <option value="all">All Users</option>
                                    <option value="customers">All Customers</option>
                                    <option value="barbers">All Barbers</option>
                                    <option value="shop_owners">All Shop Owners</option>
                                    <option value="specific">Specific Users</option>
                                </select>
                            </div>
                            <div class="mb-3" id="specific-recipients-section" style="display: none;">
                                <label class="form-label">Recipients</label>
                                <select class="form-select" id="notification-recipients" multiple>
                                    <option value="1">John Doe (john@example.com)</option>
                                    <option value="2">Jane Smith (jane@example.com)</option>
                                    <option value="3">Michael Johnson (michael@example.com)</option>
                                </select>
                                <div class="form-text">Hold Ctrl/Cmd to select multiple users</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-control" id="notification-title" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Message</label>
                                <textarea class="form-control" id="notification-message" rows="3" required></textarea>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="notification-in-app" checked>
                                        <label class="form-check-label" for="notification-in-app">Send In-App Notification</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="notification-email">
                                        <label class="form-check-label" for="notification-email">Send Email Notification</label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="sendNotification()">Send Notification</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        const notificationModal = new bootstrap.Modal(document.getElementById('sendNotificationModal'));
        notificationModal.show();
    }

    // System Actions Functions
    function clearCache() {
        showNotification('Clearing system cache...', 'info');
        
        // Add progress indicator
        const progressModal = createProgressModal('Clear Cache', 'Clearing system cache...');
        const progressBar = progressModal._element.querySelector('.progress-bar');
        
        // Show the modal
        progressModal.show();
        
        // Simulate the cache clearing process
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    progressModal.hide();
                    showNotification('Cache cleared successfully!', 'success');
                }, 500);
            }
        }, 200);
        
        // Simulate API call
        fetch('/api/super-admin/clear-cache', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .catch(error => {
            console.error('Error clearing cache:', error);
        });
    }

    function showImpersonateForm() {
        const modal = document.createElement('div');
        modal.id = 'impersonateModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-user-secret me-2"></i>Impersonate User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Warning:</strong> You will be logged in as the selected user. To return to your super admin account, you'll need to log out and log back in.
                        </div>
                        <div class="mb-3">
                            <label for="userType" class="form-label">User Type</label>
                            <select class="form-select mb-3" id="userType" onchange="filterUsers()">
                                <option value="all">All Users</option>
                                <option value="customer">Customers</option>
                                <option value="barber">Barbers</option>
                                <option value="shop_owner">Shop Owners</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="userSelect" class="form-label">Select User</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="userSearch" placeholder="Search by name or email" onkeyup="searchUsers()">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive" style="max-height: 300px;">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Type</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="usersList">
                                    <tr>
                                        <td>John Doe</td>
                                        <td>john@example.com</td>
                                        <td><span class="badge bg-info">Customer</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="impersonateUser(1)">
                                                <i class="fas fa-sign-in-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Michael Johnson</td>
                                        <td>michael@example.com</td>
                                        <td><span class="badge bg-primary">Barber</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="impersonateUser(2)">
                                                <i class="fas fa-sign-in-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Sarah Smith</td>
                                        <td>sarah@example.com</td>
                                        <td><span class="badge bg-secondary">Shop Owner</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="impersonateUser(3)">
                                                <i class="fas fa-sign-in-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const impersonateModal = new bootstrap.Modal(document.getElementById('impersonateModal'));
        impersonateModal.show();
    }

    function impersonateUser(userId) {
        if (confirm('Are you sure you want to impersonate this user?')) {
            showNotification('Starting impersonation session...', 'success');
            
            fetch(`/api/super-admin/impersonate/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Redirecting to user dashboard...', 'success');
                    setTimeout(() => {
                        window.location.href = data.redirect_url;
                    }, 1000);
                } else {
                    throw new Error(data.message || 'Impersonation failed');
                }
            })
            .catch(error => {
                showNotification(`Error: ${error.message}`, 'error');
            });
        }
    }

    function showSecuritySettings() {
        const modal = document.createElement('div');
        modal.id = 'securitySettingsModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>Security Settings</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <ul class="nav nav-tabs" id="securityTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general-security" type="button" role="tab">
                                    General
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="password-tab" data-bs-toggle="tab" data-bs-target="#password-policy" type="button" role="tab">
                                    Password Policy
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="2fa-tab" data-bs-toggle="tab" data-bs-target="#two-factor" type="button" role="tab">
                                    Two-Factor Auth
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="ip-tab" data-bs-toggle="tab" data-bs-target="#ip-security" type="button" role="tab">
                                    IP Restrictions
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content mt-3" id="securityTabContent">
                            <div class="tab-pane fade show active" id="general-security" role="tabpanel">
                                <form id="generalSecurityForm">
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Session Timeout (minutes)</label>
                                        </div>
                                        <input type="number" class="form-control" name="session_timeout" value="60" min="5" max="1440">
                                        <div class="form-text">Time of inactivity before users are automatically logged out</div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Max Login Attempts</label>
                                        </div>
                                        <input type="number" class="form-control" name="max_login_attempts" value="5" min="3" max="10">
                                        <div class="form-text">Number of failed login attempts before account lockout</div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Account Lockout Duration (minutes)</label>
                                        </div>
                                        <input type="number" class="form-control" name="lockout_duration" value="30" min="5">
                                        <div class="form-text">How long accounts remain locked after exceeding max login attempts</div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Enable CSRF Protection</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="csrf_protection" id="csrf_protection" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Protect against Cross-Site Request Forgery attacks</div>
                                    </div>
                                </form>
                            </div>
                            
                            <div class="tab-pane fade" id="password-policy" role="tabpanel">
                                <form id="passwordPolicyForm">
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Minimum Password Length</label>
                                        </div>
                                        <input type="number" class="form-control" name="min_password_length" value="8" min="6" max="20">
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Require Uppercase Letters</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="require_uppercase" id="require_uppercase" checked>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Require Numbers</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="require_numbers" id="require_numbers" checked>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Require Special Characters</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="require_special" id="require_special" checked>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Password Expiration (days)</label>
                                        </div>
                                        <input type="number" class="form-control" name="password_expiration" value="90" min="0">
                                        <div class="form-text">0 = passwords never expire</div>
                                    </div>
                                </form>
                            </div>
                            
                            <div class="tab-pane fade" id="two-factor" role="tabpanel">
                                <form id="twoFactorForm">
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Enable Two-Factor Authentication</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="enable_2fa" id="enable_2fa" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Adds an extra layer of security to user accounts</div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">Required for Admin Users</label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="require_2fa_admin" id="require_2fa_admin" checked>
                                            </div>
                                        </div>
                                        <div class="form-text">Make 2FA mandatory for admin and shop owner accounts</div>
                                    </div>
                                    <div class="mb-3 setting-item">
                                        <div class="setting-header">
                                            <label class="setting-title">2FA Provider</label>
                                        </div>
                                        <select class="form-select" name="2fa_provider">
                                            <option value="app">Authenticator App</option>
                                            <option value="email">Email</option>
                                            <option value="sms">SMS</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            
                            <div class="tab-pane fade" id="ip-security" role="tabpanel">
                                <div class="mb-3">
                                    <button class="btn btn-primary" onclick="showAddIPRestriction()">
                                        <i class="fas fa-plus me-1"></i> Add IP Restriction
                                    </button>
                                </div>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>IP Address/Range</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>192.168.1.100</td>
                                            <td><span class="badge bg-danger">Block</span></td>
                                            <td>Suspicious login attempts</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-danger" onclick="removeIPRestriction('192.168.1.100')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>10.0.0.0/24</td>
                                            <td><span class="badge bg-success">Allow</span></td>
                                            <td>Office network</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-danger" onclick="removeIPRestriction('10.0.0.0/24')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="saveSecuritySettings()">
                            <i class="fas fa-save me-1"></i> Save Changes
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const securitySettingsModal = new bootstrap.Modal(document.getElementById('securitySettingsModal'));
        securitySettingsModal.show();
    }

    function showApiKeys() {
        const modal = document.createElement('div');
        modal.id = 'apiKeysModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-key me-2"></i>API Key Management</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            API keys allow external applications to securely access your BookaBarber system. Only generate keys for trusted applications.
                        </div>
                        
                        <button class="btn btn-primary mb-3" onclick="generateNewApiKey()">
                            <i class="fas fa-plus me-1"></i> Generate New API Key
                        </button>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Key Name</th>
                                    <th>Last Used</th>
                                    <th>Created</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Mobile App</td>
                                    <td>2025-06-03 14:30</td>
                                    <td>2025-01-15</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-secondary me-1" onclick="viewApiKeyDetails('mobile-app')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1" onclick="regenerateApiKey('mobile-app')">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="revokeApiKey('mobile-app')">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Booking Widget</td>
                                    <td>2025-06-02 09:15</td>
                                    <td>2025-03-20</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-secondary me-1" onclick="viewApiKeyDetails('booking-widget')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1" onclick="regenerateApiKey('booking-widget')">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="revokeApiKey('booking-widget')">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const apiKeysModal = new bootstrap.Modal(document.getElementById('apiKeysModal'));
        apiKeysModal.show();
    }

    function backupSystem() {
        showNotification('Starting system backup...', 'info');
        
        // Add progress indicator
        const progressModal = createProgressModal('System Backup', 'Creating system backup...');
        const progressBar = progressModal._element.querySelector('.progress-bar');
        
        // Show the modal
        progressModal.show();
        
        // Simulate the backup process
        let progress = 0;
        const interval = setInterval(() => {
            progress += 2;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    progressModal.hide();
                    showNotification('System backup completed successfully!', 'success');
                    // Trigger download
                    const a = document.createElement('a');
                    a.href = '/api/super-admin/backup-download';
                    a.download = `barber-shop-backup-${new Date().toISOString().slice(0, 10)}.zip`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                }, 500);
            }
        }, 100);
        
        // Simulate API call
        fetch('/api/super-admin/backup', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .catch(error => {
            console.error('Error creating backup:', error);
        });
    }

    function showRestoreDialog() {
        const modal = document.createElement('div');
        modal.id = 'restoreModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>System Restore</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning">
                            <strong>Warning:</strong> Restoring from a backup will overwrite all current data. This action cannot be undone.
                        </div>
                        <form id="restoreForm">
                            <div class="mb-3">
                                <label for="backupFile" class="form-label">Select Backup File</label>
                                <input class="form-control" type="file" id="backupFile" accept=".zip,.sql">
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="confirmRestore" required>
                                <label class="form-check-label" for="confirmRestore">
                                    I understand that this will overwrite all current data
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" onclick="restoreSystem()" id="restoreButton" disabled>
                            <i class="fas fa-upload me-1"></i>Restore System
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Enable restore button only when file is selected and checkbox is checked
        document.getElementById('backupFile').addEventListener('change', updateRestoreButton);
        document.getElementById('confirmRestore').addEventListener('change', updateRestoreButton);
        
        function updateRestoreButton() {
            const fileSelected = document.getElementById('backupFile').files.length > 0;
            const confirmed = document.getElementById('confirmRestore').checked;
            document.getElementById('restoreButton').disabled = !(fileSelected && confirmed);
        }
        
        const restoreModal = new bootstrap.Modal(document.getElementById('restoreModal'));
        restoreModal.show();
    }

    function searchUsers(e) {
        const searchTerm = (e?.target?.value || document.getElementById('user-search')?.value || '').toLowerCase();
        const userRows = document.querySelectorAll('#users-table tr');
        let resultsCount = 0;
        
        userRows.forEach(row => {
            const name = row.querySelector('.fw-bold')?.textContent.toLowerCase() || '';
            const email = row.querySelector('.text-muted')?.textContent.toLowerCase() || '';
            const userType = row.querySelector('.badge')?.textContent.toLowerCase() || '';
            
            if (name.includes(searchTerm) || email.includes(searchTerm) || userType.includes(searchTerm)) {
                row.style.display = '';
                resultsCount++;
            } else {
                row.style.display = 'none';
            }
        });
        
        // Update results counter if it exists
        const resultsCounter = document.getElementById('user-results-count');
        if (resultsCounter) {
            resultsCounter.textContent = resultsCount;
        }
    }

    // ========== SYSTEM ACTIONS ==========
    function sendTestEmail() {
        fetch('/api/super-admin/test-email', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                showNotification(data.message, data.success ? 'success' : 'error');
            });
    }

    function optimizeDatabase() {
        showNotification('Database optimization in progress...', 'info');
        
        // Add progress indicator
        const progressModal = createProgressModal('Database Optimization', 'Optimizing database tables...');
        const progressBar = progressModal._element.querySelector('.progress-bar');
        
        // Show the modal
        progressModal.show();
        
        // Simulate the optimization process
        let progress = 0;
        const interval = setInterval(() => {
            progress += 5;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    progressModal.hide();
                    showNotification('Database optimization completed successfully!', 'success');
                }, 500);
            }
        }, 200);
        
        // Simulate API call
        fetch('/api/super-admin/optimize-db', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .catch(error => {
            console.error('Error optimizing database:', error);
        });
    }

    function showMaintenanceModeModal() {
        const modal = document.createElement('div');
        modal.id = 'maintenanceModeModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-warning">
                        <h5 class="modal-title"><i class="fas fa-tools me-2"></i>Maintenance Mode</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning">
                            <strong>Warning:</strong> Enabling maintenance mode will make the site temporarily unavailable to regular users. Only administrators will be able to access the site.
                        </div>
                        <form id="maintenanceForm">
                            <div class="mb-3">
                                <label for="maintenanceMessage" class="form-label">Maintenance Message</label>
                                <textarea class="form-control" id="maintenanceMessage" rows="3">We're currently performing scheduled maintenance. The site will be back online shortly. Thank you for your patience!</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="maintenanceDuration" class="form-label">Expected Duration</label>
                                <select class="form-select" id="maintenanceDuration">
                                    <option value="30">30 minutes</option>
                                    <option value="60" selected>1 hour</option>
                                    <option value="120">2 hours</option>
                                    <option value="240">4 hours</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="mb-3" id="customDurationDiv" style="display:none;">
                                <label for="customDuration" class="form-label">Custom Duration (minutes)</label>
                                <input type="number" class="form-control" id="customDuration" min="5" value="60">
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="allowAdmins" checked>
                                <label class="form-check-label" for="allowAdmins">Allow administrators to access the site</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-warning" onclick="enableMaintenanceMode()">
                            <i class="fas fa-tools me-1"></i> Enable Maintenance Mode
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Show the modal
        const maintenanceModeModal = new bootstrap.Modal(document.getElementById('maintenanceModeModal'));
        maintenanceModeModal.show();
        
        // Handle custom duration
        document.getElementById('maintenanceDuration').addEventListener('change', function() {
            const customDurationDiv = document.getElementById('customDurationDiv');
            if (this.value === 'custom') {
                customDurationDiv.style.display = 'block';
            } else {
                customDurationDiv.style.display = 'none';
            }
        });
    }

    function showSystemLogs() {
        const modal = document.createElement('div');
        modal.id = 'systemLogsModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog modal-xl modal-fullscreen-lg-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-file-alt me-2"></i>System Logs</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <select class="form-select" id="logType">
                                    <option value="all">All Logs</option>
                                    <option value="error">Error Logs</option>
                                    <option value="warning">Warning Logs</option>
                                    <option value="info">Info Logs</option>
                                    <option value="debug">Debug Logs</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="logPeriod">
                                    <option value="today">Today</option>
                                    <option value="yesterday">Yesterday</option>
                                    <option value="week" selected>This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Search logs..." id="logSearch">
                                    <button class="btn btn-outline-secondary" type="button">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-primary" onclick="refreshSystemLogs()">
                                    <i class="fas fa-sync-alt me-1"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive" style="max-height: 500px;">
                            <table class="table table-sm table-striped">
                                <thead class="sticky-top bg-light">
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Level</th>
                                        <th>Component</th>
                                        <th>Message</th>
                                        <th>User</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody id="logsTableBody">
                                    <tr>
                                        <td>2025-06-03 13:45:23</td>
                                        <td><span class="badge bg-danger">ERROR</span></td>
                                        <td>Database</td>
                                        <td>Failed to connect to database: Connection timeout</td>
                                        <td>system</td>
                                        <td>127.0.0.1</td>
                                    </tr>
                                    <tr>
                                        <td>2025-06-03 13:45:20</td>
                                        <td><span class="badge bg-warning">WARNING</span></td>
                                        <td>Auth</td>
                                        <td>Failed login attempt for user admin@example.com</td>
                                        <td>anonymous</td>
                                        <td>192.168.1.105</td>
                                    </tr>
                                    <tr>
                                        <td>2025-06-03 13:44:15</td>
                                        <td><span class="badge bg-info">INFO</span></td>
                                        <td>Booking</td>
                                        <td>New booking created: #12458</td>
                                        <td>john@example.com</td>
                                        <td>192.168.1.42</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary me-auto" onclick="downloadSystemLogs()">
                            <i class="fas fa-download me-1"></i> Download Logs
                        </button>
                        <button type="button" class="btn btn-danger" onclick="clearSystemLogs()">
                            <i class="fas fa-trash me-1"></i> Clear Logs
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const systemLogsModal = new bootstrap.Modal(document.getElementById('systemLogsModal'));
        systemLogsModal.show();
    }

    function showBulkUserModal() {
        const modal = document.createElement('div');
        modal.id = 'bulkUserModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-users-cog me-2"></i>Bulk User Management</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="selectAllUsers">
                                    <label class="form-check-label" for="selectAllUsers">Select All</label>
                                </div>
                                <div>
                                    <select class="form-select form-select-sm" id="userFilterType">
                                        <option value="all">All Users</option>
                                        <option value="customer">Customers Only</option>
                                        <option value="barber">Barbers Only</option>
                                        <option value="shop_owner">Shop Owners Only</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="table-responsive" style="max-height: 400px;">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th width="40px"></th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bulkUserTableBody">
                                        <tr>
                                            <td><input type="checkbox" class="form-check-input user-check"></td>
                                            <td>John Doe</td>
                                            <td>john@example.com</td>
                                            <td><span class="badge bg-info">Customer</span></td>
                                            <td><span class="badge bg-success">Active</span></td>
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" class="form-check-input user-check"></td>
                                            <td>Michael Johnson</td>
                                            <td>michael@example.com</td>
                                            <td><span class="badge bg-primary">Barber</span></td>
                                            <td><span class="badge bg-success">Active</span></td>
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" class="form-check-input user-check"></td>
                                            <td="Sarah Smith</td>
                                            <td>sarah@example.com</td>
                                            <td><span class="badge bg-secondary">Shop Owner</span></td>
                                            <td><span class="badge bg-danger">Inactive</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <strong>Tip:</strong> Select multiple users to perform bulk actions like sending notifications or changing user status.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="dropdown me-auto">
                            <button class="btn btn-primary dropdown-toggle" type="button" id="bulkActionsDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-cogs me-1"></i> Bulk Actions
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="bulkActionsDropdown">
                                <li><a class="dropdown-item" href="#" onclick="bulkActivateUsers()"><i class="fas fa-check-circle me-2"></i> Activate Selected</a></li>
                                <li><a class="dropdown-item" href="#" onclick="bulkDeactivateUsers()"><i class="fas fa-ban me-2"></i> Deactivate Selected</a></li>
                                <li><a class="dropdown-item" href="#" onclick="bulkDeleteUsers()"><i class="fas fa-trash me-2"></i> Delete Selected</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="bulkExportUsers()"><i class="fas fa-download me-2"></i> Export Selected</a></li>
                                <li><a class="dropdown-item" href="#" onclick="bulkSendEmail()"><i class="fas fa-envelope me-2"></i> Email Selected</a></li>
                            </ul>
                        </div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const bulkUserModal = new bootstrap.Modal(document.getElementById('bulkUserModal'));
        bulkUserModal.show();
        
        // Add event listener for "Select All" checkbox
        document.getElementById('selectAllUsers').addEventListener('change', function() {
            const checked = this.checked;
            document.querySelectorAll('.user-check').forEach(checkbox => {
                checkbox.checked = checked;
            });
        });
    }

    // ========== ANALYTICS FUNCTIONS ==========
    function refreshAnalytics() {
        showLoadingOverlay('mainAnalyticsChart');
        
        const period = document.getElementById('analytics-period').value;
        let startDate, endDate;
        
        if (period === 'custom') {
            startDate = document.getElementById('date-from').value;
            endDate = document.getElementById('date-to').value;
        } else {
            const today = new Date();
            endDate = today.toISOString().split('T')[0];
            
            if (period === '7days') {
                startDate = new Date(today.setDate(today.getDate() - 7)).toISOString().split('T')[0];
            } else if (period === '30days') {
                startDate = new Date(today.setDate(today.getDate() - 30)).toISOString().split('T')[0];
            } else if (period === '90days') {
                startDate = new Date(today.setDate(today.getDate() - 90)).toISOString().split('T')[0];
            } else {
                startDate = new Date(today.setFullYear(today.getFullYear() - 1)).toISOString().split('T')[0];
            }
        }
        
        setTimeout(() => {
            updateAnalyticsCharts();
            hideLoadingOverlay('mainAnalyticsChart');
            showNotification('Analytics updated successfully!', 'success');
        }, 1200);
    }

    function toggleComparisonPeriod() {
        const compareValue = document.getElementById('analytics-compare').value;
        if (compareValue !== 'none') {
            showNotification('Comparison mode enabled', 'info');
            updateAnalyticsCharts(true);
        } else {
            updateAnalyticsCharts(false);
        }
    }

    function updateAnalyticsCharts(showComparison = false) {
        updateMainChart(showComparison);
        updateDemographicCharts();
        updateServicePopularityChart();
    }

    function updateMainChart(showComparison) {
        const ctx = document.getElementById('mainAnalyticsChart').getContext('2d');
        
        if (window.mainChart) {
            window.mainChart.destroy();
        }
        
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const currentData = [12500, 15000, 18000, 16500, 21000, 22500, 25000, 23000, 26000, 27500, 29000, 32000];
        const comparisonData = [10000, 12000, 14000, 13500, 16000, 17500, 19000, 18500, 20000, 22000, 23500, 25000];
        
        const chartConfig = {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Current Period',
                        data: currentData,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    },
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                }
            }
        };
        
        if (showComparison) {
            chartConfig.data.datasets.push({
                label: 'Previous Period',
                data: comparisonData,
                borderColor: 'rgb(153, 102, 255)',
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                tension: 0.4,
                fill: true
            });
        }
        
        window.mainChart = new Chart(ctx, chartConfig);
    }

    function exportAnalyticsData(format) {
        showNotification(`Exporting data as ${format.toUpperCase()}...`, 'info');
        
        setTimeout(() => {
            showNotification(`Analytics data exported successfully as ${format.toUpperCase()}!`, 'success');
            
            if (format === 'csv') {
                const a = document.createElement('a');
                a.href = 'data:text/csv;charset=utf-8,Date,Revenue,Bookings,Users\n2023-01-01,1250,24,12\n2023-01-02,1340,26,15';
                a.download = 'analytics_export.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }, 1500);
    }

    // ========== SEARCH FUNCTIONS ==========
    function globalSearch() {
        const searchType = document.getElementById('global-search-type').value;
        const searchQuery = document.getElementById('global-search-input').value.trim();
        
        if (!searchQuery) {
            showNotification('Please enter a search term', 'warning');
            return;
        }
        
        document.getElementById('global-search-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        document.getElementById('global-search-btn').disabled = true;
        
        addToRecentSearches(searchQuery);
        
        fetch(`/api/super-admin/search-users?query=${encodeURIComponent(searchQuery)}&type=${searchType}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.users.length === 0) {
                        showNotification(`No users found matching "${searchQuery}"`, 'info');
                    } else if (data.users.length === 1) {
                        showUserProfile(data.users[0]);
                    } else {
                        showSearchResults(data.users, searchQuery);
                    }
                } else {
                    throw new Error(data.message || 'Search failed');
                }
            })
            .catch(error => {
                showNotification(`Error: ${error.message}`, 'error');
            })
            .finally(() => {
                document.getElementById('global-search-btn').innerHTML = '<i class="fas fa-search me-1"></i>Search';
                document.getElementById('global-search-btn').disabled = false;
            });
    }

    function addToRecentSearches(query) {
        let recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
        
        if (!recentSearches.includes(query)) {
            recentSearches.unshift(query);
            recentSearches = recentSearches.slice(0, 5);
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
        }
        
        updateRecentSearchesDisplay();
    }

    function updateRecentSearchesDisplay() {
        const recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
        const container = document.getElementById('recent-searches');
        
        container.innerHTML = '';
        
        recentSearches.forEach(query => {
            const badge = document.createElement('span');
            badge.className = 'badge bg-light text-dark me-1 mb-1 search-history-item';
            badge.innerHTML = `${query} <i class="fas fa-times ms-1" onclick="removeRecentSearch('${query.replace("'", "\\'")}')"></i>`;
            badge.style.cursor = 'pointer';
            badge.addEventListener('click', () => {
                document.getElementById('global-search-input').value = query;
                globalSearch();
            });
            
            container.appendChild(badge);
        });
    }

    function removeRecentSearch(query) {
        event.stopPropagation();
        let recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
        recentSearches = recentSearches.filter(q => q !== query);
        localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
        updateRecentSearchesDisplay();
    }

    function showSearchResults(users, query) {
        const modal = document.createElement('div');
        modal.id = 'searchResultsModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        
        let userRows = '';
        users.forEach(user => {
            const statusBadge = user.status === 'active' ? 
                '<span class="badge bg-success">Active</span>' : 
                '<span class="badge bg-danger">Inactive</span>';
                
            userRows += `
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar-small me-2 bg-light rounded-circle">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <div class="fw-bold">${user.first_name} ${user.last_name}</div>
                                <div class="small text-muted">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td><span class="badge bg-secondary">${user.user_type}</span></td>
                    <td>${statusBadge}</td>
                    <td>${user.created_at || 'N/A'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="showUserProfile(${JSON.stringify(user).replace(/"/g, '&quot;')})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `;
        });
        
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-search me-2"></i>Search Results</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Found <strong>${users.length}</strong> users matching "<strong>${query}</strong>"
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Registration</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${userRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        const searchResultsModal = new bootstrap.Modal(document.getElementById('searchResultsModal'));
        searchResultsModal.show();
    }

    function showUserProfile(user) {
        const searchResultsModal = bootstrap.Modal.getInstance(document.getElementById('searchResultsModal'));
        if (searchResultsModal) searchResultsModal.hide();
        
        const modal = document.createElement('div');
        modal.id = 'userProfileModal';
        modal.className = 'modal fade';
        modal.tabIndex = '-1';
        
        const statusClass = user.status === 'active' ? 'success' : 'danger';
        const statusText = user.status === 'active' ? 'Active' : 'Inactive';
        
        let typeClass = 'secondary';
        if (user.user_type === 'customer') typeClass = 'info';
        else if (user.user_type === 'barber') typeClass = 'primary';
        else if (user.user_type === 'shop_owner') typeClass = 'warning';
        else if (user.user_type === 'super_admin') typeClass = 'danger';
        
        let typeTiles = '';
        
        if (user.user_type === 'customer') {
            typeTiles = `
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">${user.bookings_count || 0}</div>
                        <div class="stat-label">Bookings</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">$${user.total_spent || 0}</div>
                        <div class="stat-label">Spent</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">${user.reviews_count || 0}</div>
                        <div class="stat-label">Reviews</div>
                    </div>
                </div>
            `;
        } else if (user.user_type === 'barber') {
            typeTiles = `
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">${user.bookings_count || 0}</div>
                        <div class="stat-label">Bookings</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">${user.rating || 'N/A'}</div>
                        <div class="stat-label">Rating</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">$${user.earnings || 0}</div>
                        <div class="stat-label">Earnings</div>
                    </div>
                </div>
            `;
        } else if (user.user_type === 'shop_owner') {
            typeTiles = `
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">${user.shops_count || 0}</div>
                        <div class="stat-label">Shops</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">${user.barbers_count || 0}</div>
                        <div class="stat-label">Barbers</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="profile-stat">
                        <div class="stat-value">$${user.revenue || 0}</div>
                        <div class="stat-label">Revenue</div>
                    </div>
                </div>
            `;
        }
        
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-light">
                        <h5 class="modal-title"><i class="fas fa-user-circle me-2"></i>User Profile</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <!-- User Profile Header -->
                        <div class="text-center mb-4">
                            <div class="avatar-large mx-auto mb-3 bg-${typeClass} text-white rounded-circle">
                                <i class="fas fa-user"></i>
                            </div>
                            <h3 class="mb-0">${user.first_name} ${user.last_name}</h3>
                            <div class="text-muted mb-2">${user.email}</div>
                            <div class="d-flex justify-content-center gap-2">
                                <span class="badge bg-${typeClass}">${user.user_type}</span>
                                <span class="badge bg-${statusClass}">${statusText}</span>
                                <span class="badge bg-secondary">ID: ${user.id}</span>
                            </div>
                        </div>
                        
                        <!-- Profile Stats -->
                        <div class="row text-center mb-4">
                            ${typeTiles}
                        </div>
                        
                        <!-- User Information -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0"><i class="fas fa-info-circle me-2"></i>User Information</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-md-3 fw-bold">Phone</div>
                                    <div class="col-md-9">${user.phone || 'Not specified'}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-3 fw-bold">Created</div>
                                    <div class="col-md-9">${user.created_at || 'Unknown'}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-3 fw-bold">Last Login</div>
                                    <div class="col-md-9">${user.last_login || 'Never'}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-3 fw-bold">IP Address</div>
                                    <div class="col-md-9">${user.ip_address || 'Unknown'}</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 fw-bold">Address</div>
                                    <div class="col-md-9">${user.address || 'Not specified'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Activity and Notes -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0"><i class="fas fa-history me-2"></i>Recent Activity</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <ul class="list-group list-group-flush">
                                            ${user.recent_activity ? user.recent_activity.map(activity => 
                                                `<li class="list-group-item">
                                                    <div class="small text-muted">${activity.date}</div>
                                                    <div>${activity.description}</div>
                                                </li>`
                                            ).join('') : '<li class="list-group-item">No recent activity</li>'}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0"><i class="fas fa-sticky-note me-2"></i>Admin Notes</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <textarea class="form-control" id="adminNotes" rows="4">${user.admin_notes || ''}</textarea>
                                        </div>
                                        <button class="btn btn-sm btn-primary" onclick="saveAdminNotes('${user.id}')">
                                            <i class="fas fa-save me-1"></i>Save Notes
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="me-auto">
                            <button type="button" class="btn btn-danger" onclick="showDeleteUserConfirmation('${user.id}', '${user.first_name} ${user.last_name}')">
                                <i class="fas fa-ban me-1"></i>Block User
                            </button>
                        </div>
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="editUser('${user.id}')">
                            <i class="fas fa-edit me-1"></i>Edit User
                        </button>
                        <button type="button" class="btn btn-success" onclick="impersonateUser('${user.id}')">
                            <i class="fas fa-user-secret me-1"></i>Impersonate
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Apply custom styles for the user profile
        const style = document.createElement('style');
        style.textContent = `
            .avatar-large {
                width: 80px;
                height: 80px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
            }
            
            .profile-stat {
                padding: 1rem;
                background: var(--bg-secondary);
                border-radius: 8px;
                border-left: 3px solid var(--card-accent);
            }
            
            .stat-value {
                font-size: 1.5rem;
                font-weight: 700;
            }
            
            .stat-label {
                font-size: 0.875rem;
                color: var(--text-secondary);
            }
        `;
        document.head.appendChild(style);
        
        // Show the modal
        const userProfileModal = new bootstrap.Modal(document.getElementById('userProfileModal'));
        userProfileModal.show();
    }
</script>

{% endblock %}