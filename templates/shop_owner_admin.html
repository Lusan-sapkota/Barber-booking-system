{% extends "base.html" %}

{% block title %}Shop Owner Dashboard - BookaBarber{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
<style>
/* Base Styling with Light/Dark Mode Variables */
:root {
  /* Light Mode (Default) */
  --bg-color: #f8f9fa;
  --text-color: #212529;
  --text-muted: #6c757d;
  --card-bg: #ffffff;
  --card-border: #dee2e6;
  --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
  --header-bg: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
  --header-text: #ffffff;
  --primary-color: #4e54c8;
  --primary-hover: #3c3fa0;
  --success-color: #28a745;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --info-color: #17a2b8;
  --secondary-color: #6c757d;
  --table-border: #dee2e6;
  --table-stripe: #f9f9f9;
  --modal-bg: #ffffff;
  --modal-header: #f8f9fa;
  --modal-border: #dee2e6;
  --input-bg: #ffffff;
  --input-border: #ced4da;
}

/* Dark Mode Variables */
[data-theme="dark"] {
  --bg-color: #121212;
  --text-color: #e0e0e0;
  --text-muted: #adb5bd;
  --card-bg: #1e1e1e;
  --card-border: #333333;
  --card-shadow: 0 4px 6px rgba(0,0,0,0.3);
  --header-bg: linear-gradient(135deg, #2f3241 0%, #121212 100%);
  --header-text: #ffffff;
  --primary-color: #5a60d6;
  --primary-hover: #4c51b9;
  --table-border: #333333;
  --table-stripe: #252525;
  --modal-bg: #1e1e1e;
  --modal-header: #252525;
  --modal-border: #333333;
  --input-bg: #2a2a2a;
  --input-border: #444444;
}

/* Main Layout */
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: all 0.3s ease;
}

.shop-header {
  background: var(--header-bg);
  color: var(--header-text);
  padding: 2rem 0;
  margin-bottom: 2rem;
}

.card {
  background-color: var(--card-bg);
  border: 1px solid var(--card-border);
  box-shadow: var(--card-shadow);
  border-radius: 10px;
  transition: all 0.3s ease;
}

.card:hover {
  transform: none !important;
  box-shadow: none !important;
  background-color: inherit !important; /* Optional */
  cursor: default !important;          /* Optional */
}

.card-header {
  border-bottom: 1px solid var(--card-border);
  background-color: var(--card-bg);
  padding: 1rem;
  font-weight: 600;
}

/* Stats Cards */
.stat-card {
  text-align: center;
  padding: 1.5rem;
  border-radius: 10px;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
}

.revenue-card {
  background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
  color: white;
}

.bookings-card {
  background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
  color: white;
}

.rating-card {
  background: linear-gradient(135deg, #FF9800 0%, #EF6C00 100%);
  color: white;
}

.staff-card {
  background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
  color: white;
}

/* Shop Actions Menu */
.shop-actions {
  position: relative;
  display: inline-block;
}

.shop-actions-content {
  display: none;
  position: absolute;
  right: 0;
  background-color: var(--card-bg);
  min-width: 250px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  z-index: 1001;
  border-radius: 10px;
  padding: 1rem;
  border: 1px solid var(--card-border);
  transition: all 0.3s;
}

.shop-actions:hover .shop-actions-content {
  display: block;
}

.shop-actions-item {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.shop-actions-item:hover {
  background-color: var(--primary-color);
  color: white;
}

.shop-actions-item i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

/* Staff List */
.staff-list {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.staff-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 10px;
  overflow: hidden;
  width: 100%;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.staff-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--card-shadow);
}

.staff-card-header {
  padding: 1rem;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.staff-info {
  display: flex;
  align-items: center;
}

.staff-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 1rem;
}

.staff-name {
  margin: 0;
  font-weight: 600;
  font-size: 1rem;
}

.staff-role {
  color: var(--text-muted);
  font-size: 0.9rem;
}

.staff-status {
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-active {
  background-color: rgba(40, 167, 69, 0.15);
  color: #28a745;
}

.status-inactive {
  background-color: rgba(108, 117, 125, 0.15);
  color: #6c757d;
}

.status-leave {
  background-color: rgba(255, 193, 7, 0.15);
  color: #ffc107;
}

.staff-card-body {
  padding: 1rem;
  border-top: 1px solid var(--card-border);
}

.staff-metrics {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.staff-metric {
  text-align: center;
  flex: 1;
}

.staff-metric-value {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0;
}

.staff-metric-label {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin: 0;
}

/* Schedule */
.schedule-container {
  margin-bottom: 1.5rem;
}

.appointment {
  padding: 0.75rem;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  background-color: var(--card-bg);
  border-left: 4px solid var(--primary-color);
  box-shadow: var(--card-shadow);
}

.appointment-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.appointment-time {
  font-weight: 600;
}

.appointment-status {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 600;
}

.status-confirmed {
  background-color: rgba(33, 150, 243, 0.15);
  color: #2196f3;
}

.status-completed {
  background-color: rgba(40, 167, 69, 0.15);
  color: #28a745;
}

.status-cancelled {
  background-color: rgba(220, 53, 69, 0.15);
  color: #dc3545;
}

.status-checked-in {
  background-color: rgba(255, 193, 7, 0.15);
  color: #ffc107;
}

.appointment-client {
  display: flex;
  align-items: center;
  margin-bottom: 0.5rem;
}

.appointment-client-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  margin-right: 0.5rem;
  object-fit: cover;
}

.appointment-client-name {
  font-weight: 600;
  margin: 0;
  font-size: 0.95rem;
}

.appointment-service {
  color: var(--text-muted);
  margin: 0;
  font-size: 0.85rem;
}

.appointment-barber {
  display: flex;
  align-items: center;
  color: var(--text-muted);
  font-size: 0.85rem;
}

.appointment-barber i {
  margin-right: 0.5rem;
}

/* Reviews */
.review-card {
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  border: 1px solid var(--card-border);
  background-color: var(--card-bg);
}

.review-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.review-author {
  display: flex;
  align-items: center;
}

.review-author-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-right: 0.75rem;
  object-fit: cover;
}

.review-author-name {
  font-weight: 600;
  margin: 0;
}

.review-date {
  color: var(--text-muted);
  font-size: 0.85rem;
}

.review-rating {
  color: #ffc107;
  font-size: 1rem;
}

.review-text {
  margin-bottom: 0.75rem;
  font-size: 0.95rem;
}

.review-barber {
  color: var(--text-muted);
  font-size: 0.85rem;
  margin-bottom: 0.75rem;
}

.review-reply {
  background-color: rgba(0, 0, 0, 0.05);
  padding: 0.75rem;
  border-radius: 8px;
  margin-top: 0.75rem;
  position: relative;
}

[data-theme="dark"] .review-reply {
  background-color: rgba(255, 255, 255, 0.05);
}

.review-reply:before {
  content: '';
  position: absolute;
  top: -8px;
  left: 20px;
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 8px solid rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] .review-reply:before {
  border-bottom-color: rgba(255, 255, 255, 0.05);
}

/* Inventory */
.inventory-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  border-bottom: 1px solid var(--card-border);
}

.inventory-info {
  display: flex;
  align-items: center;
}

.inventory-icon {
  background-color: rgba(33, 150, 243, 0.15);
  color: #2196f3;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
}

.inventory-name {
  margin: 0;
  font-weight: 600;
}

.inventory-stock {
  font-size: 0.85rem;
  color: var(--text-muted);
}

.inventory-low {
  color: #dc3545;
}

/* Dark Mode Toggle */
.dark-mode-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--primary-color);
  border: none;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  color: var(--header-text);
  font-size: 1.2rem;
  z-index: 1000;
}

.dark-mode-toggle:hover {
  transform: scale(1.1);
}

/* Tables */
.table {
  color: var(--text-color);
}

.table th, .table td {
  border-color: var(--table-border);
}

.table-striped tbody tr:nth-of-type(odd) {
  background-color: var(--table-stripe);
}

/* Forms */
.form-control, .form-select {
  background-color: var(--input-bg);
  border-color: var(--input-border);
  color: var(--text-color);
}

/* Shop logo */
.shop-logo {
  position: relative;
  display: inline-block;
  margin-bottom: 1rem;
}

.shop-logo img {
  width: 100px;
  height: 100px;
  border-radius: 10px;
  object-fit: cover;
  border: 3px solid white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.shop-logo .logo-change {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: var(--primary-color);
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

/* Modal overrides */
.modal-content {
  background-color: var(--modal-bg);
  color: var(--text-color);
}

.modal-header {
  background-color: var(--modal-header);
  border-bottom-color: var(--modal-border);
}

.modal-footer {
  border-top-color: var(--modal-border);
}

/* Toast container and animations */
.toast-container {
    z-index: 1050;
}

.toast {
    backdrop-filter: blur(10px);
    border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 10px;
    min-width: 300px;
    transition: all 0.3s ease;
    opacity: 1;
}

.toast.hide {
    opacity: 0;
    transform: translateY(10px);
}

.toast-header {
    background: rgba(255,255,255,0.2);
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.notification-success {
    background-color: rgba(46, 160, 67, 0.15);
}

.notification-error {
    background-color: rgba(248, 81, 73, 0.15);
}

.notification-warning {
    background-color: rgba(210, 153, 34, 0.15);
}

.notification-info {
    background-color: rgba(33, 136, 255, 0.15);
}

/* Dark Mode Versions */
[data-theme="dark"] .toast {
    background-color: rgba(30, 30, 30, 0.95);
    color: #e0e0e0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

[data-theme="dark"] .toast-header {
    background-color: rgba(37, 37, 37, 0.8);
    color: #e0e0e0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

[data-theme="dark"] .btn-close {
    filter: invert(1) grayscale(100%) brightness(200%);
}

[data-theme="dark"] .notification-success {
    background-color: rgba(46, 160, 67, 0.15);
}

[data-theme="dark"] .notification-error {
    background-color: rgba(248, 81, 73, 0.15);
}

[data-theme="dark"] .notification-warning {
    background-color: rgba(210, 153, 34, 0.15);
}

[data-theme="dark"] .notification-info {
    background-color: rgba(33, 136, 255, 0.15);
}

/* Enhanced Dark Mode Styling Fixes */
[data-theme="dark"] {
    color-scheme: dark;
}

/* Fix card backgrounds and headers */
[data-theme="dark"] .card,
[data-theme="dark"] .card-header,
[data-theme="dark"] .modal-content,
[data-theme="dark"] .list-group-item,
[data-theme="dark"] .dropdown-menu {
    background-color: var(--card-bg);
    color: var(--text-color);
}

/* Fix notification center */
[data-theme="dark"] #notifications-list .list-group-item {
    background-color: var(--card-bg);
    border-color: var(--card-border);
}

[data-theme="dark"] .list-group-flush .list-group-item {
    background-color: var(--card-bg);
    border-color: var(--card-border);
}

/* Fix activity log */
[data-theme="dark"] .table {
    color: var(--text-color);
}

[data-theme="dark"] .table-hover tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .table-striped tbody tr:nth-of-type(odd) {
    background-color: rgba(255, 255, 255, 0.02);
}

/* Fix modal and review containers */
[data-theme="dark"] .modal-body {
    background-color: var(--card-bg);
    color: var(--text-color);
}

[data-theme="dark"] .review-summary,
[data-theme="dark"] .bg-light,
[data-theme="dark"] .review-stats-card.bg-white,
[data-theme="dark"] .review-card-extended,
[data-theme="dark"] .review-response {
    background-color: var(--modal-header) !important;
    color: var(--text-color);
}

/* Fix headers with colored backgrounds */
[data-theme="dark"] .modal-header.bg-primary {
    background-color: #4e54c8 !important;
}

[data-theme="dark"] .modal-header.bg-secondary {
    background-color: #6c757d !important;
}

[data-theme="dark"] .card-header.bg-primary {
    background-color: #4e54c8 !important;
}

/* Fix dropdowns */
[data-theme="dark"] .dropdown-item {
    color: var(--text-color);
}

[data-theme="dark"] .dropdown-item:hover, 
[data-theme="dark"] .dropdown-item:focus {
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--text-color);
}

[data-theme="dark"] .dropdown-divider {
    border-top: 1px solid var(--card-border);
}

/* Fix tickets list and detail */
[data-theme="dark"] .tickets-container,
[data-theme="dark"] .tickets-list,
[data-theme="dark"] .ticket-detail {
    background-color: var(--card-bg);
    color: var(--text-color);
}

[data-theme="dark"] .ticket-item {
    background-color: var(--card-bg);
}

[data-theme="dark"] .ticket-item:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .ticket-item.active {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Override any bootstrap white backgrounds */
[data-theme="dark"] .bg-white {
    background-color: var(--card-bg) !important;
}

/* Fix pagination */
[data-theme="dark"] .page-item:not(.active) .page-link {
    background-color: var(--card-bg);
    border-color: var(--card-border);
    color: var(--text-color);
}

[data-theme="dark"] .page-item.disabled .page-link {
    background-color: var(--card-bg);
    border-color: var(--card-border);
    color: var(--text-muted);
}

/* Reviews container */
[data-theme="dark"] .reviews-container {
    background-color: var(--bg-color) !important;
}

/* Fix border colors */
[data-theme="dark"] .border,
[data-theme="dark"] .border-bottom,
[data-theme="dark"] .border-top,
[data-theme="dark"] .border-start,
[data-theme="dark"] .border-end {
    border-color: var(--card-border) !important;
}

/* Fix spinner colors */
[data-theme="dark"] .spinner-border.text-primary {
    color: var(--primary-color) !important;
}

/* Fix shop actions dropdown */
[data-theme="dark"] .shop-actions-content {
    background-color: var(--card-bg);
    border-color: var(--card-border);
}

/* Stats cards maintain their gradient colors */
[data-theme="dark"] .stat-card {
    color: white !important;
}

/* Fix form inputs inside modals */
[data-theme="dark"] .modal input,
[data-theme="dark"] .modal textarea,
[data-theme="dark"] .modal select {
    background-color: var(--input-bg);
    border-color: var(--input-border);
    color: var(--text-color);
}

/* Fix input groups */
[data-theme="dark"] .input-group-text {
    background-color: var(--modal-header);
    border-color: var(--input-border);
    color: var(--text-color);
}

/* Fix buttons */
[data-theme="dark"] .btn-light {
    background-color: var(--modal-header);
    border-color: var(--card-border);
    color: var(--text-color);
}

[data-theme="dark"] .btn-outline-secondary {
    color: var(--text-color);
    border-color: var(--secondary-color);
}

/* Ensure proper dark mode spacing at bottom of page */
[data-theme="dark"] .container {
    margin-bottom: 80px;
}
</style>
{% endblock %}

{% block content %}
<div class="shop-owner-dashboard">
    <!-- Dashboard Header -->
    <section class="shop-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="shop-logo">
                        <img src="https://via.placeholder.com/100" alt="Shop Logo" id="shop-logo-img">
                        <div class="logo-change" onclick="changeShopLogo()">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <h1 class="mb-2" id="shop-name">Loading shop information...</h1>
                    <p class="mb-0 opacity-75" id="shop-description">Please wait...</p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <div class="shop-actions">
                        <button class="btn btn-light btn-lg shadow-sm">
                            <i class="fas fa-cog me-2"></i>Shop Actions
                        </button>
                        <div class="shop-actions-content">
                            <div class="shop-actions-item" onclick="editShopProfile()">
                                <i class="fas fa-store"></i> Edit Shop Profile
                            </div>
                            <div class="shop-actions-item" onclick="toggleShopStatus()">
                                <i class="fas fa-toggle-on"></i> Toggle Shop Status
                            </div>
                            <div class="shop-actions-item" onclick="manageShopHours()">
                                <i class="fas fa-clock"></i> Manage Hours
                            </div>
                            <div class="shop-actions-item" onclick="manageShopPolicies()">
                                <i class="fas fa-file-alt"></i> Shop Policies
                            </div>
                            <div class="shop-actions-item" onclick="viewShopAnalytics()">
                                <i class="fas fa-chart-line"></i> Advanced Analytics
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- Key Stats -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stat-card revenue-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-dollar-sign fa-2x"></i>
                    </div>
                    <h3 class="mb-1">$<span id="monthly-revenue">4,250</span></h3>
                    <small>Monthly Revenue</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-arrow-up me-1"></i> <span id="revenue-trend">12%</span> from last month
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card bookings-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                    <h3 class="mb-1"><span id="today-bookings">15</span></h3>
                    <small>Today's Bookings</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-arrow-up me-1"></i> <span id="bookings-trend">3</span> more than yesterday
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card rating-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-star fa-2x"></i>
                    </div>
                    <h3 class="mb-1"><span id="customer-rating">4.8</span></h3>
                    <small>Customer Rating</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-star me-1"></i> Based on <span id="review-count">142</span> reviews
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card staff-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                    <h3 class="mb-1"><span id="active-staff">7</span></h3>
                    <small>Active Staff</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-check-circle me-1"></i> <span id="staff-status">All barbers available</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- Today's Schedule -->
            <div class="col-lg-8 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar-day me-2"></i>Today's Schedule
                        </h5>
                        <div>
                            <button class="btn btn-light btn-sm me-2" onclick="previousDay()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="current-date">Today</span>
                            <button class="btn btn-light btn-sm ms-2" onclick="nextDay()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body schedule-container" id="schedule-container">
                        <!-- Schedule will be loaded here -->
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-3">Loading schedule...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt me-2"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-3">
                            <button class="btn btn-primary shadow-sm" onclick="manageServices()">
                                <i class="fas fa-cut me-2"></i>Manage Services
                            </button>
                            <button class="btn btn-success shadow-sm" onclick="addPromotion()">
                                <i class="fas fa-tags me-2"></i>Add Promotion
                            </button>
                            <button class="btn btn-warning shadow-sm" onclick="manageReviews()">
                                <i class="fas fa-star me-2"></i>Manage Reviews
                            </button>
                            <button class="btn btn-info shadow-sm" onclick="inventoryAlert()">
                                <i class="fas fa-box me-2"></i>Inventory Management
                            </button>
                            <button class="btn btn-secondary shadow-sm" onclick="viewSupportTickets()">
                                <i class="fas fa-ticket-alt me-2"></i>Support Tickets
                            </button>
                            <button class="btn btn-danger shadow-sm" onclick="sendNotification()">
                                <i class="fas fa-bell me-2"></i>Send Notification
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- Staff Management -->
            <div class="col-lg-8 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-user-tie me-2"></i>Staff Management
                        </h5>
                        <button class="btn btn-sm btn-primary" onclick="addNewStaff()">
                            <i class="fas fa-plus me-1"></i>Add Staff
                        </button>
                    </div>
                    <div class="card-body" id="staff-list-container">
                        <!-- Staff will be loaded here -->
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-3">Loading staff members...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Analytics -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Revenue Analytics
                        </h5>
                        <select class="form-select form-select-sm" style="width: auto;" id="revenue-period" onchange="updateRevenueChart()">
                            <option value="week">This Week</option>
                            <option value="month" selected>This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <canvas id="revenue-chart" height="250"></canvas>
                        
                        <div class="mt-4">
                            <h6>Top Services by Revenue</h6>
                            <div id="top-services-container">
                                <!-- Top services will be loaded here -->
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Recent Reviews -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-star me-2"></i>Recent Reviews
                        </h5>
                        <button class="btn btn-sm btn-primary" onclick="viewAllReviews()">
                            View All
                        </button>
                    </div>
                    <div class="card-body" id="reviews-container">
                        <!-- Reviews will be loaded here -->
                        <div class="d-flex justify-content-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Center -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-bell me-2"></i>Notification Center
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" onclick="markAllAsRead()">
                                <i class="fas fa-check-double me-1"></i>Mark All Read
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="notifications-list">
                            <!-- Notifications will be loaded here -->
                            <li class="list-group-item text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="text-muted mt-3">Loading notifications...</p>
                            </li>
                        </ul>
                    </div>
                    <div class="card-footer text-center">
                        <a href="#" class="text-primary" onclick="viewAllNotifications()">View All Notifications</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Activity Logs -->
        <div class="row">
            <div class="col-12 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-history me-2"></i>Recent Activity
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="exportActivityLog()">
                            <i class="fas fa-download me-1"></i>Export Log
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Action</th>
                                        <th>Staff Member</th>
                                        <th>Details</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-log-table">
                                    <!-- Activity logs will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Add Promotion Modal -->
<div class="modal fade" id="promotionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Promotion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="promotion-form">
                    <div class="mb-3">
                        <label for="promo-name" class="form-label">Promotion Name</label>
                        <input type="text" class="form-control" id="promo-name" placeholder="Summer Special, Holiday Discount, etc.">
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label for="promo-start" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="promo-start">
                        </div>
                        <div class="col-6">
                            <label for="promo-end" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="promo-end">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="promo-type" class="form-label">Promotion Type</label>
                        <select class="form-select" id="promo-type">
                            <option value="percentage">Percentage Discount</option>
                            <option value="fixed">Fixed Amount Discount</option>
                            <option value="bogo">Buy One Get One Free</option>
                            <option value="free">Free Add-on Service</option>
                        </select>
                    </div>
                    <div class="mb-3" id="discount-value-container">
                        <label for="discount-value" class="form-label">Discount Value</label>
                        <div class="input-group">
                            <span class="input-group-text" id="discount-symbol">%</span>
                            <input type="number" class="form-control" id="discount-value" min="1" max="100" value="10">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="applicable-services" class="form-label">Applicable Services</label>
                        <select class="form-select" id="applicable-services" multiple size="4">
                            <option value="all" selected>All Services</option>
                            <option value="1">Classic Haircut</option>
                            <option value="2">Premium Haircut</option>
                            <option value="3">Beard Trim</option>
                            <option value="4">Hot Towel Shave</option>
                            <option value="5">Haircut & Beard Combo</option>
                        </select>
                        <div class="form-text">
                            Hold Ctrl/Cmd to select multiple services
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="promo-description" class="form-label">Promotion Description</label>
                        <textarea class="form-control" id="promo-description" rows="3" placeholder="Describe your promotion in detail..."></textarea>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="promo-active" checked>
                        <label class="form-check-label" for="promo-active">Activate promotion immediately</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="savePromotion()">
                    <i class="fas fa-save me-2"></i>Create Promotion
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the dashboard
    loadShopInfo();
    loadStaffMembers();
    loadSchedule();
    initializeRevenueChart();
    loadReviews();
    loadNotifications();
    loadActivityLog();
    loadTopServices();
    
    // Initialize real-time data refresh
    setInterval(refreshDashboardData, 60000); // Refresh every minute
});

// Load Shop Information
function loadShopInfo() {
    fetch('/api/shop-owner/profile')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            document.getElementById('shop-name').textContent = data.name;
            document.getElementById('shop-description').textContent = data.description;
            if (data.logo_url) {
                document.getElementById('shop-logo-img').src = data.logo_url;
            }
            
            // Update stats
            document.getElementById('monthly-revenue').textContent = data.stats.monthly_revenue.toLocaleString();
            document.getElementById('revenue-trend').textContent = data.stats.revenue_trend + '%';
            document.getElementById('today-bookings').textContent = data.stats.today_bookings;
            document.getElementById('bookings-trend').textContent = data.stats.bookings_trend;
            document.getElementById('customer-rating').textContent = data.stats.customer_rating;
            document.getElementById('review-count').textContent = data.stats.review_count;
            document.getElementById('active-staff').textContent = data.stats.active_staff;
            document.getElementById('staff-status').textContent = data.stats.staff_status;
        })
        .catch(error => {
            console.error('Error loading shop info:', error);
            
            // Use mock data
            const mockShopData = {
                name: "Elite Cuts Barbershop",
                description: "Premium grooming services since 2018",
                logo_url: "https://via.placeholder.com/100",
                stats: {
                    monthly_revenue: 4250,
                    revenue_trend: 12,
                    today_bookings: 15,
                    bookings_trend: 3,
                    customer_rating: 4.8,
                    review_count: 142,
                    active_staff: 7,
                    staff_status: "All barbers available"
                }
            };
            
            document.getElementById('shop-name').textContent = mockShopData.name;
            document.getElementById('shop-description').textContent = mockShopData.description;
            document.getElementById('shop-logo-img').src = mockShopData.logo_url;
            
            // Update stats with mock data
            document.getElementById('monthly-revenue').textContent = mockShopData.stats.monthly_revenue.toLocaleString();
            document.getElementById('revenue-trend').textContent = mockShopData.stats.revenue_trend + '%';
            document.getElementById('today-bookings').textContent = mockShopData.stats.today_bookings;
            document.getElementById('bookings-trend').textContent = mockShopData.stats.bookings_trend;
            document.getElementById('customer-rating').textContent = mockShopData.stats.customer_rating;
            document.getElementById('review-count').textContent = mockShopData.stats.review_count;
            document.getElementById('active-staff').textContent = mockShopData.stats.active_staff;
            document.getElementById('staff-status').textContent = mockShopData.stats.staff_status;
        });
}

// Load Staff Members
function loadStaffMembers() {
    const staffContainer = document.getElementById('staff-list-container');
    
    fetch('/api/shop-owner/staff')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderStaffMembers(data);
        })
        .catch(error => {
            console.error('Error loading staff members:', error);
            
            // Use mock data
            const mockStaff = [
                {
                    id: 1,
                    first_name: "Michael",
                    last_name: "Johnson",
                    avatar: "https://ui-avatars.com/api/?name=Michael+Johnson&background=random",
                    role: "Senior Barber",
                    status: "active",
                    metrics: {
                        bookings: 42,
                        rating: 4.9,
                        revenue: 1250
                    }
                },
                {
                    id: 2,
                    first_name: "James",
                    last_name: "Wilson",
                    avatar: "https://ui-avatars.com/api/?name=James+Wilson&background=random",
                    role: "Master Barber",
                    status: "active",
                    metrics: {
                        bookings: 38,
                        rating: 4.7,
                        revenue: 1120
                    }
                },
                {
                    id: 3,
                    first_name: "Chris",
                    last_name: "Adams",
                    avatar: "https://ui-avatars.com/api/?name=Chris+Adams&background=random",
                    role: "Barber",
                    status: "leave",
                    metrics: {
                        bookings: 0,
                        rating: 4.8,
                        revenue: 0
                    }
                },
                {
                    id: 4,
                    first_name: "Lisa",
                    last_name: "Rodriguez",
                    avatar: "https://ui-avatars.com/api/?name=Lisa+Rodriguez&background=random",
                    role: "Stylist",
                    status: "active",
                    metrics: {
                        bookings: 32,
                        rating: 4.9,
                        revenue: 980
                    }
                }
            ];
            
            renderStaffMembers(mockStaff);
        });
}

function renderStaffMembers(staffMembers) {
    const staffContainer = document.getElementById('staff-list-container');
    
    const html = `
        <div class="row">
            ${staffMembers.map(staff => `
                <div class="col-lg-6 mb-3">
                    <div class="staff-card">
                        <div class="staff-card-header">
                            <div class="staff-info">
                                <img src="${staff.avatar}" class="staff-avatar" alt="${staff.first_name} ${staff.last_name}">
                                <div>
                                    <h6 class="staff-name">${staff.first_name} ${staff.last_name}</h6>
                                    <span class="staff-role">${staff.role}</span>
                                </div>
                            </div>
                            <span class="staff-status status-${staff.status}">${staff.status === 'active' ? 'Active' : staff.status === 'leave' ? 'On Leave' : 'Inactive'}</span>
                        </div>
                        <div class="staff-card-body">
                            <div class="staff-metrics">
                                <div class="staff-metric">
                                    <p class="staff-metric-value">${staff.metrics.bookings}</p>
                                    <p class="staff-metric-label">Bookings</p>
                                </div>
                                <div class="staff-metric">
                                    <p class="staff-metric-value">${staff.metrics.rating}</p>
                                    <p class="staff-metric-label">Rating</p>
                                </div>
                                <div class="staff-metric">
                                    <p class="staff-metric-value">$${staff.metrics.revenue}</p>
                                    <p class="staff-metric-label">Revenue</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-sm btn-outline-primary" onclick="editStaff(${staff.id})">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </button>
                                <div>
                                    ${staff.status === 'active' ? 
                                        `<button class="btn btn-sm btn-outline-danger" onclick="deactivateStaff(${staff.id})">
                                        </button>` : 
                                        `<button class="btn btn-sm btn-outline-success" onclick="updateStaffStatus(${staff.id})">
                                        </button>`
                                    }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('')}
    </div>
`;
    
    staffContainer.innerHTML = html;
}

// Load Schedule
function loadSchedule() {
    const scheduleContainer = document.getElementById('schedule-container');
    
    fetch('/api/shop-owner/schedule?date=' + new Date().toISOString().split('T')[0])
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderSchedule(data);
        })
        .catch(error => {
            console.error('Error loading schedule:', error);
            
            // Use mock data
            const mockSchedule = [
                {
                    time: "9:00 AM",
                    status: "confirmed",
                    client: {
                        name: "John Smith",
                        avatar: "https://ui-avatars.com/api/?name=John+Smith&background=random"
                    },
                    service: "Classic Haircut",
                    barber: "Michael Johnson"
                },
                {
                    time: "10:00 AM",
                    status: "checked-in",
                    client: {
                        name: "Robert Davis",
                        avatar: "https://ui-avatars.com/api/?name=Robert+Davis&background=random"
                    },
                    service: "Premium Haircut & Beard Trim",
                    barber: "James Wilson"
                },
                {
                    time: "11:30 AM",
                    status: "confirmed",
                    client: {
                        name: "David Miller",
                        avatar: "https://ui-avatars.com/api/?name=David+Miller&background=random"
                    },
                    service: "Hot Towel Shave",
                    barber: "Chris Adams"
                },
                {
                    time: "1:00 PM",
                    status: "completed",
                    client: {
                        name: "Richard Thomas",
                        avatar: "https://ui-avatars.com/api/?name=Richard+Thomas&background=random"
                    },
                    service: "Haircut & Styling",
                    barber: "Michael Johnson"
                }
            ];
            
            renderSchedule(mockSchedule);
        });
}

function renderSchedule(appointments) {
    const scheduleContainer = document.getElementById('schedule-container');
    
    if (appointments.length === 0) {
        scheduleContainer.innerHTML = `
            <div class="text-center py-4">
                <i class="fas fa-calendar-day fa-3x text-muted mb-3"></i>
                <p class="text-muted">No appointments scheduled for today.</p>
            </div>
        `;
        return;
    }
    
    const html = appointments.map(appt => `
        <div class="appointment">
            <div class="appointment-header">
                <span class="appointment-time">${appt.time}</span>
                <span class="appointment-status status-${appt.status}">${appt.status === 'confirmed' ? 'Confirmed' : appt.status === 'checked-in' ? 'Checked In' : appt.status === 'completed' ? 'Completed' : 'Cancelled'}</span>
            </div>
            <div class="appointment-client">
                <img src="${appt.client.avatar}" class="appointment-client-avatar" alt="${appt.client.name}">
                <div>
                    <h6 class="appointment-client-name">${appt.client.name}</h6>
                    <p class="appointment-service">${appt.service}</p>
                </div>
            </div>
            <div class="appointment-barber">
                <i class="fas fa-user-tie"></i> Barber: ${appt.barber}
            </div>
        </div>
    `).join('');
    
    scheduleContainer.innerHTML = html;
}

// Load Top Services
function loadTopServices() {
    const topServicesContainer = document.getElementById('top-services-container');
    
    fetch('/api/shop-owner/top-services')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderTopServices(data);
        })
        .catch(error => {
            console.error('Error loading top services:', error);
            
            // Use mock data
            const mockTopServices = [
                { 
                    name: "Haircut + Beard Trim", 
                    revenue: 1680, 
                    percentage: 60 
                },
                { 
                    name: "Classic Haircut", 
                    revenue: 1250, 
                    percentage: 45 
                },
                { 
                    name: "Premium Package", 
                    revenue: 850, 
                    percentage: 30 
                }
            ];
            
            renderTopServices(mockTopServices);
        });
}

function renderTopServices(services) {
    const topServicesContainer = document.getElementById('top-services-container');
    
    const html = services.map(service => `
        <div class="mb-3">
            <div class="d-flex justify-content-between">
                <div>${service.name}</div>
                <div><strong>$${service.revenue.toLocaleString()}</strong></div>
            </div>
            <div class="progress">
                <div class="progress-bar bg-primary" style="width: ${service.percentage}%"></div>
            </div>
        </div>
    `).join('');
    
    topServicesContainer.innerHTML = html;
}

// Load Notifications
function loadNotifications() {
    const notificationsList = document.getElementById('notifications-list');
    
    fetch('/api/shop-owner/notifications')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderNotifications(data);
        })
        .catch(error => {
            console.error('Error loading notifications:', error);
            
            // Use mock data
            const mockNotifications = [
                {
                    id: 1,
                    type: "booking",
                    title: "New Booking Request",
                    message: "John Smith booked a Classic Haircut for tomorrow at 10:00 AM",
                    time: "10 min ago",
                    read: false
                },
                {
                    id: 2,
                    type: "review",
                    title: "New Review",
                    message: "Mark Williams left a 5-star review for Michael Johnson",
                    time: "2 hours ago",
                    read: false
                },
                {
                    id: 3,
                    type: "inventory",
                    title: "Low Inventory Alert",
                    message: "Premium Hair Spray is running low (2 units remaining)",
                    time: "Yesterday",
                    read: true
                },
                {
                    id: 4,
                    type: "payment",
                    title: "Payment Received",
                    message: "$540.00 has been deposited to your account",
                    time: "3 days ago",
                    read: true
                }
            ];
            
            renderNotifications(mockNotifications);
        });
}

function renderNotifications(notifications) {
    const notificationsList = document.getElementById('notifications-list');
    
    if (notifications.length === 0) {
        notificationsList.innerHTML = `
            <li class="list-group-item text-center py-4">
                <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
                <p class="text-muted">No notifications at this time.</p>
            </li>
        `;
        return;
    }
    
    const html = notifications.map(notification => {
        let iconClass = '';
        let iconColor = '';
        
        switch(notification.type) {
            case 'booking':
                iconClass = 'fas fa-calendar-check';
                iconColor = 'text-primary';
                break;
            case 'review':
                iconClass = 'fas fa-star';
                iconColor = 'text-warning';
                break;
            case 'inventory':
                iconClass = 'fas fa-box-open';
                iconColor = 'text-danger';
                break;
            case 'payment':
                iconClass = 'fas fa-money-bill-wave';
                iconColor = 'text-success';
                break;
            default:
                iconClass = 'fas fa-bell';
                iconColor = 'text-primary';
        }
        
        return `
            <li class="list-group-item d-flex align-items-center ${notification.read ? '' : 'unread-notification'}">
                <span class="notification-icon ${iconColor} me-3">
                    <i class="${iconClass}"></i>
                </span>
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between">
                        <h6 class="mb-1">${notification.title}</h6>
                        <small class="text-muted">${notification.time}</small>
                    </div>
                    <p class="mb-0 text-muted">${notification.message}</p>
                </div>
                <button class="btn btn-sm text-muted ms-2" onclick="dismissNotification(${notification.id})">
                    <i class="fas fa-times"></i>
                </button>
            </li>
        `;
    }).join('');
    
    notificationsList.innerHTML = html;
}

// Load Activity Log
function loadActivityLog() {
    const activityLogTable = document.getElementById('activity-log-table');
    
    fetch('/api/shop-owner/activity-log')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderActivityLog(data);
        })
        .catch(error => {
            console.error('Error loading activity log:', error);
            
            // Use mock data
            const mockActivityLog = [
                {
                    action: "create",
                    staff: "Michael Johnson",
                    details: "Created a new booking for John Smith",
                    time: "Today, 11:32 AM"
                },
                {
                    action: "update",
                    staff: "James Wilson",
                    details: "Updated service price: Hot Towel Shave from $25 to $30",
                    time: "Today, 10:15 AM"
                },
                {
                    action: "status",
                    staff: "Lisa Rodriguez",
                    details: "Changed booking status to \"Checked In\" for Robert Davis",
                    time: "Today, 9:48 AM"
                },
                {
                    action: "complete",
                    staff: "Michael Johnson",
                    details: "Marked booking as \"Completed\" for Richard Thomas",
                    time: "Today, 1:22 PM"
                },
                {
                    action: "cancel",
                    staff: "System",
                    details: "Automatically cancelled no-show appointment for Alex Johnson",
                    time: "Yesterday, 4:30 PM"
                }
            ];
            
            renderActivityLog(mockActivityLog);
        });
}

function renderActivityLog(logs) {
    const activityLogTable = document.getElementById('activity-log-table');
    
    if (logs.length === 0) {
        activityLogTable.innerHTML = `
            <tr>
                <td colspan="4" class="text-center py-4">
                    <i class="fas fa-history fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No activity logs available.</p>
                </td>
            </tr>
        `;
        return;
    }
    
    const html = logs.map(log => {
        let badgeClass = '';
        
        switch(log.action) {
            case 'create':
                badgeClass = 'bg-success';
                break;
            case 'update':
                badgeClass = 'bg-info';
                break;
            case 'status':
                badgeClass = 'bg-warning';
                break;
            case 'complete':
                badgeClass = 'bg-primary';
                break;
            case 'cancel':
                badgeClass = 'bg-danger';
                break;
            default:
                badgeClass = 'bg-secondary';
        }
        
        return `
            <tr>
                <td><span class="badge ${badgeClass}">${log.action.charAt(0).toUpperCase() + log.action.slice(1)}</span></td>
                <td>${log.staff}</td>
                <td>${log.details}</td>
                <td>${log.time}</td>
            </tr>
        `;
    }).join('');
    
    activityLogTable.innerHTML = html;
}

// Revenue Chart
function initializeRevenueChart() {
    const ctx = document.getElementById('revenue-chart').getContext('2d');
    
    // Load data from API or use demo data
    fetch('/api/shop-owner/revenue-data?period=month')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            createRevenueChart(ctx, data.labels, data.values);
        })
        .catch(error => {
            console.error('Error fetching revenue data:', error);
            
            // Use demo data if API call fails
            const demoLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const demoData = [1200, 1380, 950, 720];
            createRevenueChart(ctx, demoLabels, demoData);
        });
}

function createRevenueChart(context, labels, data) {
    // Destroy previous chart if it exists
    if (window.revenueChart) {
        window.revenueChart.destroy();
    }
    
    window.revenueChart = new Chart(context, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue ($)',
                data: data,
                backgroundColor: 'rgba(78, 84, 200, 0.7)',
                borderColor: 'rgba(78, 84, 200, 1)',
                borderWidth: 1,
                borderRadius: 5,
                barThickness: 25
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
}

function updateRevenueChart() {
    const period = document.getElementById('revenue-period').value;
    
    // Try to fetch data from API
    fetch(`/api/shop-owner/revenue-data?period=${period}`)
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            updateChartData(data.labels, data.values);
        })
        .catch(error => {
            console.error('Error updating revenue data:', error);
            
            // Use demo data
            let demoLabels, demoData;
            
            switch(period) {
                case 'week':
                    demoLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    demoData = [320, 280, 350, 290, 410, 520, 380];
                    break;
                case 'month':
                    demoLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    demoData = [1200, 1380, 950, 720];
                    break;
                case 'quarter':
                    demoLabels = ['Month 1', 'Month 2', 'Month 3'];
                    demoData = [4250, 3980, 4750];
                    break;
                case 'year':
                    demoLabels = ['Q1', 'Q2', 'Q3', 'Q4'];
                    demoData = [12500, 14200, 13800, 15300];
                    break;
            }
            
            updateChartData(demoLabels, demoData);
        });
}

function updateChartData(labels, data) {
    if (window.revenueChart) {
        window.revenueChart.data.labels = labels;
        window.revenueChart.data.datasets[0].data = data;
        window.revenueChart.update();
    }
}

// Load Reviews
function loadReviews() {
    const reviewsContainer = document.getElementById('reviews-container');
    
    fetch('/api/shop-owner/reviews?limit=3&sort=newest')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data.success && data.reviews.length > 0) {
                reviewsContainer.innerHTML = renderReviews(data.reviews);
            } else {
                reviewsContainer.innerHTML = '<div class="text-center py-4"><p class="text-muted">No reviews yet</p></div>';
            }
        })
        .catch(error => {
            console.error('Error loading reviews:', error);
            
            // Load demo reviews
            const demoReviews = [
                {
                    id: 1,
                    customer: { name: 'Mark Williams', avatar: 'https://ui-avatars.com/api/?name=Mark+Williams&background=random' },
                    rating: 5,
                    text: 'Michael did an amazing job with my haircut. The attention to detail was impressive and the shop atmosphere is fantastic. Will definitely be coming back!',
                    date: '2 days ago',
                    barber: 'Michael Johnson',
                    response: null
                },
                {
                    id: 2,
                    customer: { name: 'Sarah Johnson', avatar: 'https://ui-avatars.com/api/?name=Sarah+Johnson&background=random' },
                    rating: 4,
                    text: 'Great service but had to wait about 15 minutes past my appointment time. The haircut was excellent though and James was very professional.',
                    date: '4 days ago',
                    barber: 'James Wilson',
                    response: 'Thank you for your feedback, Sarah! We apologize for the wait time and are working on improving our scheduling. We\'re glad you enjoyed your haircut and look forward to serving you better next time!'
                },
                {
                    id: 3,
                    customer: { name: 'David Brown', avatar: 'https://ui-avatars.com/api/?name=David+Brown&background=random' },
                    rating: 5,
                    text: 'Best barbershop in town! Chris gave me exactly the style I was looking for. The hot towel treatment was amazing too.',
                    date: '1 week ago',
                    barber: 'Chris Adams',
                    response: null
                }
            ];
            
            reviewsContainer.innerHTML = renderReviews(demoReviews);
        });
}

function renderReviews(reviews) {
    return reviews.map(review => `
        <div class="review-card">
            <div class="review-header">
                <div class="review-author">
                    <img src="${review.customer.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(review.customer.name)}&background=random`}" class="review-author-avatar" alt="${review.customer.name}">
                    <div>
                        <h6 class="review-author-name">${review.customer.name}</h6>
                        <div class="review-date">${review.date}</div>
                    </div>
                </div>
                <div class="review-rating">
                    ${renderStars(review.rating)}
                </div>
            </div>
            <div class="review-text">
                ${review.text}
            </div>
            <div class="review-barber">
                <i class="fas fa-user-tie me-1"></i> Service by: ${review.barber}
            </div>
            ${review.response ? `
                <div class="review-reply">
                    <strong>Shop Response:</strong> ${review.response}
                </div>
            ` : `
                <div class="d-flex justify-content-end">
                    <button class="btn btn-sm btn-outline-primary" onclick="replyToReview(${review.id})">
                        <i class="fas fa-reply me-1"></i>Reply
                    </button>
                </div>
            `}
        </div>
    `).join('');
}

function renderStars(rating) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
            stars += '<i class="fas fa-star"></i>';
        } else {
            stars += '<i class="far fa-star"></i>';
        }
    }
    return stars;
}

// Dashboard refresh
function refreshDashboardData() {
    console.log('Refreshing dashboard data...');
    loadSchedule();
    loadReviews();
    loadNotifications();
}

// Shop Management Functions
function editShopProfile() {
    // Pull shop data
    const shopName = document.getElementById('shop-name').textContent;
    const shopDescription = document.getElementById('shop-description').textContent;
    
    // Set form values if available
    if (document.getElementById('shop-name-input')) {
        document.getElementById('shop-name-input').value = shopName || 'Elite Cuts Barbershop';
        document.getElementById('shop-description-input').value = shopDescription || 'Premium grooming services since 2018';
    }
    
    // Show modal
    const shopProfileModal = new bootstrap.Modal(document.getElementById('shopProfileModal'));
    shopProfileModal.show();
}

function changeShopLogo() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.onchange = uploadShopLogo;
    fileInput.click();
}

function uploadShopLogo(event) {
    const file = event.target.files[0];
    if (!file) return;

    showNotification('Logo Upload', 'Uploading logo...', 'info');
    
    // In a real app, you would use FormData to upload the file
    // Here we'll just simulate success after a delay
    setTimeout(() => {
        showNotification('Logo Upload', 'Logo updated successfully!', 'success');
        
        // Update logo preview (simulate)
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('shop-logo-img').src = e.target.result;
        }
        reader.readAsDataURL(file);
    }, 1500);
}

function saveShopProfile() {
    const shopName = document.getElementById('shop-name-input').value;
    const shopDescription = document.getElementById('shop-description-input').value;
    
    // Update shop info on main page
    document.getElementById('shop-name').textContent = shopName;
    document.getElementById('shop-description').textContent = shopDescription;
    
    // Show success notification
    showNotification('Shop Profile', 'Profile updated successfully', 'success');
    
    // Close modal
    bootstrap.Modal.getInstance(document.getElementById('shopProfileModal')).hide();
}

// Shop Action Menu Functionality
function toggleShopStatus() {
    const currentStatus = document.querySelector('.shop-actions-item:nth-child(2)').innerText.includes('Online') ? 'Online' : 'Offline';
    const newStatus = currentStatus === 'Online' ? 'Offline' : 'Online';
    
    fetch('/api/shop-owner/toggle-status', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ status: newStatus.toLowerCase() })
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to update status');
        return response.json();
    })
    .then(data => {
        showNotification('Shop Status', `Shop status changed to ${newStatus}`, 'success');
        // Update menu text
        document.querySelector('.shop-actions-item:nth-child(2)').innerHTML = `
            <i class="fas fa-toggle-${newStatus === 'Online' ? 'on' : 'off'}"></i> Set Shop ${newStatus === 'Online' ? 'Offline' : 'Online'}
        `;
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Shop Status', `Shop status changed to ${newStatus}`, 'success');
    });
}

function manageShopHours() {
    // Create and show modal for shop hours management
    const modal = `
    <div class="modal fade" id="shopHoursModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manage Shop Hours</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-3 mb-2"><strong>Day</strong></div>
                        <div class="col-md-4 mb-2"><strong>Open</strong></div>
                        <div class="col-md-4 mb-2"><strong>Close</strong></div>
                        <div class="col-md-1 mb-2"><strong>Open?</strong></div>
                    </div>
                    <div id="hours-rows">
                        ${['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].map((day, index) => `
                            <div class="row mb-3 align-items-center">
                                <div class="col-md-3">
                                    <label>${day}</label>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="open-${index}">
                                        ${generateTimeOptions(9, 12)}
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="close-${index}">
                                        ${generateTimeOptions(17, 21)}
                                    </select>
                                </div>
                                <div class="col-md-1">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="day-enabled-${index}" ${index < 6 ? 'checked' : ''}>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveShopHours()">
                        <i class="fas fa-save me-2"></i>Save Hours
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('shopHoursModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    }
    
    // Show the modal
    const shopHoursModal = new bootstrap.Modal(document.getElementById('shopHoursModal'));
    shopHoursModal.show();
}

function generateTimeOptions(start, end) {
    let options = '';
    for (let hour = start; hour <= end; hour++) {
        const hour12 = hour > 12 ? hour - 12 : hour;
        const ampm = hour >= 12 ? 'PM' : 'AM';
        
        options += `<option value="${hour}:00">${hour12}:00 ${ampm}</option>`;
        options += `<option value="${hour}:30">${hour12}:30 ${ampm}</option>`;
    }
    return options;
}

function saveShopHours() {
    showNotification('Shop Hours', 'Shop hours updated successfully', 'success');
    bootstrap.Modal.getInstance(document.getElementById('shopHoursModal')).hide();
}

function manageShopPolicies() {
    // Create and show modal for shop policies
    const modal = `
    <div class="modal fade" id="shopPoliciesModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Shop Policies</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="cancellation-policy" class="form-label">Cancellation Policy</label>
                        <select class="form-select" id="cancellation-policy">
                            <option value="1">1 hour notice</option>
                            <option value="2" selected>2 hours notice</option>
                            <option value="4">4 hours notice</option>
                            <option value="24">24 hours notice</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="late-policy" class="form-label">Late Arrival Policy</label>
                        <select class="form-select" id="late-policy">
                            <option value="10">10 minutes grace period</option>
                            <option value="15" selected>15 minutes grace period</option>
                            <option value="20">20 minutes grace period</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="payment-policy" class="form-label">Payment Policy</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="allow-cash" checked>
                            <label class="form-check-label" for="allow-cash">Accept Cash</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="allow-credit" checked>
                            <label class="form-check-label" for="allow-credit">Accept Credit Cards</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="require-deposit">
                            <label class="form-check-label" for="require-deposit">Require Deposit</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="additional-policies" class="form-label">Additional Policies</label>
                        <textarea class="form-control" id="additional-policies" rows="4" placeholder="Enter any additional shop policies here..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="savePolicies()">
                        <i class="fas fa-save me-2"></i>Save Policies
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('shopPoliciesModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    }
    
    // Show the modal
    const shopPoliciesModal = new bootstrap.Modal(document.getElementById('shopPoliciesModal'));
    shopPoliciesModal.show();
}

function savePolicies() {
    showNotification('Policies', 'Shop policies updated successfully', 'success');
    bootstrap.Modal.getInstance(document.getElementById('shopPoliciesModal')).hide();
}

function viewShopAnalytics() {
    window.location.href = '/shop-owner-admin/analytics';
}

// Fix shop actions dropdown for click - this makes the dropdown toggle correctly
document.addEventListener('DOMContentLoaded', function() {
    const shopActionsBtn = document.querySelector('.shop-actions button');
    const shopActionsContent = document.querySelector('.shop-actions-content');
    
    if (shopActionsBtn) {
        shopActionsBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            shopActionsContent.classList.toggle('show');
        });
        
        // Close when clicking elsewhere
        document.addEventListener('click', function() {
            shopActionsContent.classList.remove('show');
        });
        
        // Prevent closing when clicking inside dropdown
        shopActionsContent.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
});

// Additional CSS to fix the shop actions dropdown
document.addEventListener('DOMContentLoaded', function() {
    const style = document.createElement('style');
    style.textContent = `
        .shop-actions-content.show {
            display: block !important;
        }
        .shop-actions:hover .shop-actions-content {
            display: none;
        }
    `;
    document.head.appendChild(style);
});

// Quick Actions Functions
function manageServices() {
    // Create and show services modal
    const modal = `
    <div class="modal fade" id="servicesModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manage Services</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <button class="btn btn-primary" id="add-service-btn" onclick="showAddServiceForm()">
                            <i class="fas fa-plus me-2"></i>Add New Service
                        </button>
                    </div>
                    
                    <div id="add-service-form" style="display: none;" class="card mb-3 p-3 border">
                        <h6 class="mb-3">Add New Service</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Service Name</label>
                                <input type="text" class="form-control" id="new-service-name">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Duration (mins)</label>
                                <input type="number" class="form-control" id="new-service-duration" min="15" step="15" value="30">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Price ($)</label>
                                <input type="number" class="form-control" id="new-service-price" min="1" step="0.01" value="25.00">
                            </div>
                        </div>
                        <div class="mt-3 d-flex justify-content-end">
                            <button class="btn btn-success me-2" onclick="addService()">Add Service</button>
                            <button class="btn btn-secondary" onclick="hideAddServiceForm()">Cancel</button>
                        </div>
                    </div>
                    <table class="table table-hover" id="services-table">
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Duration</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Services will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // In a real app, you would submit to API
    showNotification('Promotion', 'New promotion created successfully!', 'success');
    
    // Close modal
    bootstrap.Modal.getInstance(document.getElementById('promotionModal')).hide();
}

// Fix for quick actions not working and notifications disappearing too quickly

// 1. First let's fix the notification duration to make them stay longer
function showNotification(title, message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `toast show notification-${type}`;
    notification.setAttribute('role', 'alert');
    notification.setAttribute('aria-live', 'assertive');
    notification.setAttribute('aria-atomic', 'true');
    
    // Get appropriate icon based on type
    let iconClass = 'fa-info-circle text-info';
    if (type === 'success') iconClass = 'fa-check-circle text-success';
    if (type === 'warning') iconClass = 'fa-exclamation-triangle text-warning';
    if (type === 'error') iconClass = 'fa-exclamation-circle text-danger';
    
    notification.innerHTML = `
        <div class="toast-header">
            <i class="fas ${iconClass} me-2"></i>
            <strong class="me-auto">${title}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    // Add to container (create if it doesn't exist)
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(container);
    }
    
    container.appendChild(notification);
    
    // Auto-hide after 5 seconds - INCREASED from default
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.remove();
        }, 500);
    }, 8000); // Changed from 5000 to 8000 ms (8 seconds)
}

// 2. Fix Manage Services function
function manageServices() {
    // First check if modal already exists
    let servicesModal = document.getElementById('servicesModal');
    
    if (!servicesModal) {
        // Create modal content
        const modalHTML = `
        <div class="modal fade" id="servicesModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Manage Services</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <button class="btn btn-primary" id="add-service-btn" onclick="showAddServiceForm()">
                                <i class="fas fa-plus me-2"></i>Add New Service
                            </button>
                        </div>
                        
                        <div id="add-service-form" style="display: none;" class="card mb-3 p-3 border">
                            <h6 class="mb-3">Add New Service</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Service Name</label>
                                    <input type="text" class="form-control" id="new-service-name">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Duration (mins)</label>
                                    <input type="number" class="form-control" id="new-service-duration" min="15" step="15" value="30">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Price ($)</label>
                                    <input type="number" class="form-control" id="new-service-price" min="0" step="0.01" value="25.00">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="new-service-description" rows="2"></textarea>
                                </div>
                                <div class="col-12">
                                    <button type="button" class="btn btn-primary" onclick="addNewService()">Save Service</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="hideAddServiceForm()">Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover" id="services-table">
                                <thead>
                                    <tr>
                                        <th>Service</th>
                                        <th>Duration</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Classic Haircut</td>
                                        <td>30 min</td>
                                        <td>$25.00</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(1)">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(1, 'active')">
                                                <i class="fas fa-toggle-on"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Premium Haircut</td>
                                        <td>45 min</td>
                                        <td>$35.00</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(2)">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(2, 'active')">
                                                <i class="fas fa-toggle-on"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Beard Trim</td>
                                        <td>15 min</td>
                                        <td>$15.00</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(3)">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(3, 'active')">
                                                <i class="fas fa-toggle-on"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="save-services-btn">
                            <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>`;
        
        // Add the modal to the document
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('servicesModal'));
    modal.show();
}

// Support functions for service management
function showAddServiceForm() {
    document.getElementById('add-service-form').style.display = 'block';
}

function hideAddServiceForm() {
    document.getElementById('add-service-form').style.display = 'none';
}

function addNewService() {
    const name = document.getElementById('new-service-name').value;
    const duration = document.getElementById('new-service-duration').value;
    const price = document.getElementById('new-service-price').value;
    const description = document.getElementById('new-service-description').value;
    
    if (!name || !duration || !price) {
        showNotification('Validation Error', 'Please fill in all required fields', 'error');
        return;
    }
    
    // Add service to table (in a real app, you would send this to the server)
    const servicesTable = document.getElementById('services-table').querySelector('tbody');
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td>${name}</td>
        <td>${duration} min</td>
        <td>$${parseFloat(price).toFixed(2)}</td>
        <td><span class="badge bg-success">Active</span></td>
        <td>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(4)">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(4, 'active')">
                <i class="fas fa-toggle-on"></i>
            </button>
        </td>
    `;
    servicesTable.appendChild(newRow);
    
    // Show success message
    showNotification('Service Added', 'New service added successfully', 'success');
    
    // Hide form and reset values
    hideAddServiceForm();
    document.getElementById('new-service-name').value = '';
    document.getElementById('new-service-duration').value = '30';
    document.getElementById('new-service-price').value = '25.00';
    document.getElementById('new-service-description').value = '';
}

function editService(serviceId) {
    showNotification('Service Management', `Editing service ID: ${serviceId}`, 'info');
}

function toggleServiceStatus(serviceId, currentStatus) {
    const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
    showNotification('Service Status', `Service ${serviceId} is now ${newStatus}`, 'success');
    
    // In a real app, you would update the database and then update the UI
    const statusElement = event.target.closest('tr').querySelector('.badge');
    if (newStatus === 'active') {
        statusElement.className = 'badge bg-success';
        statusElement.textContent = 'Active';
        event.target.innerHTML = '<i class="fas fa-toggle-on"></i>';
    } else {
        statusElement.className = 'badge bg-secondary';
        statusElement.textContent = 'Inactive';
        event.target.innerHTML = '<i class="fas fa-toggle-off"></i>';
    }
}

// 3. Fix Add Promotion function
function addPromotion() {
    // Make sure promotionModal is properly defined and shown
    const promotionModal = document.getElementById('promotionModal');
    if (promotionModal) {
        // Fill in any missing inputs to make sure the modal works properly
        const promoStartInput = promotionModal.querySelector('#promo-start');
        if (promoStartInput && !promoStartInput.value) {
            const today = new Date();
            promoStartInput.value = today.toISOString().split('T')[0];
        }
        
        const promoEndInput = promotionModal.querySelector('#promo-end');
        if (promoEndInput && !promoEndInput.value) {
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            promoEndInput.value = nextMonth.toISOString().split('T')[0];
        }
        
        new bootstrap.Modal(promotionModal).show();
    }
}

function savePromotion() {
    const promoData = {
        name: document.getElementById('promo-name').value,
        start_date: document.getElementById('promo-start').value,
        end_date: document.getElementById('promo-end').value,
        type: document.getElementById('promo-type').value,
        discount_value: document.getElementById('discount-value').value,
        services: Array.from(document.getElementById('applicable-services').selectedOptions).map(opt => opt.value),
        description: document.getElementById('promo-description').value,
        active: document.getElementById('promo-active').checked
    };
    
    // Validation
    if (!promoData.name || !promoData.start_date || !promoData.end_date) {
        showNotification('Validation Error', 'Please fill in all required fields', 'error');
        return;
    }
    
    // In a real app, you would submit to API
    showNotification('Promotion', 'New promotion created successfully!', 'success');
    
    // Close modal
    bootstrap.Modal.getInstance(document.getElementById('promotionModal')).hide();
}

function inventoryAlert() {
    // Create and show inventory modal
    const modal = `
    <div class="modal fade" id="inventoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Inventory Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between mb-3">
                        <button class="btn btn-primary" onclick="addInventoryItem()">
                            <i class="fas fa-plus me-2"></i>Add New Item
                        </button>
                        <div class="input-group" style="width: 250px;">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" placeholder="Search items..." id="inventory-search">
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Category</th>
                                    <th>Current Stock</th>
                                    <th>Low Stock Alert</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Premium Hair Spray</td>
                                    <td>Hair Products</td>
                                    <td><span class="text-danger">2</span></td>
                                    <td>5</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary me-1" onclick="updateInventory(1)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="reorderInventory(1)">
                                            <i class="fas fa-shopping-cart"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Styling Gel</td>
                                    <td>Hair Products</td>
                                    <td>8</td>
                                    <td>5</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary me-1" onclick="updateInventory(2)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="reorderInventory(2)">
                                            <i class="fas fa-shopping-cart"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Aftershave Lotion</td>
                                    <td>Shaving Products</td>
                                    <td><span class="text-danger">3</span></td>
                                    <td>5</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary me-1" onclick="updateInventory(3)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="reorderInventory(3)">
                                            <i class="fas fa-shopping-cart"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="exportInventory()">
                        <i class="fas fa-file-export me-2"></i>Export Inventory
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('inventoryModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    }
    
    // Show the modal
    const inventoryModal = new bootstrap.Modal(document.getElementById('inventoryModal'));
    inventoryModal.show();
}

function addInventoryItem() {
    showNotification('Inventory', 'Add inventory item form opened', 'info');
}

function updateInventory(itemId) {
    showNotification('Inventory', `Updating inventory item ${itemId}`, 'info');
}

function reorderInventory(itemId) {
    showNotification('Inventory', `Reorder placed for item ${itemId}`, 'success');
}

function exportInventory() {
    showNotification('Inventory', 'Inventory export started', 'info');
    
    // Simulate download after delay
    setTimeout(() => {
        showNotification('Inventory', 'Inventory exported successfully', 'success');
    }, 1500);
}

function sendNotification() {
    // Create and show notification modal
    const modal = `
    <div class="modal fade" id="sendNotificationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Send Notification</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="notification-type" class="form-label">Notification Type</label>
                        <select class="form-select" id="notification-type">
                            <option value="all_customers">All Customers</option>
                            <option value="specific_customer">Specific Customer</option>
                            <option value="upcoming_appointments">Customers with Upcoming Appointments</option>
                            <option value="staff">Staff Members</option>
                        </select>
                    </div>
                    <div class="mb-3" id="specific-customer-container" style="display: none;">
                        <label for="customer-select" class="form-label">Select Customer</label>
                        <select class="form-select" id="customer-select">
                            <option value="">Select a customer...</option>
                            <option value="1">John Smith</option>
                            <option value="2">Sarah Johnson</option>
                            <option value="3">Michael Williams</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="notification-title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="notification-title" placeholder="Enter notification title">
                    </div>
                    <div class="mb-3">
                        <label for="notification-message" class="form-label">Message</label>
                        <textarea class="form-control" id="notification-message" rows="4" placeholder="Enter your message..."></textarea>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="send-email-copy">
                        <label class="form-check-label" for="send-email-copy">
                            Also send as email
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="send-sms-copy">
                        <label class="form-check-label" for="send-sms-copy">
                            Also send as SMS
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="sendCustomerNotification()">
                        <i class="fas fa-paper-plane me-2"></i>Send Notification
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('sendNotificationModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
        
        // Add event listener for notification type change
        setTimeout(() => {
            document.getElementById('notification-type').addEventListener('change', function() {
                const specificCustomerContainer = document.getElementById('specific-customer-container');
                specificCustomerContainer.style.display = this.value === 'specific_customer' ? 'block' : 'none';
            });
        }, 100);
    }
    
    // Show the modal
    const sendNotificationModal = new bootstrap.Modal(document.getElementById('sendNotificationModal'));
    sendNotificationModal.show();
}

function sendCustomerNotification() {
    const title = document.getElementById('notification-title').value.trim();
    const message = document.getElementById('notification-message').value.trim();
    
    if (!title || !message) {
        showNotification('Validation Error', 'Please fill in both title and message', 'error');
        return;
    }
    
    showNotification('Notification Sent', 'Your notification has been sent successfully', 'success');
    bootstrap.Modal.getInstance(document.getElementById('sendNotificationModal')).hide();
}

function exportStaff() {
    showNotification('Staff Export', 'Preparing staff data for export...', 'info');
    
    // Simulate download preparation
    setTimeout(() => {
        // Create a CSV content
        const csvContent = "data:text/csv;charset=utf-8," + 
            "ID,First Name,Last Name,Role,Status,Bookings,Rating,Revenue\n" +
            "1,Michael,Johnson,Senior Barber,active,42,4.9,1250\n" +
            "2,James,Wilson,Master Barber,active,38,4.7,1120\n" +
            "3,Chris,Adams,Barber,leave,0,4.8,0\n" +
            "4,Lisa,Rodriguez,Stylist,active,32,4.9,980";
        
        // Create download link
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "staff_data.csv");
        document.body.appendChild(link);
        
        // Trigger download
        link.click();
        
        // Remove link element
        document.body.removeChild(link);
        
        showNotification('Staff Export', 'Staff data exported successfully', 'success');
    }, 1500);
}

// Add the staff export button to the DOM when page loads
document.addEventListener('DOMContentLoaded', function() {
    const staffHeader = document.querySelector('.card-header h5:contains("Staff Management")');
    if (staffHeader) {
        const staffCardHeader = staffHeader.closest('.card-header');
        const exportButton = document.createElement('button');
        exportButton.className = 'btn btn-sm btn-outline-primary ms-2';
        exportButton.innerHTML = '<i class="fas fa-download me-1"></i>Export Staff';
        exportButton.onclick = exportStaff;
        
        // Add to the header next to the Add Staff button
        const addStaffButton = staffCardHeader.querySelector('button');
        if (addStaffButton) {
            addStaffButton.parentNode.insertBefore(exportButton, addStaffButton.nextSibling);
        } else {
            staffCardHeader.appendChild(exportButton);
        }
    }
});

function viewShopAnalytics() {
    // Instead of redirecting, show an advanced analytics modal
    const analyticsModalHtml = `
    <div class="modal fade" id="advancedAnalyticsModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-fullscreen-lg-down">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-chart-line me-2"></i>Advanced Analytics</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="analyticsTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="revenue-tab" data-bs-toggle="tab" 
                                data-bs-target="#revenue" type="button" role="tab" aria-selected="true">
                                Revenue Analysis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="services-tab" data-bs-toggle="tab" 
                                data-bs-target="#services" type="button" role="tab" aria-selected="false">
                                Services Analysis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="staff-tab" data-bs-toggle="tab" 
                                data-bs-target="#staff" type="button" role="tab" aria-selected="false">
                                Staff Performance
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="customers-tab" data-bs-toggle="tab" 
                                data-bs-target="#customers" type="button" role="tab" aria-selected="false">
                                Customer Insights
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-4" id="analyticsTabContent">
                        <!-- Revenue Analysis Tab -->
                        <div class="tab-pane fade show active" id="revenue" role="tabpanel">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card mb-4">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h6 class="mb-0">Revenue Trends</h6>
                                            <select class="form-select form-select-sm" style="width: auto;">
                                                <option value="year">Year</option>
                                                <option value="quarter">Quarter</option>
                                                <option value="month" selected>Month</option>
                                                <option value="week">Week</option>
                                            </select>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="advancedRevenueChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h6 class="mb-0">Revenue Breakdown</h6>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="revenuePieChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0">Detailed Revenue Report</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Service Revenue</th>
                                                            <th>Product Revenue</th>
                                                            <th>Total Revenue</th>
                                                            <th>Appointments</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>June 1, 2023</td>
                                                            <td>$450.00</td>
                                                            <td>$120.00</td>
                                                            <td>$570.00</td>
                                                            <td>15</td>
                                                        </tr>
                                                        <tr>
                                                            <td>June 2, 2023</td>
                                                            <td>$380.00</td>
                                                            <td>$95.00</td>
                                                            <td>$475.00</td>
                                                            <td>12</td>
                                                        </tr>
                                                        <tr>
                                                            <td>June 3, 2023</td>
                                                            <td>$520.00</td>
                                                            <td>$150.00</td>
                                                            <td>$670.00</td>
                                                            <td>18</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Other tabs would go here -->
                        <div class="tab-pane fade" id="services" role="tabpanel">
                            <div class="text-center py-5">
                                <h5>Services Analysis</h5>
                                <p class="text-muted">Detailed service analytics will appear here.</p>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="staff" role="tabpanel">
                            <div class="text-center py-5">
                                <h5>Staff Performance</h5>
                                <p class="text-muted">Staff performance metrics will appear here.</p>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="customers" role="tabpanel">
                            <div class="text-center py-5">
                                <h5>Customer Insights</h5>
                                <p class="text-muted">Customer analytics will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="exportAnalyticsReport()">
                        <i class="fas fa-download me-2"></i>Export Report
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('advancedAnalyticsModal')) {
        document.body.insertAdjacentHTML('beforeend', analyticsModalHtml);
        
        // Initialize charts after modal is shown
        const modal = document.getElementById('advancedAnalyticsModal');
        modal.addEventListener('shown.bs.modal', function() {
            // Revenue chart
            const revenueCtx = document.getElementById('advancedRevenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Service Revenue',
                        data: [1200, 1380, 950, 1520],
                        borderColor: 'rgba(78, 84, 200, 1)',
                        backgroundColor: 'rgba(78, 84, 200, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'Product Revenue',
                        data: [350, 420, 280, 390],
                        borderColor: 'rgba(40, 167, 69, 1)',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Revenue pie chart
            const pieCtx = document.getElementById('revenuePieChart').getContext('2d');
            new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: ['Haircuts', 'Beard Trims', 'Styling', 'Products'],
                    datasets: [{
                        data: [45, 20, 15, 20],
                        backgroundColor: [
                            'rgba(78, 84, 200, 0.8)',
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(23, 162, 184, 0.8)'
                        ],
                        borderColor: [
                            'rgba(78, 84, 200, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(23, 162, 184, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
        });
    }
    
    // Show the modal
    const analyticsModalInstance = new bootstrap.Modal(document.getElementById('advancedAnalyticsModal'));
    analyticsModalInstance.show();
}

function exportAnalyticsReport() {
    showNotification('Analytics Export', 'Preparing analytics report for export...', 'info');
    
    setTimeout(() => {
        showNotification('Analytics Export', 'Analytics report downloaded successfully', 'success');
    }, 1500);
}

function manageReviews() {
    // Create a modal that will transition to the full page
    const reviewsModal = `
    <div class="modal fade" id="reviewsModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-fullscreen-lg-down">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-star me-2"></i>Reviews Management</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="reviews-container bg-light p-3">
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" placeholder="Search reviews..." id="review-search">
                                        <button class="btn btn-primary" id="search-reviews-btn">Search</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex justify-content-end">
                                    <div class="btn-group">
                                        <button class="btn btn-outline-primary active" data-filter="all">
                                            All
                                        </button>
                                        <button class="btn btn-outline-primary" data-filter="replied">
                                            Replied
                                        </button>
                                        <button class="btn btn-outline-primary" data-filter="unreplied">
                                            Unreplied
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="review-stats-card bg-white p-3 rounded shadow-sm">
                                    <h6 class="mb-2">Overall Rating</h6>
                                    <div class="d-flex align-items-center mb-2">
                                        <h2 class="me-2 mb-0">4.8</h2>
                                        <div>
                                            <div class="text-warning mb-1">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                            </div>
                                            <small class="text-muted">142 reviews</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="review-stats-card bg-white p-3 rounded shadow-sm">
                                    <h6 class="mb-2">Rating Breakdown</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="rating-label me-2">
                                                    <small>5 stars</small>
                                                </div>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <div class="progress-bar bg-success" style="width: 75%"></div>
                                                </div>
                                                <div class="rating-count ms-2">
                                                    <small>102</small>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="rating-label me-2">
                                                    <small>4 stars</small>
                                                </div>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <div class="progress-bar bg-success" style="width: 18%"></div>
                                                </div>
                                                <div class="rating-count ms-2">
                                                    <small>25</small>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="rating-label me-2">
                                                    <small>3 stars</small>
                                                </div>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <div class="progress-bar bg-warning" style="width: 7%"></div>
                                                </div>
                                                <div class="rating-count ms-2">
                                                    <small>10</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="rating-label me-2">
                                                    <small>2 stars</small>
                                                </div>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <div class="progress-bar bg-danger" style="width: 2%"></div>
                                                </div>
                                                <div class="rating-count ms-2">
                                                    <small>3</small>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="rating-label me-2">
                                                    <small>1 stars</small>
                                                </div>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <div class="progress-bar bg-danger" style="width: 1%"></div>
                                                </div>
                                                <div class="rating-count ms-2">
                                                    <small>2</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="reviews-list" class="reviews-list">
                            <!-- Content loaded dynamically -->
                            <div class="text-center py-5">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3 text-muted">Loading reviews...</p>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center mt-4">
                            <nav aria-label="Reviews pagination">
                                <ul class="pagination">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active">
                                        <a class="page-link" href="#">1</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">2</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">3</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="downloadReviewsReport()">
                        <i class="fas fa-download me-2"></i>Download Report
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    if (!document.getElementById('reviewsModal')) {
        document.body.insertAdjacentHTML('beforeend', reviewsModal);
    }
    
    // Show modal and load reviews
    const modal = new bootstrap.Modal(document.getElementById('reviewsModal'));
    modal.show();
    
    // Load reviews into the modal
    loadAllReviews();
}

function loadAllReviews() {
    const reviewsList = document.getElementById('reviews-list');
    
    fetch('/api/shop-owner/reviews?limit=10')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data.success && data.reviews.length > 0) {
                reviewsList.innerHTML = renderAllReviews(data.reviews);
            } else {
                reviewsList.innerHTML = '<div class="text-center p-5"><p class="text-muted">No reviews found</p></div>';
            }
        })
        .catch(error => {
            console.error('Error loading reviews:', error);
            
            // Use mock data
            const mockReviews = [
                {
                    id: 1,
                    customer: { name: 'Mark Williams', avatar: 'https://ui-avatars.com/api/?name=Mark+Williams&background=random' },
                    rating: 5,
                    text: 'Michael did an amazing job with my haircut. The attention to detail was impressive and the shop atmosphere is fantastic. Will definitely be coming back!',
                    date: '2 days ago',
                    barber: 'Michael Johnson',
                    response: null
                },
                {
                    id: 2,
                    customer: { name: 'Sarah Johnson', avatar: 'https://ui-avatars.com/api/?name=Sarah+Johnson&background=random' },
                    rating: 4,
                    text: 'Great service but had to wait about 15 minutes past my appointment time. The haircut was excellent though and James was very professional.',
                    date: '4 days ago',
                    barber: 'James Wilson',
                    response: 'Thank you for your feedback, Sarah! We apologize for the wait time and are working on improving our scheduling. We\'re glad you enjoyed your haircut and look forward to serving you better next time!'
                },
                {
                    id: 3,
                    customer: { name: 'David Brown', avatar: 'https://ui-avatars.com/api/?name=David+Brown&background=random' },
                    rating: 5,
                    text: 'Best barbershop in town! Chris gave me exactly the style I was looking for. The hot towel treatment was amazing too.',
                    date: '1 week ago',
                    barber: 'Chris Adams',
                    response: null
                },
                {
                    id: 4,
                    customer: { name: 'Jennifer Lopez', avatar: 'https://ui-avatars.com/api/?name=Jennifer+Lopez&background=random' },
                    rating: 5,
                    text: 'Amazing experience! Lisa was fantastic and gave me exactly what I wanted.',
                    date: '1 week ago',
                    barber: 'Lisa Rodriguez',
                    response: null
                },
                {
                    id: 5,
                    customer: { name: 'Robert Smith', avatar: 'https://ui-avatars.com/api/?name=Robert+Smith&background=random' },
                    rating: 3,
                    text: 'The haircut was good, but the wait time was too long. Waited almost 30 minutes past my appointment time.',
                    date: '2 weeks ago',
                    barber: 'Michael Johnson',
                    response: "Thank you for your feedback, Robert. We apologize for the long wait time. We're addressing our scheduling system to ensure timely service in the future. We hope to serve you better next time!"
                },
                {
                    id: 6,
                    customer: { name: 'Thomas Anderson', avatar: 'https://ui-avatars.com/api/?name=Thomas+Anderson&background=random' },
                    rating: 2,
                    text: 'Not what I expected. The barber didn\'t listen to my requests and I ended up with a style I didn\'t want.',
                    date: '3 weeks ago',
                    barber: 'Chris Adams',
                    response: "Hi Thomas, we're very sorry about your experience. Please contact us directly and we would like to offer you a complimentary haircut to make things right."
                }
            ];
            
            reviewsList.innerHTML = renderAllReviews(mockReviews);
        });
}

function renderAllReviews(reviews) {
    return reviews.map(review => `
        <div class="review-card-extended ${review.response ? 'has-response' : ''} mb-4">
            <div class="d-flex justify-content-between align-items-start">
                <div class="d-flex">
                    <img src="${review.customer.avatar}" alt="${review.customer.name}" class="avatar me-3" width="50" height="50">
                    <div>
                        <h6 class="mb-1">${review.customer.name}</h6>
                        <div class="text-muted small mb-2">
                            Reviewed ${review.barber}  ${review.date}
                        </div>
                        <div class="review-rating mb-2">
                            ${renderStars(review.rating)}
                        </div>
                    </div>
                </div>
                <div class="review-actions">
                    <div class="dropdown">
                        <button class="btn btn-sm btn-light" data-bs-toggle="dropdown">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="featureReview(${review.id})">
                                <i class="fas fa-thumbtack me-2"></i>Feature Review
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="hideReview(${review.id})">
                                <i class="fas fa-eye-slash me-2"></i>Hide Review
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="reportReview(${review.id})">
                                <i class="fas fa-flag me-2"></i>Report Review
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="review-text my-3">
                ${review.text}
            </div>
            
            ${review.response ? `
                <div class="review-response mt-3 p-3 bg-light rounded">
                    <div class="d-flex align-items-center mb-2">
                        <img src="https://ui-avatars.com/api/?name=Shop+Owner&background=4e54c8" 
                            class="avatar me-2" width="30" height="30" alt="Shop Response">
                        <strong>Shop Response</strong>
                    </div>
                    ${review.response}
                </div>
            ` : `
                <div class="mt-3 text-end">
                    <button class="btn btn-primary btn-sm" onclick="replyToReviewDetailed(${review.id})">
                        <i class="fas fa-reply me-1"></i>Reply
                    </button>
                </div>
            `}
        </div>
    `).join('');
}

function replyToReviewDetailed(reviewId) {
    // This uses the existing replyToReview function but can be enhanced
    replyToReview(reviewId);
}

function downloadReviewsReport() {
    showNotification('Reports', 'Preparing reviews report for download...', 'info');
    
    setTimeout(() => {
        showNotification('Reports', 'Reviews report downloaded successfully', 'success');
    }, 1500);
}

function featureReview(reviewId) {
    showNotification('Reviews', `Review ${reviewId} has been featured`, 'success');
}

function hideReview(reviewId) {
    showNotification('Reviews', `Review ${reviewId} has been hidden`, 'success');
}

function reportReview(reviewId) {
    showNotification('Reviews', `Review ${reviewId} has been reported`, 'info');
}

function viewSupportTickets() {
    // Create a modal that will display the support ticket management interface
    const ticketsModal = `
    <div class="modal fade" id="supportTicketsModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-fullscreen-lg-down">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title"><i class="fas fa-ticket-alt me-2"></i>Support Tickets</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="tickets-container bg-light">
                        <div class="p-3 border-bottom">
                            <div class="row align-items-center">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" placeholder="Search tickets...">
                                        <button class="btn btn-secondary" type="button">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6 d-flex justify-content-md-end">
                                    <div class="btn-group me-3">
                                        <button class="btn btn-outline-secondary active" data-filter="all">All</button>
                                        <button class="btn btn-outline-secondary" data-filter="open">Open</button>
                                        <button class="btn btn-outline-secondary" data-filter="in-progress">In Progress</button>
                                        <button class="btn btn-outline-secondary" data-filter="resolved">Resolved</button>
                                    </div>
                                    <button class="btn btn-secondary" onclick="createNewTicket()">
                                        <i class="fas fa-plus me-1"></i>New Ticket
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row g-0">
                            <div class="col-md-4 border-end">
                                <div class="tickets-list p-0 h-100 overflow-auto" style="max-height: 600px;">
                                    <div class="list-group list-group-flush" id="tickets-list">
                                        <!-- Tickets loaded dynamically -->
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-secondary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-3 text-muted">Loading tickets...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="ticket-detail p-4" id="ticket-detail">
                                    <div class="text-center py-5">
                                        <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
                                        <h5 class="text-muted">Select a ticket to view details</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="exportTickets()">
                        <i class="fas fa-download me-2"></i>Export Tickets
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    if (!document.getElementById('supportTicketsModal')) {
        document.body.insertAdjacentHTML('beforeend', ticketsModal);
    }
    
    // Show modal and load tickets
    const modal = new bootstrap.Modal(document.getElementById('supportTicketsModal'));
    modal.show();
    
    // Load tickets
    loadSupportTickets();
}

function loadSupportTickets() {
    const ticketsList = document.getElementById('tickets-list');
    
    fetch('/api/shop-owner/support-tickets')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data && data.tickets && data.tickets.length > 0) {
                ticketsList.innerHTML = renderSupportTickets(data.tickets);
            } else {
                ticketsList.innerHTML = '<div class="text-center p-5"><p class="text-muted">No tickets found</p></div>';
            }
        })
        .catch(error => {
            console.error('Error loading support tickets:', error);
            
            // Use mock data
            const mockTickets = [
                {
                    id: 1,
                    customer: { name: 'John Smith', avatar: 'https://ui-avatars.com/api/?name=John+Smith&background=random' },
                    subject: 'Booking Cancellation Issue',
                    message: 'I tried to cancel my booking through the app but it still shows as active. Please help.',
                    status: 'open',
                    priority: 'high',
                    created: '2023-06-01T14:30:00',
                    updated: '2023-06-01T14:30:00'
                },
                {
                    id: 2,
                    customer: { name: 'Mary Johnson', avatar: 'https://ui-avatars.com/api/?name=Mary+Johnson&background=random' },
                    subject: 'Payment Not Processed',
                    message: 'I made a payment for my appointment yesterday but it\'s still showing as unpaid in the system.',
                    status: 'in-progress',
                    priority: 'medium',
                    created: '2023-05-30T10:15:00',
                    updated: '2023-05-30T15:45:00'
                },
                {
                    id: 3,
                    customer: { name: 'Robert Davis', avatar: 'https://ui-avatars.com/api/?name=Robert+Davis&background=random' },
                    subject: 'Complaint About Service',
                    message: 'I had a haircut on May 29th and I\'m not satisfied with the results. The barber didn\'t follow my instructions.',
                    status: 'open',
                    priority: 'high',
                    created: '2023-05-29T16:20:00',
                    updated: '2023-05-29T16:20:00'
                },
                {
                    id: 4,
                    customer: { name: 'Lisa Wilson', avatar: 'https://ui-avatars.com/api/?name=Lisa+Wilson&background=random' },
                    subject: 'Gift Card Question',
                    message: 'Can I use a gift card for booking online or do I need to present it in person?',
                    status: 'resolved',
                    priority: 'low',
                    created: '2023-05-28T09:45:00',
                    updated: '2023-05-28T11:30:00'
                },
                {
                    id: 5,
                    customer: { name: 'David Miller', avatar: 'https://ui-avatars.com/api/?name=David+Miller&background=random' },
                    subject: 'Account Login Issues',
                    message: 'I can\'t log into my account. I\'ve tried resetting my password but I\'m not receiving any reset email.',
                    status: 'in-progress',
                    priority: 'medium',
                    created: '2023-05-27T11:10:00',
                    updated: '2023-05-27T14:25:00'
                }
            ];
            
            ticketsList.innerHTML = renderSupportTickets(mockTickets);
            
            // Set up click handlers
            setTimeout(() => {
                document.querySelectorAll('.ticket-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const ticketId = item.dataset.ticketId;
                        displayTicketDetail(mockTickets.find(ticket => ticket.id == ticketId));
                        
                        // Mark as active
                        document.querySelectorAll('.ticket-item').forEach(t => t.classList.remove('active'));
                        item.classList.add('active');
                    });
                });
            }, 100);
        });
}

function renderSupportTickets(tickets) {
    return tickets.map(ticket => {
        // Format status badge
        let statusBadge = '';
        switch(ticket.status) {
            case 'open':
                statusBadge = '<span class="badge bg-danger">Open</span>';
                break;
            case 'in-progress':
                statusBadge = '<span class="badge bg-warning text-dark">In Progress</span>';
                break;
            case 'resolved':
                statusBadge = '<span class="badge bg-success">Resolved</span>';
                break;
            default:
                statusBadge = '<span class="badge bg-secondary">Unknown</span>';
        }
        
        // Format date
        const ticketDate = new Date(ticket.created);
        const formattedDate = ticketDate.toLocaleDateString() + ' ' + 
                              ticketDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        return `
            <div class="list-group-item list-group-item-action ticket-item d-flex align-items-center px-3 py-3"
                 data-ticket-id="${ticket.id}">
                <div class="me-3">
                    <img src="${ticket.customer.avatar}" alt="Customer" class="avatar" width="40" height="40">
                </div>
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-1 text-truncate" style="max-width: 150px;">${ticket.subject}</h6>
                        ${statusBadge}
                    </div>
                    <div class="small text-muted d-flex justify-content-between">
                        <span>${ticket.customer.name}</span>
                        <span>${formattedDate}</span>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function displayTicketDetail(ticket) {
    const ticketDetail = document.getElementById('ticket-detail');
    
    // Format dates
    const createdDate = new Date(ticket.created);
    const formattedCreatedDate = createdDate.toLocaleDateString() + ' ' + 
                                createdDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    const updatedDate = new Date(ticket.updated);
    const formattedUpdatedDate = updatedDate.toLocaleDateString() + ' ' + 
                                updatedDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    // Priority badge
    let priorityBadge = '';
    switch(ticket.priority) {
        case 'high':
            priorityBadge = '<span class="badge bg-danger">High Priority</span>';
            break;
        case 'medium':
            priorityBadge = '<span class="badge bg-warning text-dark">Medium Priority</span>';
            break;
        case 'low':
            priorityBadge = '<span class="badge bg-info">Low Priority</span>';
            break;
        default:
            priorityBadge = '';
    }
    
    // Status badge
    let statusBadge = '';
    switch(ticket.status) {
        case 'open':
            statusBadge = '<span class="badge bg-danger">Open</span>';
            break;
        case 'in-progress':
            statusBadge = '<span class="badge bg-warning text-dark">In Progress</span>';
            break;
        case 'resolved':
            statusBadge = '<span class="badge bg-success">Resolved</span>';
            break;
        default:
            statusBadge = '<span class="badge bg-secondary">Unknown</span>';
    }
    
    ticketDetail.innerHTML = `
        <div class="ticket-header mb-4">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h5 class="mb-2">${ticket.subject}</h5>
                    <div class="d-flex align-items-center">
                        <img src="${ticket.customer.avatar}" class="avatar me-2" width="30" height="30" alt="${ticket.customer.name}">
                        <span class="text-muted">${ticket.customer.name}</span>
                        ${priorityBadge ? `<span class="ms-2">${priorityBadge}</span>` : ''}
                    </div>
                </div>
                <div class="ticket-actions">
                    <div class="d-flex">
                        <div class="me-2">
                            ${statusBadge}
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                Actions
                            </button>
                            <ul class="dropdown-menu">
                                ${ticket.status !== 'in-progress' ? `
                                    <li><a class="dropdown-item" href="#" onclick="updateTicketStatus(${ticket.id}, 'in-progress')">
                                        <i class="fas fa-spinner me-2"></i>Mark In Progress
                                    </a></li>
                                ` : ''}
                                ${ticket.status !== 'resolved' ? `
                                    <li><a class="dropdown-item" href="#" onclick="updateTicketStatus(${ticket.id}, 'resolved')">
                                        <i class="fas fa-check me-2"></i>Mark Resolved
                                    </a></li>
                                ` : ''}
                                ${ticket.status !== 'open' ? `
                                    <li><a class="dropdown-item" href="#" onclick="updateTicketStatus(${ticket.id}, 'open')">
                                        <i class="fas fa-exclamation-circle me-2"></i>Reopen Ticket
                                    </a></li>
                                ` : ''}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="assignTicket(${ticket.id})">
                                    <i class="fas fa-user-plus me-2"></i>Assign to Staff
                                </a></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="deleteTicket(${ticket.id})">
                                    <i class="fas fa-trash me-2"></i>Delete Ticket
                                </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ticket-info mt-3">
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted">Created: ${formattedCreatedDate}</small>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <small class="text-muted">Last Updated: ${formattedUpdatedDate}</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="ticket-body mb-4">
            <div class="card">
                <div class="card-body">
                    <p>${ticket.message}</p>
                </div>
            </div>
        </div>
        
        <div class="ticket-reply">
            <h6 class="mb-3">Reply to Customer</h6>
            <div class="mb-3">
                <textarea class="form-control" rows="4" placeholder="Type your response here..."></textarea>
            </div>
            <div class="d-flex justify-content-between">
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="resolve-checkbox">
                        <label class="form-check-label" for="resolve-checkbox">
                            Mark as resolved after sending
                        </label>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="sendTicketReply(${ticket.id})">
                    <i class="fas fa-paper-plane me-2"></i>Send Reply
                </button>
            </div>
        </div>
    `;
}

function updateTicketStatus(ticketId, status) {
    showNotification('Support Ticket', `Ticket #${ticketId} marked as ${status}`, 'success');
    
    // In a real app, you would update the UI to reflect the new status
    const ticketItem = document.querySelector(`.ticket-item[data-ticket-id="${ticketId}"]`);
    if (ticketItem) {
        const statusBadge = ticketItem.querySelector('.badge');
        if (statusBadge) {
            statusBadge.className = 'badge';
            switch(status) {
                case 'open':
                    statusBadge.classList.add('bg-danger');
                    statusBadge.textContent = 'Open';
                    break;
                case 'in-progress':
                    statusBadge.classList.add('bg-warning', 'text-dark');
                    statusBadge.textContent = 'In Progress';
                    break;
                case 'resolved':
                    statusBadge.classList.add('bg-success');
                    statusBadge.textContent = 'Resolved';
                    break;
            }
        }
    }
}

function assignTicket(ticketId) {
    // Create and show staff assignment modal
    const modal = `
    <div class="modal fade" id="assignTicketModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Assign Ticket #${ticketId}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="staff-assign" class="form-label">Assign to Staff Member</label>
                        <select class="form-select" id="staff-assign">
                            <option value="">Select staff member...</option>
                            <option value="1">Michael Johnson</option>
                            <option value="2">James Wilson</option>
                            <option value="3">Chris Adams</option>
                            <option value="4">Lisa Rodriguez</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="assign-note" class="form-label">Note (Optional)</label>
                        <textarea class="form-control" id="assign-note" rows="3" placeholder="Add a note for the staff member..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="confirmAssignTicket(${ticketId})">
                        <i class="fas fa-user-check me-1"></i>Assign Ticket
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('assignTicketModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    } else {
        // Update modal title if it already exists
        document.querySelector('#assignTicketModal .modal-title').textContent = `Assign Ticket #${ticketId}`;
    }
    
    // Show the modal
    const assignModal = new bootstrap.Modal(document.getElementById('assignTicketModal'));
    assignModal.show();
}

function confirmAssignTicket(ticketId) {
    const staffSelect = document.getElementById('staff-assign');
    const staffName = staffSelect.options[staffSelect.selectedIndex].text;
    
    showNotification('Ticket Assigned', `Ticket #${ticketId} assigned to ${staffName}`, 'success');
    bootstrap.Modal.getInstance(document.getElementById('assignTicketModal')).hide();
}

function deleteTicket(ticketId) {
    if (confirm(`Are you sure you want to delete ticket #${ticketId}? This action cannot be undone.`)) {
        showNotification('Ticket Deleted', `Ticket #${ticketId} has been deleted`, 'success');
        
        // In a real app, you would remove the ticket from the UI
        const ticketItem = document.querySelector(`.ticket-item[data-ticket-id="${ticketId}"]`);
        if (ticketItem) {
            ticketItem.remove();
        }
        
        // Reset the detail view
        document.getElementById('ticket-detail').innerHTML = `
            <div class="text-center py-5">
                <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">Select a ticket to view details</h5>
            </div>
        `;
    }
}

function sendTicketReply(ticketId) {
    const replyText = document.querySelector('.ticket-reply textarea').value.trim();
    const markResolved = document.getElementById('resolve-checkbox').checked;
    
    if (!replyText) {
        showNotification('Validation Error', 'Please enter a reply message', 'error');
        return;
    }
    
    showNotification('Reply Sent', `Your reply to ticket #${ticketId} has been sent`, 'success');
    
    if (markResolved) {
        updateTicketStatus(ticketId, 'resolved');
    }
}

function createNewTicket() {
    // Create and show new ticket modal
    const modal = `
    <div class="modal fade" id="newTicketModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Support Ticket</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="customer-search" class="form-label">Customer</label>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="customer-search" placeholder="Search customer...">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="ticket-subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="ticket-subject">
                    </div>
                    <div class="mb-3">
                        <label for="ticket-message" class="form-label">Message</label>
                        <textarea class="form-control" id="ticket-message" rows="5"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="ticket-priority" class="form-label">Priority</label>
                        <select class="form-select" id="ticket-priority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitNewTicket()">
                        <i class="fas fa-plus me-1"></i>Create Ticket
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add modal to body if it doesn't exist
    if (!document.getElementById('newTicketModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    }
    
    // Show the modal
    const newTicketModal = new bootstrap.Modal(document.getElementById('newTicketModal'));
    newTicketModal.show();
}

function submitNewTicket() {
    const subject = document.getElementById('ticket-subject').value.trim();
    const message = document.getElementById('ticket-message').value.trim();
    
    if (!subject || !message) {
        showNotification('Validation Error', 'Please fill in all required fields', 'error');
        return;
    }
    
    showNotification('Ticket Created', 'New support ticket created successfully', 'success');
    bootstrap.Modal.getInstance(document.getElementById('newTicketModal')).hide();
    
    // In a real app, you would reload the tickets list
    setTimeout(() => {
        loadSupportTickets();
    }, 500);
}

function exportTickets() {
    showNotification('Export', 'Preparing tickets for export...', 'info');
    
    setTimeout(() => {
        showNotification('Export', 'Tickets exported successfully', 'success');
    }, 1500);
}
</script>

<!-- Fix for Shop Owner Admin Dashboard -->
<script>
// 1. Fix for Chart.js error (destroy previous chart before creating a new one)
function createRevenueChart(context, labels, data) {
    // Destroy previous chart if it exists
    if (window.revenueChart) {
        window.revenueChart.destroy();
    }
    
    window.revenueChart = new Chart(context, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue ($)',
                data: data,
                backgroundColor: 'rgba(78, 84, 200, 0.7)',
                borderColor: 'rgba(78, 84, 200, 1)',
                borderWidth: 1,
                borderRadius: 5,
                barThickness: 25
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
}

// 2. Add missing Edit Shop Profile modal
document.addEventListener('DOMContentLoaded', function() {
    // Add Shop Profile Modal
    const shopProfileModal = `
    <div class="modal fade" id="shopProfileModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Shop Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="shop-profile-form">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="shop-name-input" class="form-label">Shop Name</label>
                                <input type="text" class="form-control" id="shop-name-input" value="Elite Cuts Barbershop">
                            </div>
                            <div class="col-md-6">
                                <label for="shop-phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="shop-phone" value="(555) 123-4567">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shop-address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="shop-address" value="123 Main Street, Suite 101">
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="shop-city" class="form-label">City</label>
                                <input type="text" class="form-control" id="shop-city" value="New York">
                            </div>
                            <div class="col-md-4">
                                <label for="shop-state" class="form-label">State</label>
                                <input type="text" class="form-control" id="shop-state" value="NY">
                            </div>
                            <div class="col-md-4">
                                <label for="shop-zip" class="form-label">ZIP Code</label>
                                <input type="text" class="form-control" id="shop-zip" value="10001">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shop-description-input" class="form-label">Description</label>
                            <textarea class="form-control" id="shop-description-input" rows="3">Premium grooming services since 2018</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shop-website" class="form-label">Website</label>
                            <input type="url" class="form-control" id="shop-website" value="https://elitecuts.com">
                        </div>
                        
                        <div class="mb-3">
                            <label for="shop-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="shop-email" value="info@elitecuts.com">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Social Media</label>
                            <div class="input-group mb-2">
                                <span class="input-group-text"><i class="fab fa-facebook"></i></span>
                                <input type="text" class="form-control" placeholder="Facebook URL" value="https://facebook.com/elitecuts">
                            </div>
                            <div class="input-group mb-2">
                                <span class="input-group-text"><i class="fab fa-instagram"></i></span>
                                <input type="text" class="form-control" placeholder="Instagram URL" value="https://instagram.com/elitecuts">
                            </div>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fab fa-twitter"></i></span>
                                <input type="text" class="form-control" placeholder="Twitter URL" value="https://twitter.com/elitecuts">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveShopProfile()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add Inventory Modal content
    const inventoryModalContent = `
        <div class="modal-header">
            <h5 class="modal-title">Inventory Management</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <div class="d-flex justify-content-between mb-3">
                <button class="btn btn-primary" onclick="addInventoryItem()">
                    <i class="fas fa-plus me-2"></i>Add New Item
                </button>
                <div class="input-group" style="width: 250px;">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search items..." id="inventory-search">
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Category</th>
                            <th>Current Stock</th>
                            <th>Low Stock Alert</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Premium Hair Spray</td>
                            <td>Hair Products</td>
                            <td><span class="text-danger">2</span></td>
                            <td>5</td>
                            <td>
                                <button class="btn btn-sm btn-primary me-1" onclick="updateInventory(1)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-success" onclick="reorderInventory(1)">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>Styling Gel</td>
                            <td>Hair Products</td>
                            <td>8</td>
                            <td>5</td>
                            <td>
                                <button class="btn btn-sm btn-primary me-1" onclick="updateInventory(2)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-success" onclick="reorderInventory(2)">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>Aftershave Lotion</td>
                            <td>Shaving Products</td>
                            <td><span class="text-danger">3</span></td>
                            <td>5</td>
                            <td>
                                <button class="btn btn-sm btn-primary me-1" onclick="updateInventory(3)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-success" onclick="reorderInventory(3)">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">
                <i class="fas fa-file-export me-2"></i>Export Inventory
            </button>
        </div>
    `;
    
    // Add Notification Modal content
    const notificationModalContent = `
        <div class="modal-header">
            <h5 class="modal-title">Send Notification</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <div class="mb-3">
                <label for="notification-type" class="form-label">Notification Type</label>
                <select class="form-select" id="notification-type">
                    <option value="all_customers">All Customers</option>
                    <option value="specific_customer">Specific Customer</option>
                    <option value="upcoming_appointments">Customers with Upcoming Appointments</option>
                    <option value="staff">Staff Members</option>
                </select>
            </div>
            <div class="mb-3" id="specific-customer-container" style="display: none;">
                <label for="customer-select" class="form-label">Select Customer</label>
                <select class="form-select" id="customer-select">
                    <option value="">Select a customer...</option>
                    <option value="1">John Smith</option>
                    <option value="2">Sarah Johnson</option>
                    <option value="3">Michael Williams</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="notification-title" class="form-label">Title</label>
                <input type="text" class="form-control" id="notification-title" placeholder="Enter notification title">
            </div>
            <div class="mb-3">
                <label for="notification-message" class="form-label">Message</label>
                <textarea class="form-control" id="notification-message" rows="4" placeholder="Enter your message..."></textarea>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="send-email-copy">
                <label class="form-check-label" for="send-email-copy">
                    Also send as email
                </label>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="send-sms-copy">
                <label class="form-check-label" for="send-sms-copy">
                    Also send as SMS
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="sendCustomerNotification()">
                <i class="fas fa-paper-plane me-2"></i>Send Notification
            </button>
        </div>
    `;
    
    // Add Review Reply Modal content
    const reviewReplyModalContent = `
        <div class="review-summary mb-3 p-3 bg-light rounded">
            <div class="d-flex align-items-center mb-2">
                <img src="https://ui-avatars.com/api/?name=Shop+Owner&background=4e54c8" 
                    class="avatar me-2" width="30" height="30" alt="Shop Response">
                <strong>Shop Response</strong>
            </div>
            <div class="review-rating mb-2">
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star-half-alt text-warning"></i>
            </div>
            <div class="text-muted small mb-2">
                Reviewed by Customer Name  2 days ago
            </div>
            <div class="review-text">
                Great service and amazing attention to detail.
            </div>
        </div>
        <div class="form-floating">
            <textarea class="form-control" id="review-reply-text" style="height: 120px" placeholder="Enter your response..."></textarea>
            <label for="review-reply-text">Your Response</label>
        </div>
        <div class="form-text">
            Your reply will be publicly visible to all customers.
        </div>
    `;
    
    // Add Services Table content
    const servicesTableContent = `
        <thead>
            <tr>
                <th>Service</th>
                <th>Duration</th>
                <th>Price</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Classic Haircut</td>
                <td>30 min</td>
                <td>$25.00</td>
                <td><span class="badge bg-success">Active</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(1)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(1, 'active')">
                        <i class="fas fa-toggle-on"></i>
                    </button>
                </td>
            </tr>
            <tr>
                <td>Premium Haircut</td>
                <td>45 min</td>
                <td>$35.00</td>
                <td><span class="badge bg-success">Active</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(2)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(2, 'active')">
                        <i class="fas fa-toggle-on"></i>
                    </button>
                </td>
            </tr>
            <tr>
                <td>Beard Trim</td>
                <td>15 min</td>
                <td>$15.00</td>
                <td><span class="badge bg-success">Active</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editService(3)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="toggleServiceStatus(3, 'active')">
                        <i class="fas fa-toggle-on"></i>
                    </button>
                </td>
            </tr>
        </tbody>
    `;
    
    // Add the modals to the document
    if (!document.getElementById('shopProfileModal')) {
        document.body.insertAdjacentHTML('beforeend', shopProfileModal);
    }
    
    // Complete the empty modals
    setTimeout(() => {
        // Fix inventory modal
        const inventoryModal = document.getElementById('inventoryModal');
        if (inventoryModal && !inventoryModal.querySelector('.modal-title')) {
            const modalContent = inventoryModal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.innerHTML = inventoryModalContent;
            }
        }
        
        // Fix notification modal
        const notificationModal = document.getElementById('sendNotificationModal');
        if (notificationModal) {
            const modalContent = notificationModal.querySelector('.modal-content');
            if (modalContent && !modalContent.querySelector('.modal-title')) {
                modalContent.innerHTML = notificationModalContent;
                
                // Add notification type change handler
                setTimeout(() => {
                    const notificationType = document.getElementById('notification-type');
                    if (notificationType) {
                        notificationType.addEventListener('change', function() {
                            const specificCustomerContainer = document.getElementById('specific-customer-container');
                            if (specificCustomerContainer) {
                                specificCustomerContainer.style.display = this.value === 'specific_customer' ? 'block' : 'none';
                            }
                        });
                    }
                }, 100);
            }
        }
        
        // Fix review reply modal
        const reviewModal = document.getElementById('reviewReplyModal');
        if (reviewModal) {
            const modalBody = reviewModal.querySelector('.modal-body');
            if (modalBody && !modalBody.querySelector('.review-summary')) {
                modalBody.innerHTML = reviewReplyModalContent;
            }
            
            const primaryBtn = reviewModal.querySelector('.btn-primary');
            if (primaryBtn && !primaryBtn.innerHTML) {
                primaryBtn.innerHTML = '<i class="fas fa-paper-plane me-1"></i>Submit Reply';
            }
        }
        
        // Fix services table
        const servicesTable = document.getElementById('services-table');
        if (servicesTable) {
            const thead = servicesTable.querySelector('thead tr');
            if (thead && !thead.innerHTML.trim()) {
                servicesTable.innerHTML = servicesTableContent;
            }
        }
    }, 500);

    // 3. Improved styling for dark mode and fix revenue chart layout
    const enhancedStyle = document.createElement('style');
    enhancedStyle.textContent = `
        /* Improved dark mode support */
        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --text-muted: #adb5bd;
            --card-bg: #1e1e1e;
            --card-border: #333333;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.3);
            --header-bg: linear-gradient(135deg, #2f3241 0%, #121212 100%);
            --header-text: #ffffff;
            --primary-color: #5a60d6;
            --primary-hover: #4c51b9;
            --success-color: #2ea043;
            --danger-color: #f85149;
            --warning-color: #d29922;
            --info-color: #2188ff;
            --table-border: #333333;
            --table-stripe: #252525;
            --modal-bg: #1e1e1e;
            --modal-header: #252525;
            --modal-border: #333333;
            --input-bg: #2a2a2a;
            --input-border: #444444;
        }
        
        /* Fix revenue chart layout */
        .card-body {
            padding: 1rem;
            position: relative;
        }
        
        .card-body canvas {
            min-height: 250px;
            width: 100% !important;
            max-height: 300px;
        }
        
        #top-services-container {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            background-color: rgba(0,0,0,0.02);
        }
        
        [data-theme="dark"] #top-services-container {
            background-color: rgba(255,255,255,0.05);
        }
        
        .progress {
            height: 8px;
            margin-top: 5px;
            background-color: rgba(0,0,0,0.1);
        }
        
        [data-theme="dark"] .progress {
            background-color: rgba(255,255,255,0.1);
        }
        
        /* Fix shop actions dropdown */
        .shop-actions {
            position: relative;
            z-index: 1000;
        }
        
        .shop-actions-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--card-bg);
            min-width: 250px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid var(--card-border);
            transition: all 0.3s;
        }
        
        .shop-actions-content.show {
            display: block;
        }
        
        /* Enhanced notification styling */
        .unread-notification {
            border-left: 4px solid var(--primary-color);
            background-color: rgba(78, 84, 200, 0.05);
        }
        
        [data-theme="dark"] .unread-notification {
            background-color: rgba(78, 84, 200, 0.1);
        }
        
        /* Improved modal styling */
        .modal-content {
            border: none;
        }
        
        [data-theme="dark"] .modal-content {
            background-color: #1e1e1e;
            border: 1px solid #333;
        }
        
        [data-theme="dark"] .modal-header {
            border-bottom: 1px solid #333;
            background-color: #252525;
        }
        
        [data-theme="dark"] .modal-footer {
            border-top: 1px solid #333;
        }
        
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background-color: #2a2a2a;
            border-color: #444;
            color: #e0e0e0;
        }
        
        [data-theme="dark"] .bg-light {
            background-color: #252525 !important;
        }
        
        [data-theme="dark"] .text-muted {
            color: #adb5bd !important;
        }
        
        /* Fix badge colors in dark mode */
        [data-theme="dark"] .badge.bg-success {
            background-color: #2ea043 !important;
        }
        
        [data-theme="dark"] .badge.bg-warning {
            background-color: #d29922 !important;
        }
        
        [data-theme="dark"] .badge.bg-danger {
            background-color: #f85149 !important;
        }
        
        [data-theme="dark"] .badge.bg-info {
            background-color: #2188ff !important;
        }
        
        /* Make sure the page has a set height */
        html, body {
            min-height: 100vh;
        }
        
        .container {
            margin-bottom: 50px;
        }
    `;
    
    document.head.appendChild(enhancedStyle);
});

// 4. Shop Action functions
function editShopProfile() {
    // Pull shop data
    const shopName = document.getElementById('shop-name').textContent;
    const shopDescription = document.getElementById('shop-description').textContent;
    
    // Set form values if available
    if (document.getElementById('shop-name-input')) {
        document.getElementById('shop-name-input').value = shopName || 'Elite Cuts Barbershop';
        document.getElementById('shop-description-input').value = shopDescription || 'Premium grooming services since 2018';
    }
    
    // Show modal
    const shopProfileModal = new bootstrap.Modal(document.getElementById('shopProfileModal'));
    shopProfileModal.show();
}

function saveShopProfile() {
    const shopName = document.getElementById('shop-name-input').value;
    const shopDescription = document.getElementById('shop-description-input').value;
    
    // Update shop info on main page
    document.getElementById('shop-name').textContent = shopName;
    document.getElementById('shop-description').textContent = shopDescription;
    
    // Show success notification
    showNotification('Shop Profile', 'Profile updated successfully', 'success');
    
    // Close modal
    bootstrap.Modal.getInstance(document.getElementById('shopProfileModal')).hide();
}

function viewShopAnalytics() {
    showNotification('Analytics', 'Advanced analytics feature coming soon', 'info');
}

// 5. Add custom notification system
function showNotification(title, message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `toast show notification-${type}`;
    notification.setAttribute('role', 'alert');
    notification.setAttribute('aria-live', 'assertive');
    notification.setAttribute('aria-atomic', 'true');
    
    // Get appropriate icon based on type
    let iconClass = 'fa-info-circle text-info';
    if (type === 'success') iconClass = 'fa-check-circle text-success';
    if (type === 'warning') iconClass = 'fa-exclamation-triangle text-warning';
    if (type === 'error') iconClass = 'fa-exclamation-circle text-danger';
    
    notification.innerHTML = `
        <div class="toast-header">
            <i class="fas ${iconClass} me-2"></i>
            <strong class="me-auto">${title}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    // Add to container (create if it doesn't exist)
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(container);
    }
    
    container.appendChild(notification);
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.remove();
        }, 500);
    }, 5000);
}
</script>
{% endblock %}

