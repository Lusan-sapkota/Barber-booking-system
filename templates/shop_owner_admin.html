{% extends "base.html" %}

{% block title %}Shop Owner Dashboard - BookaBarber{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
<style>
/* Base Styling with Light/Dark Mode Variables */
:root {
  /* Light Mode (Default) */
  --bg-color: #f8f9fa;
  --text-color: #212529;
  --text-muted: #6c757d;
  --card-bg: #ffffff;
  --card-border: #dee2e6;
  --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
  --header-bg: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
  --header-text: #ffffff;
  --primary-color: #4e54c8;
  --primary-hover: #3c3fa0;
  --success-color: #28a745;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --info-color: #17a2b8;
  --secondary-color: #6c757d;
  --table-border: #dee2e6;
  --table-stripe: #f9f9f9;
  --modal-bg: #ffffff;
  --modal-header: #f8f9fa;
  --modal-border: #dee2e6;
  --input-bg: #ffffff;
  --input-border: #ced4da;
}

/* Dark Mode Variables */
[data-theme="dark"] {
  --bg-color: #121212;
  --text-color: #e0e0e0;
  --text-muted: #adb5bd;
  --card-bg: #1e1e1e;
  --card-border: #333333;
  --card-shadow: 0 4px 6px rgba(0,0,0,0.3);
  --header-bg: linear-gradient(135deg, #2f3241 0%, #121212 100%);
  --header-text: #ffffff;
  --primary-color: #5a60d6;
  --primary-hover: #4c51b9;
  --table-border: #333333;
  --table-stripe: #252525;
  --modal-bg: #1e1e1e;
  --modal-header: #252525;
  --modal-border: #333333;
  --input-bg: #2a2a2a;
  --input-border: #444444;
}

/* Main Layout */
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: all 0.3s ease;
}

.shop-header {
  background: var(--header-bg);
  color: var(--header-text);
  padding: 2rem 0;
  margin-bottom: 2rem;
}

.card {
  background-color: var(--card-bg);
  border: 1px solid var(--card-border);
  box-shadow: var(--card-shadow);
  border-radius: 10px;
  transition: all 0.3s ease;
}

.card-header {
  border-bottom: 1px solid var(--card-border);
  background-color: var(--card-bg);
  padding: 1rem;
  font-weight: 600;
}

/* Stats Cards */
.stat-card {
  text-align: center;
  padding: 1.5rem;
  border-radius: 10px;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
}

.revenue-card {
  background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
  color: white;
}

.bookings-card {
  background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
  color: white;
}

.rating-card {
  background: linear-gradient(135deg, #FF9800 0%, #EF6C00 100%);
  color: white;
}

.staff-card {
  background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
  color: white;
}

/* Shop Actions Menu */
.shop-actions {
  position: relative;
  display: inline-block;
}

.shop-actions-content {
  display: none;
  position: absolute;
  right: 0;
  background-color: var(--card-bg);
  min-width: 250px;
  box-shadow: var(--card-shadow);
  z-index: 1;
  border-radius: 10px;
  padding: 1rem;
  border: 1px solid var(--card-border);
}

.shop-actions:hover .shop-actions-content {
  display: block;
}

.shop-actions-item {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.shop-actions-item:hover {
  background-color: var(--primary-color);
  color: white;
}

.shop-actions-item i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

/* Staff List */
.staff-list {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.staff-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 10px;
  overflow: hidden;
  width: 100%;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.staff-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--card-shadow);
}

.staff-card-header {
  padding: 1rem;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.staff-info {
  display: flex;
  align-items: center;
}

.staff-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 1rem;
}

.staff-name {
  margin: 0;
  font-weight: 600;
  font-size: 1rem;
}

.staff-role {
  color: var(--text-muted);
  font-size: 0.9rem;
}

.staff-status {
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-active {
  background-color: rgba(40, 167, 69, 0.15);
  color: #28a745;
}

.status-inactive {
  background-color: rgba(108, 117, 125, 0.15);
  color: #6c757d;
}

.status-leave {
  background-color: rgba(255, 193, 7, 0.15);
  color: #ffc107;
}

.staff-card-body {
  padding: 1rem;
  border-top: 1px solid var(--card-border);
}

.staff-metrics {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.staff-metric {
  text-align: center;
  flex: 1;
}

.staff-metric-value {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0;
}

.staff-metric-label {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin: 0;
}

/* Schedule */
.schedule-container {
  margin-bottom: 1.5rem;
}

.appointment {
  padding: 0.75rem;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  background-color: var(--card-bg);
  border-left: 4px solid var(--primary-color);
  box-shadow: var(--card-shadow);
}

.appointment-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.appointment-time {
  font-weight: 600;
}

.appointment-status {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 600;
}

.status-confirmed {
  background-color: rgba(33, 150, 243, 0.15);
  color: #2196f3;
}

.status-completed {
  background-color: rgba(40, 167, 69, 0.15);
  color: #28a745;
}

.status-cancelled {
  background-color: rgba(220, 53, 69, 0.15);
  color: #dc3545;
}

.status-checked-in {
  background-color: rgba(255, 193, 7, 0.15);
  color: #ffc107;
}

.appointment-client {
  display: flex;
  align-items: center;
  margin-bottom: 0.5rem;
}

.appointment-client-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  margin-right: 0.5rem;
  object-fit: cover;
}

.appointment-client-name {
  font-weight: 600;
  margin: 0;
  font-size: 0.95rem;
}

.appointment-service {
  color: var(--text-muted);
  margin: 0;
  font-size: 0.85rem;
}

.appointment-barber {
  display: flex;
  align-items: center;
  color: var(--text-muted);
  font-size: 0.85rem;
}

.appointment-barber i {
  margin-right: 0.5rem;
}

/* Reviews */
.review-card {
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  border: 1px solid var(--card-border);
  background-color: var(--card-bg);
}

.review-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.review-author {
  display: flex;
  align-items: center;
}

.review-author-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-right: 0.75rem;
  object-fit: cover;
}

.review-author-name {
  font-weight: 600;
  margin: 0;
}

.review-date {
  color: var(--text-muted);
  font-size: 0.85rem;
}

.review-rating {
  color: #ffc107;
  font-size: 1rem;
}

.review-text {
  margin-bottom: 0.75rem;
  font-size: 0.95rem;
}

.review-barber {
  color: var(--text-muted);
  font-size: 0.85rem;
  margin-bottom: 0.75rem;
}

.review-reply {
  background-color: rgba(0, 0, 0, 0.05);
  padding: 0.75rem;
  border-radius: 8px;
  margin-top: 0.75rem;
  position: relative;
}

[data-theme="dark"] .review-reply {
  background-color: rgba(255, 255, 255, 0.05);
}

.review-reply:before {
  content: '';
  position: absolute;
  top: -8px;
  left: 20px;
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 8px solid rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] .review-reply:before {
  border-bottom-color: rgba(255, 255, 255, 0.05);
}

/* Inventory */
.inventory-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  border-bottom: 1px solid var(--card-border);
}

.inventory-info {
  display: flex;
  align-items: center;
}

.inventory-icon {
  background-color: rgba(33, 150, 243, 0.15);
  color: #2196f3;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
}

.inventory-name {
  margin: 0;
  font-weight: 600;
}

.inventory-stock {
  font-size: 0.85rem;
  color: var(--text-muted);
}

.inventory-low {
  color: #dc3545;
}

/* Dark Mode Toggle */
.dark-mode-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--primary-color);
  border: none;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  color: var(--header-text);
  font-size: 1.2rem;
  z-index: 1000;
}

.dark-mode-toggle:hover {
  transform: scale(1.1);
}

/* Tables */
.table {
  color: var(--text-color);
}

.table th, .table td {
  border-color: var(--table-border);
}

.table-striped tbody tr:nth-of-type(odd) {
  background-color: var(--table-stripe);
}

/* Forms */
.form-control, .form-select {
  background-color: var(--input-bg);
  border-color: var(--input-border);
  color: var(--text-color);
}

/* Shop logo */
.shop-logo {
  position: relative;
  display: inline-block;
  margin-bottom: 1rem;
}

.shop-logo img {
  width: 100px;
  height: 100px;
  border-radius: 10px;
  object-fit: cover;
  border: 3px solid white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.shop-logo .logo-change {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: var(--primary-color);
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

/* Modal overrides */
.modal-content {
  background-color: var(--modal-bg);
  color: var(--text-color);
}

.modal-header {
  background-color: var(--modal-header);
  border-bottom-color: var(--modal-border);
}

.modal-footer {
  border-top-color: var(--modal-border);
}
</style>
{% endblock %}

{% block content %}
<div class="shop-owner-dashboard">
    <!-- Dashboard Header -->
    <section class="shop-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="shop-logo">
                        <img src="https://via.placeholder.com/100" alt="Shop Logo" id="shop-logo-img">
                        <div class="logo-change" onclick="changeShopLogo()">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <h1 class="mb-2" id="shop-name">Loading shop information...</h1>
                    <p class="mb-0 opacity-75" id="shop-description">Please wait...</p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <div class="shop-actions">
                        <button class="btn btn-light btn-lg shadow-sm">
                            <i class="fas fa-cog me-2"></i>Shop Actions
                        </button>
                        <div class="shop-actions-content">
                            <div class="shop-actions-item" onclick="editShopProfile()">
                                <i class="fas fa-store"></i> Edit Shop Profile
                            </div>
                            <div class="shop-actions-item" onclick="toggleShopStatus()">
                                <i class="fas fa-toggle-on"></i> Toggle Shop Status
                            </div>
                            <div class="shop-actions-item" onclick="manageShopHours()">
                                <i class="fas fa-clock"></i> Manage Hours
                            </div>
                            <div class="shop-actions-item" onclick="manageShopPolicies()">
                                <i class="fas fa-file-alt"></i> Shop Policies
                            </div>
                            <div class="shop-actions-item" onclick="viewShopAnalytics()">
                                <i class="fas fa-chart-line"></i> Advanced Analytics
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- Key Stats -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stat-card revenue-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-dollar-sign fa-2x"></i>
                    </div>
                    <h3 class="mb-1">$<span id="monthly-revenue">4,250</span></h3>
                    <small>Monthly Revenue</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-arrow-up me-1"></i> <span id="revenue-trend">12%</span> from last month
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card bookings-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                    <h3 class="mb-1"><span id="today-bookings">15</span></h3>
                    <small>Today's Bookings</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-arrow-up me-1"></i> <span id="bookings-trend">3</span> more than yesterday
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card rating-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-star fa-2x"></i>
                    </div>
                    <h3 class="mb-1"><span id="customer-rating">4.8</span></h3>
                    <small>Customer Rating</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-star me-1"></i> Based on <span id="review-count">142</span> reviews
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card staff-card shadow-sm">
                    <div class="stat-icon mb-2">
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                    <h3 class="mb-1"><span id="active-staff">7</span></h3>
                    <small>Active Staff</small>
                    <div class="mt-2">
                        <small class="text-white d-flex align-items-center justify-content-center">
                            <i class="fas fa-check-circle me-1"></i> <span id="staff-status">All barbers available</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- Today's Schedule -->
            <div class="col-lg-8 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar-day me-2"></i>Today's Schedule
                        </h5>
                        <div>
                            <button class="btn btn-light btn-sm me-2" onclick="previousDay()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="current-date">Today</span>
                            <button class="btn btn-light btn-sm ms-2" onclick="nextDay()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body schedule-container" id="schedule-container">
                        <!-- Schedule will be loaded here -->
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-3">Loading schedule...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt me-2"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-3">
                            <button class="btn btn-primary shadow-sm" onclick="manageServices()">
                                <i class="fas fa-cut me-2"></i>Manage Services
                            </button>
                            <button class="btn btn-success shadow-sm" onclick="addPromotion()">
                                <i class="fas fa-tags me-2"></i>Add Promotion
                            </button>
                            <button class="btn btn-warning shadow-sm" onclick="manageReviews()">
                                <i class="fas fa-star me-2"></i>Manage Reviews
                            </button>
                            <button class="btn btn-info shadow-sm" onclick="inventoryAlert()">
                                <i class="fas fa-box me-2"></i>Inventory Management
                            </button>
                            <button class="btn btn-secondary shadow-sm" onclick="viewSupportTickets()">
                                <i class="fas fa-ticket-alt me-2"></i>Support Tickets
                            </button>
                            <button class="btn btn-danger shadow-sm" onclick="sendNotification()">
                                <i class="fas fa-bell me-2"></i>Send Notification
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- Staff Management -->
            <div class="col-lg-8 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-user-tie me-2"></i>Staff Management
                        </h5>
                        <button class="btn btn-sm btn-primary" onclick="addNewStaff()">
                            <i class="fas fa-plus me-1"></i>Add Staff
                        </button>
                    </div>
                    <div class="card-body" id="staff-list-container">
                        <!-- Staff will be loaded here -->
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-3">Loading staff members...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Analytics -->
            <div class="col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Revenue Analytics
                        </h5>
                        <select class="form-select form-select-sm" style="width: auto;" id="revenue-period" onchange="updateRevenueChart()">
                            <option value="week">This Week</option>
                            <option value="month" selected>This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <canvas id="revenue-chart" height="250"></canvas>
                        
                        <div class="mt-4">
                            <h6>Top Services by Revenue</h6>
                            <div id="top-services-container">
                                <!-- Top services will be loaded here -->
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Recent Reviews -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-star me-2"></i>Recent Reviews
                        </h5>
                        <button class="btn btn-sm btn-primary" onclick="viewAllReviews()">
                            View All
                        </button>
                    </div>
                    <div class="card-body" id="reviews-container">
                        <!-- Reviews will be loaded here -->
                        <div class="d-flex justify-content-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Center -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-bell me-2"></i>Notification Center
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" onclick="markAllAsRead()">
                                <i class="fas fa-check-double me-1"></i>Mark All Read
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="notifications-list">
                            <!-- Notifications will be loaded here -->
                            <li class="list-group-item text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="text-muted mt-3">Loading notifications...</p>
                            </li>
                        </ul>
                    </div>
                    <div class="card-footer text-center">
                        <a href="#" class="text-primary" onclick="viewAllNotifications()">View All Notifications</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Activity Logs -->
        <div class="row">
            <div class="col-12 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-history me-2"></i>Recent Activity
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="exportActivityLog()">
                            <i class="fas fa-download me-1"></i>Export Log
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Action</th>
                                        <th>Staff Member</th>
                                        <th>Details</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-log-table">
                                    <!-- Activity logs will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Add Promotion Modal -->
<div class="modal fade" id="promotionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Promotion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="promotion-form">
                    <div class="mb-3">
                        <label for="promo-name" class="form-label">Promotion Name</label>
                        <input type="text" class="form-control" id="promo-name" placeholder="Summer Special, Holiday Discount, etc.">
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label for="promo-start" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="promo-start">
                        </div>
                        <div class="col-6">
                            <label for="promo-end" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="promo-end">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="promo-type" class="form-label">Promotion Type</label>
                        <select class="form-select" id="promo-type">
                            <option value="percentage">Percentage Discount</option>
                            <option value="fixed">Fixed Amount Discount</option>
                            <option value="bogo">Buy One Get One Free</option>
                            <option value="free">Free Add-on Service</option>
                        </select>
                    </div>
                    <div class="mb-3" id="discount-value-container">
                        <label for="discount-value" class="form-label">Discount Value</label>
                        <div class="input-group">
                            <span class="input-group-text" id="discount-symbol">%</span>
                            <input type="number" class="form-control" id="discount-value" min="1" max="100" value="10">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="applicable-services" class="form-label">Applicable Services</label>
                        <select class="form-select" id="applicable-services" multiple size="4">
                            <option value="all" selected>All Services</option>
                            <option value="1">Classic Haircut</option>
                            <option value="2">Premium Haircut</option>
                            <option value="3">Beard Trim</option>
                            <option value="4">Hot Towel Shave</option>
                            <option value="5">Haircut & Beard Combo</option>
                        </select>
                        <div class="form-text">
                            Hold Ctrl/Cmd to select multiple services
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="promo-description" class="form-label">Promotion Description</label>
                        <textarea class="form-control" id="promo-description" rows="3" placeholder="Describe your promotion in detail..."></textarea>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="promo-active" checked>
                        <label class="form-check-label" for="promo-active">Activate promotion immediately</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="savePromotion()">
                    <i class="fas fa-save me-2"></i>Create Promotion
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the dashboard
    loadShopInfo();
    loadStaffMembers();
    loadSchedule();
    initializeRevenueChart();
    loadReviews();
    loadNotifications();
    loadActivityLog();
    loadTopServices();
    
    // Initialize real-time data refresh
    setInterval(refreshDashboardData, 60000); // Refresh every minute
});

// Load Shop Information
function loadShopInfo() {
    fetch('/api/shop-owner/profile')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            document.getElementById('shop-name').textContent = data.name;
            document.getElementById('shop-description').textContent = data.description;
            if (data.logo_url) {
                document.getElementById('shop-logo-img').src = data.logo_url;
            }
            
            // Update stats
            document.getElementById('monthly-revenue').textContent = data.stats.monthly_revenue.toLocaleString();
            document.getElementById('revenue-trend').textContent = data.stats.revenue_trend + '%';
            document.getElementById('today-bookings').textContent = data.stats.today_bookings;
            document.getElementById('bookings-trend').textContent = data.stats.bookings_trend;
            document.getElementById('customer-rating').textContent = data.stats.customer_rating;
            document.getElementById('review-count').textContent = data.stats.review_count;
            document.getElementById('active-staff').textContent = data.stats.active_staff;
            document.getElementById('staff-status').textContent = data.stats.staff_status;
        })
        .catch(error => {
            console.error('Error loading shop info:', error);
            
            // Use mock data
            const mockShopData = {
                name: "Elite Cuts Barbershop",
                description: "Premium grooming services since 2018",
                logo_url: "https://via.placeholder.com/100",
                stats: {
                    monthly_revenue: 4250,
                    revenue_trend: 12,
                    today_bookings: 15,
                    bookings_trend: 3,
                    customer_rating: 4.8,
                    review_count: 142,
                    active_staff: 7,
                    staff_status: "All barbers available"
                }
            };
            
            document.getElementById('shop-name').textContent = mockShopData.name;
            document.getElementById('shop-description').textContent = mockShopData.description;
            document.getElementById('shop-logo-img').src = mockShopData.logo_url;
            
            // Update stats with mock data
            document.getElementById('monthly-revenue').textContent = mockShopData.stats.monthly_revenue.toLocaleString();
            document.getElementById('revenue-trend').textContent = mockShopData.stats.revenue_trend + '%';
            document.getElementById('today-bookings').textContent = mockShopData.stats.today_bookings;
            document.getElementById('bookings-trend').textContent = mockShopData.stats.bookings_trend;
            document.getElementById('customer-rating').textContent = mockShopData.stats.customer_rating;
            document.getElementById('review-count').textContent = mockShopData.stats.review_count;
            document.getElementById('active-staff').textContent = mockShopData.stats.active_staff;
            document.getElementById('staff-status').textContent = mockShopData.stats.staff_status;
        });
}

// Load Staff Members
function loadStaffMembers() {
    const staffContainer = document.getElementById('staff-list-container');
    
    fetch('/api/shop-owner/staff')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderStaffMembers(data);
        })
        .catch(error => {
            console.error('Error loading staff members:', error);
            
            // Use mock data
            const mockStaff = [
                {
                    id: 1,
                    first_name: "Michael",
                    last_name: "Johnson",
                    avatar: "https://ui-avatars.com/api/?name=Michael+Johnson&background=random",
                    role: "Senior Barber",
                    status: "active",
                    metrics: {
                        bookings: 42,
                        rating: 4.9,
                        revenue: 1250
                    }
                },
                {
                    id: 2,
                    first_name: "James",
                    last_name: "Wilson",
                    avatar: "https://ui-avatars.com/api/?name=James+Wilson&background=random",
                    role: "Master Barber",
                    status: "active",
                    metrics: {
                        bookings: 38,
                        rating: 4.7,
                        revenue: 1120
                    }
                },
                {
                    id: 3,
                    first_name: "Chris",
                    last_name: "Adams",
                    avatar: "https://ui-avatars.com/api/?name=Chris+Adams&background=random",
                    role: "Barber",
                    status: "leave",
                    metrics: {
                        bookings: 0,
                        rating: 4.8,
                        revenue: 0
                    }
                },
                {
                    id: 4,
                    first_name: "Lisa",
                    last_name: "Rodriguez",
                    avatar: "https://ui-avatars.com/api/?name=Lisa+Rodriguez&background=random",
                    role: "Stylist",
                    status: "active",
                    metrics: {
                        bookings: 32,
                        rating: 4.9,
                        revenue: 980
                    }
                }
            ];
            
            renderStaffMembers(mockStaff);
        });
}

function renderStaffMembers(staffMembers) {
    const staffContainer = document.getElementById('staff-list-container');
    
    const html = `
        <div class="row">
            ${staffMembers.map(staff => `
                <div class="col-lg-6 mb-3">
                    <div class="staff-card">
                        <div class="staff-card-header">
                            <div class="staff-info">
                                <img src="${staff.avatar}" class="staff-avatar" alt="${staff.first_name} ${staff.last_name}">
                                <div>
                                    <h6 class="staff-name">${staff.first_name} ${staff.last_name}</h6>
                                    <span class="staff-role">${staff.role}</span>
                                </div>
                            </div>
                            <span class="staff-status status-${staff.status}">${staff.status === 'active' ? 'Active' : staff.status === 'leave' ? 'On Leave' : 'Inactive'}</span>
                        </div>
                        <div class="staff-card-body">
                            <div class="staff-metrics">
                                <div class="staff-metric">
                                    <p class="staff-metric-value">${staff.metrics.bookings}</p>
                                    <p class="staff-metric-label">Bookings</p>
                                </div>
                                <div class="staff-metric">
                                    <p class="staff-metric-value">${staff.metrics.rating}</p>
                                    <p class="staff-metric-label">Rating</p>
                                </div>
                                <div class="staff-metric">
                                    <p class="staff-metric-value">$${staff.metrics.revenue}</p>
                                    <p class="staff-metric-label">Revenue</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-sm btn-outline-primary" onclick="editStaff(${staff.id})">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </button>
                                ${staff.status === 'active' ? 
                                    `<button class="btn btn-sm btn-outline-danger" onclick="deactivateStaff(${staff.id})">
                                        <i class="fas fa-power-off me-1"></i>Deactivate
                                    </button>` : 
                                    `<button class="btn btn-sm btn-outline-success" onclick="updateStaffStatus(${staff.id})">
                                        <i class="fas fa-power-off me-1"></i>Activate
                                    </button>`
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
    
    staffContainer.innerHTML = html;
}

// Load Schedule
function loadSchedule() {
    const scheduleContainer = document.getElementById('schedule-container');
    
    fetch('/api/shop-owner/schedule?date=' + new Date().toISOString().split('T')[0])
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderSchedule(data);
        })
        .catch(error => {
            console.error('Error loading schedule:', error);
            
            // Use mock data
            const mockSchedule = [
                {
                    time: "9:00 AM",
                    status: "confirmed",
                    client: {
                        name: "John Smith",
                        avatar: "https://ui-avatars.com/api/?name=John+Smith&background=random"
                    },
                    service: "Classic Haircut",
                    barber: "Michael Johnson"
                },
                {
                    time: "10:00 AM",
                    status: "checked-in",
                    client: {
                        name: "Robert Davis",
                        avatar: "https://ui-avatars.com/api/?name=Robert+Davis&background=random"
                    },
                    service: "Premium Haircut & Beard Trim",
                    barber: "James Wilson"
                },
                {
                    time: "11:30 AM",
                    status: "confirmed",
                    client: {
                        name: "David Miller",
                        avatar: "https://ui-avatars.com/api/?name=David+Miller&background=random"
                    },
                    service: "Hot Towel Shave",
                    barber: "Chris Adams"
                },
                {
                    time: "1:00 PM",
                    status: "completed",
                    client: {
                        name: "Richard Thomas",
                        avatar: "https://ui-avatars.com/api/?name=Richard+Thomas&background=random"
                    },
                    service: "Haircut & Styling",
                    barber: "Michael Johnson"
                }
            ];
            
            renderSchedule(mockSchedule);
        });
}

function renderSchedule(appointments) {
    const scheduleContainer = document.getElementById('schedule-container');
    
    if (appointments.length === 0) {
        scheduleContainer.innerHTML = `
            <div class="text-center py-4">
                <i class="fas fa-calendar-day fa-3x text-muted mb-3"></i>
                <p class="text-muted">No appointments scheduled for today.</p>
            </div>
        `;
        return;
    }
    
    const html = appointments.map(appt => `
        <div class="appointment">
            <div class="appointment-header">
                <span class="appointment-time">${appt.time}</span>
                <span class="appointment-status status-${appt.status}">${appt.status === 'confirmed' ? 'Confirmed' : appt.status === 'checked-in' ? 'Checked In' : appt.status === 'completed' ? 'Completed' : 'Cancelled'}</span>
            </div>
            <div class="appointment-client">
                <img src="${appt.client.avatar}" class="appointment-client-avatar" alt="${appt.client.name}">
                <div>
                    <h6 class="appointment-client-name">${appt.client.name}</h6>
                    <p class="appointment-service">${appt.service}</p>
                </div>
            </div>
            <div class="appointment-barber">
                <i class="fas fa-user-tie"></i> Barber: ${appt.barber}
            </div>
        </div>
    `).join('');
    
    scheduleContainer.innerHTML = html;
}

// Load Top Services
function loadTopServices() {
    const topServicesContainer = document.getElementById('top-services-container');
    
    fetch('/api/shop-owner/top-services')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderTopServices(data);
        })
        .catch(error => {
            console.error('Error loading top services:', error);
            
            // Use mock data
            const mockTopServices = [
                { 
                    name: "Haircut + Beard Trim", 
                    revenue: 1680, 
                    percentage: 60 
                },
                { 
                    name: "Classic Haircut", 
                    revenue: 1250, 
                    percentage: 45 
                },
                { 
                    name: "Premium Package", 
                    revenue: 850, 
                    percentage: 30 
                }
            ];
            
            renderTopServices(mockTopServices);
        });
}

function renderTopServices(services) {
    const topServicesContainer = document.getElementById('top-services-container');
    
    const html = services.map(service => `
        <div class="mb-3">
            <div class="d-flex justify-content-between">
                <div>${service.name}</div>
                <div><strong>$${service.revenue.toLocaleString()}</strong></div>
            </div>
            <div class="progress">
                <div class="progress-bar bg-primary" style="width: ${service.percentage}%"></div>
            </div>
        </div>
    `).join('');
    
    topServicesContainer.innerHTML = html;
}

// Load Notifications
function loadNotifications() {
    const notificationsList = document.getElementById('notifications-list');
    
    fetch('/api/shop-owner/notifications')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderNotifications(data);
        })
        .catch(error => {
            console.error('Error loading notifications:', error);
            
            // Use mock data
            const mockNotifications = [
                {
                    id: 1,
                    type: "booking",
                    title: "New Booking Request",
                    message: "John Smith booked a Classic Haircut for tomorrow at 10:00 AM",
                    time: "10 min ago",
                    read: false
                },
                {
                    id: 2,
                    type: "review",
                    title: "New Review",
                    message: "Mark Williams left a 5-star review for Michael Johnson",
                    time: "2 hours ago",
                    read: false
                },
                {
                    id: 3,
                    type: "inventory",
                    title: "Low Inventory Alert",
                    message: "Premium Hair Spray is running low (2 units remaining)",
                    time: "Yesterday",
                    read: true
                },
                {
                    id: 4,
                    type: "payment",
                    title: "Payment Received",
                    message: "$540.00 has been deposited to your account",
                    time: "3 days ago",
                    read: true
                }
            ];
            
            renderNotifications(mockNotifications);
        });
}

function renderNotifications(notifications) {
    const notificationsList = document.getElementById('notifications-list');
    
    if (notifications.length === 0) {
        notificationsList.innerHTML = `
            <li class="list-group-item text-center py-4">
                <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
                <p class="text-muted">No notifications at this time.</p>
            </li>
        `;
        return;
    }
    
    const html = notifications.map(notification => {
        let iconClass = '';
        let iconColor = '';
        
        switch(notification.type) {
            case 'booking':
                iconClass = 'fas fa-calendar-check';
                iconColor = 'text-primary';
                break;
            case 'review':
                iconClass = 'fas fa-star';
                iconColor = 'text-warning';
                break;
            case 'inventory':
                iconClass = 'fas fa-box-open';
                iconColor = 'text-danger';
                break;
            case 'payment':
                iconClass = 'fas fa-money-bill-wave';
                iconColor = 'text-success';
                break;
            default:
                iconClass = 'fas fa-bell';
                iconColor = 'text-primary';
        }
        
        return `
            <li class="list-group-item d-flex align-items-center ${notification.read ? '' : 'unread-notification'}">
                <span class="notification-icon ${iconColor} me-3">
                    <i class="${iconClass}"></i>
                </span>
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between">
                        <h6 class="mb-1">${notification.title}</h6>
                        <small class="text-muted">${notification.time}</small>
                    </div>
                    <p class="mb-0 text-muted">${notification.message}</p>
                </div>
                <button class="btn btn-sm text-muted ms-2" onclick="dismissNotification(${notification.id})">
                    <i class="fas fa-times"></i>
                </button>
            </li>
        `;
    }).join('');
    
    notificationsList.innerHTML = html;
}

// Load Activity Log
function loadActivityLog() {
    const activityLogTable = document.getElementById('activity-log-table');
    
    fetch('/api/shop-owner/activity-log')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            renderActivityLog(data);
        })
        .catch(error => {
            console.error('Error loading activity log:', error);
            
            // Use mock data
            const mockActivityLog = [
                {
                    action: "create",
                    staff: "Michael Johnson",
                    details: "Created a new booking for John Smith",
                    time: "Today, 11:32 AM"
                },
                {
                    action: "update",
                    staff: "James Wilson",
                    details: "Updated service price: Hot Towel Shave from $25 to $30",
                    time: "Today, 10:15 AM"
                },
                {
                    action: "status",
                    staff: "Lisa Rodriguez",
                    details: "Changed booking status to \"Checked In\" for Robert Davis",
                    time: "Today, 9:48 AM"
                },
                {
                    action: "complete",
                    staff: "Michael Johnson",
                    details: "Marked booking as \"Completed\" for Richard Thomas",
                    time: "Today, 1:22 PM"
                },
                {
                    action: "cancel",
                    staff: "System",
                    details: "Automatically cancelled no-show appointment for Alex Johnson",
                    time: "Yesterday, 4:30 PM"
                }
            ];
            
            renderActivityLog(mockActivityLog);
        });
}

function renderActivityLog(logs) {
    const activityLogTable = document.getElementById('activity-log-table');
    
    if (logs.length === 0) {
        activityLogTable.innerHTML = `
            <tr>
                <td colspan="4" class="text-center py-4">
                    <i class="fas fa-history fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No activity logs available.</p>
                </td>
            </tr>
        `;
        return;
    }
    
    const html = logs.map(log => {
        let badgeClass = '';
        
        switch(log.action) {
            case 'create':
                badgeClass = 'bg-success';
                break;
            case 'update':
                badgeClass = 'bg-info';
                break;
            case 'status':
                badgeClass = 'bg-warning';
                break;
            case 'complete':
                badgeClass = 'bg-primary';
                break;
            case 'cancel':
                badgeClass = 'bg-danger';
                break;
            default:
                badgeClass = 'bg-secondary';
        }
        
        return `
            <tr>
                <td><span class="badge ${badgeClass}">${log.action.charAt(0).toUpperCase() + log.action.slice(1)}</span></td>
                <td>${log.staff}</td>
                <td>${log.details}</td>
                <td>${log.time}</td>
            </tr>
        `;
    }).join('');
    
    activityLogTable.innerHTML = html;
}

// Revenue Chart
function initializeRevenueChart() {
    const ctx = document.getElementById('revenue-chart').getContext('2d');
    
    // Load data from API or use demo data
    fetch('/api/shop-owner/revenue-data?period=month')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            createRevenueChart(ctx, data.labels, data.values);
        })
        .catch(error => {
            console.error('Error fetching revenue data:', error);
            
            // Use demo data if API call fails
            const demoLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const demoData = [1200, 1380, 950, 720];
            createRevenueChart(ctx, demoLabels, demoData);
        });
}

function createRevenueChart(context, labels, data) {
    window.revenueChart = new Chart(context, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue ($)',
                data: data,
                backgroundColor: 'rgba(78, 84, 200, 0.7)',
                borderColor: 'rgba(78, 84, 200, 1)',
                borderWidth: 1,
                borderRadius: 5,
                barThickness: 25
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
}

function updateRevenueChart() {
    const period = document.getElementById('revenue-period').value;
    
    // Try to fetch data from API
    fetch(`/api/shop-owner/revenue-data?period=${period}`)
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            updateChartData(data.labels, data.values);
        })
        .catch(error => {
            console.error('Error updating revenue data:', error);
            
            // Use demo data
            let demoLabels, demoData;
            
            switch(period) {
                case 'week':
                    demoLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    demoData = [320, 280, 350, 290, 410, 520, 380];
                    break;
                case 'month':
                    demoLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    demoData = [1200, 1380, 950, 720];
                    break;
                case 'quarter':
                    demoLabels = ['Month 1', 'Month 2', 'Month 3'];
                    demoData = [4250, 3980, 4750];
                    break;
                case 'year':
                    demoLabels = ['Q1', 'Q2', 'Q3', 'Q4'];
                    demoData = [12500, 14200, 13800, 15300];
                    break;
            }
            
            updateChartData(demoLabels, demoData);
        });
}

function updateChartData(labels, data) {
    if (window.revenueChart) {
        window.revenueChart.data.labels = labels;
        window.revenueChart.data.datasets[0].data = data;
        window.revenueChart.update();
    }
}

// Load Reviews
function loadReviews() {
    const reviewsContainer = document.getElementById('reviews-container');
    
    fetch('/api/shop-owner/reviews?limit=3&sort=newest')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data.success && data.reviews.length > 0) {
                reviewsContainer.innerHTML = renderReviews(data.reviews);
            } else {
                reviewsContainer.innerHTML = '<div class="text-center py-4"><p class="text-muted">No reviews yet</p></div>';
            }
        })
        .catch(error => {
            console.error('Error loading reviews:', error);
            
            // Load demo reviews
            const demoReviews = [
                {
                    id: 1,
                    customer: { name: 'Mark Williams', avatar: 'https://ui-avatars.com/api/?name=Mark+Williams&background=random' },
                    rating: 5,
                    text: 'Michael did an amazing job with my haircut. The attention to detail was impressive and the shop atmosphere is fantastic. Will definitely be coming back!',
                    date: '2 days ago',
                    barber: 'Michael Johnson',
                    response: null
                },
                {
                    id: 2,
                    customer: { name: 'Sarah Johnson', avatar: 'https://ui-avatars.com/api/?name=Sarah+Johnson&background=random' },
                    rating: 4,
                    text: 'Great service but had to wait about 15 minutes past my appointment time. The haircut was excellent though and James was very professional.',
                    date: '4 days ago',
                    barber: 'James Wilson',
                    response: 'Thank you for your feedback, Sarah! We apologize for the wait time and are working on improving our scheduling. We\'re glad you enjoyed your haircut and look forward to serving you better next time!'
                },
                {
                    id: 3,
                    customer: { name: 'David Brown', avatar: 'https://ui-avatars.com/api/?name=David+Brown&background=random' },
                    rating: 5,
                    text: 'Best barbershop in town! Chris gave me exactly the style I was looking for. The hot towel treatment was amazing too.',
                    date: '1 week ago',
                    barber: 'Chris Adams',
                    response: null
                }
            ];
            
            reviewsContainer.innerHTML = renderReviews(demoReviews);
        });
}

function renderReviews(reviews) {
    return reviews.map(review => `
        <div class="review-card">
            <div class="review-header">
                <div class="review-author">
                    <img src="${review.customer.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(review.customer.name)}&background=random`}" class="review-author-avatar" alt="${review.customer.name}">
                    <div>
                        <h6 class="review-author-name">${review.customer.name}</h6>
                        <div class="review-date">${review.date}</div>
                    </div>
                </div>
                <div class="review-rating">
                    ${renderStars(review.rating)}
                </div>
            </div>
            <div class="review-text">
                ${review.text}
            </div>
            <div class="review-barber">
                <i class="fas fa-user-tie me-1"></i> Service by: ${review.barber}
            </div>
            ${review.response ? `
                <div class="review-reply">
                    <strong>Shop Response:</strong> ${review.response}
                </div>
            ` : `
                <div class="d-flex justify-content-end">
                    <button class="btn btn-sm btn-outline-primary" onclick="replyToReview(${review.id})">
                        <i class="fas fa-reply me-1"></i>Reply
                    </button>
                </div>
            `}
        </div>
    `).join('');
}

function renderStars(rating) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
            stars += '<i class="fas fa-star"></i>';
        } else {
            stars += '<i class="far fa-star"></i>';
        }
    }
    return stars;
}

// Dashboard refresh
function refreshDashboardData() {
    console.log('Refreshing dashboard data...');
    loadSchedule();
    loadReviews();
    loadNotifications();
}

// Shop Management Functions
function editShopProfile() {
    const modal = new bootstrap.Modal(document.getElementById('shopProfileModal'));
    modal.show();
}

function changeShopLogo() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.onchange = uploadShopLogo;
    fileInput.click();
}

function uploadShopLogo(event) {
    const file = event.target.files[0];
    if (!file) return;

    showNotification('Logo Upload', 'Uploading logo...', 'info');
    
    // In a real app, you would use FormData to upload the file
    // Here we'll just simulate success after a delay
    setTimeout(() => {
        showNotification('Logo Upload', 'Logo updated successfully!', 'success');
        
        // Update logo preview (simulate)
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('shop-logo-img').src = e.target.result;
        }
        reader.readAsDataURL(file);
    }, 1500);
}

// More utility functions...

// Notifications system
function showNotification(title, message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `toast show notification-${type}`;
    notification.setAttribute('role', 'alert');
    notification.setAttribute('aria-live', 'assertive');
    notification.setAttribute('aria-atomic', 'true');
    notification.innerHTML = `
        <div class="toast-header">
            <i class="fas ${getIconForNotificationType(type)} me-2"></i>
            <strong class="me-auto">${title}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    // Add to container
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(container);
    }
    
    container.appendChild(notification);
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.remove();
        }, 500);
    }, 5000);
}

function getIconForNotificationType(type) {
    switch(type) {
        case 'success': return 'fa-check-circle text-success';
        case 'error': return 'fa-exclamation-circle text-danger';
        case 'warning': return 'fa-exclamation-triangle text-warning';
        case 'info':
        default: return 'fa-info-circle text-info';
    }
}

// Include the remaining function implementations that were in your original code...
</script>
{% endblock %}

